title "Momentum Fetch TV "

//version 1.0 Aug 22, 2024

//CONFIGURATION PARAMS
custom properties #cp { //start of configuration parameters
//show/hide pages/widgets/

  commentsselfcatfilterhide: true

  responseratehide: true //false
  responsehide: false //true  //needed to show widget with response exdluding responserate
  hideimpact: true
  hiderankedfocusitems: false
  hidewordcloud: false
  hidechartlearn: false
  hidechartsegmentation: false
  significancetext: Currently_hardcoded_out

//referencedatacontrol
  defaultnorm: "2Fetch"

//zones for quartiles on health check
  bottomquartile: 54
  moderatezone: 69
  topquartile: 100
  bottomquartileastext: "54"
  moderatezoneastext: "69"
  topquartileastext: "100"
  bottomquartiletext: "Bottom Quartile"
  moderatezonetext: "Moderate Zone"
  topquartiletext: "Top Quartile"
  priorcycletext: "Prior Cycle"

//confidentiality and data control
  currenthasdata: IIF(count(.response:status, @cp.completes AND @cp.currentwave) >= @cp.confidentiality, true, false)
  previoushasdata: IIF(count(.response:status, @cp.completes AND @cp.previouswave) >= @cp.confidentiality, true, false)
  toofewresponses: "<" + toText(@cp.confidentiality)


  confidentiality: 5 //5 for items, dims
  confidentialitycomments: 30

  completes: :status = "complete"

  //data source
  mainprojectid: p119716917612//p438572540377
  currentwaveprojectlabel: "p129314018333"//"p248840092204"
  lastwaveprojectlabel: "p773800573087"

  engagementmodelA_yearcategories: "'p773800573087','p129314018333'"
  engagementmodelB_yearcategories: "'p773800573087','p129314018333'"

  currentwave: @mainwave.selected.wave //.response:combined_sourceid = @cp.currentwaveprojectlabel //@cp.currentwaveprojectlabel //F24
  previouswave: .response:combined_sourceid = @cp.lastwaveprojectlabel
  currentwaveresponse: .response:combined_sourceid = @cp.currentwaveprojectlabel
  previouswaveresponse: .response:combined_sourceid = @cp.lastwaveprojectlabel
  currentwavelabel: "2024"
  previouswavelabel: "2023"

  actionplanninghide: true //not signed off
//wordcloud
  stop_words: 'about','as','before','after','has','my','it','been','just','eg','how','also','all','made','actually','must','be','can','adding','add','if','any','out','bit','for','will','with','of','that'

 //Layout
  mercerlogo: "https://momentum.mercer.com/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/mercersmaller.png"
  clientlogo: "https://momentum.mercer.com/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/FetchTV/fetchlogolarger.png"

 // blankarea: "https://studio-cdn.euro.confirmit.com/isa/BDJPFRDMEYBPBKLVADAYFQCDAVIOEQJR/Mercer/blankarea.png"
  dividervertical: "/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/divider%20vertical.png"
  clientlogoPDF: "https://momentum.mercer.com/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/FetchTV/fetchlogolarger.png"
  mercerlogoPDF: "![image](https://momentum.mercer.com/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/mercersmaller.png)"

//  heatmaplegend1:  <img src='/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/heatmaplegend_highlow.png' alt='drawing' width='500'/>"
//  heatmaplegend2:   <img src='/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/heatmaplegend1.png' alt='drawing' width='500'/> Click cells to see items for that row"
  heatmapdescription1: "To view score heatmap in the unit, colors are dynamic to % of the highest and lowest scoreshighest and lowest score of the unit:
     <img src='/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/heatmaplegend_highlow.png' alt='drawing' width='500'/>"

  heatmapdescription2: "To view differences across organisation units/demographic cuts, a fixed coloring is used:
     <img src='/isa/PYAMLMFAKKOYIBEYNHKRJRBIMIEALXOH/Mercer%20template/heatmaplegend1.png' alt='drawing' width='500'/> 
     Click cells to see items for that row"

  //pdf setup
  dimset1dimensions: 1,2,3
  dimset2dimensions: 4,5,6
  dimset3dimensions: 7,8,9
  dimset4dimensions: 10,11,12
  dimset5dimensions: 13,14,15
  dimset6dimensions: 16,17,18
  dimset7dimensions: 19,20,21
  dimset8dimensions: 22
  dimset9dimensions: 23,24


  pdfdistributionwidth: 200px
  pdfrowheaderwidth: 650px
}

layoutArea header {

  layout row {

    // widget logo #mercerlogo {
    //   logo: @cp.mercerlogo
    // }

//     widget logo { //blank to add space
// logo: @cp.blankarea
//     }
    widget logo #clientlogo {
      logo: @cp.clientlogo
    }
    widget pageNavigation {
    }
  }
}

reportBase #reportBase {
  rule nodesHM #nodesHMRule {
    reportingHierarchy: selfRefLookupReportinghierarchy
    mode: permission
  }
}

config hub {
  hub: 18
  // table ap1 = ap.initiatives
  // table ap2 = ap.actions

  referenceData custom #RWA { //used for vtable
    table: RWA.rwa_fetch:
    selectors: NormId, id
  }
  referenceData custom #dimensionScoreLookup { //used for vtable
    table: dimensionScoreOverall:
    selectors: idText
  }
  referenceData custom #keymetricdistributions { //norms for favorable
   // table: Momentum_Norms.keymetricdistributions: //NEW
    table: Momentum_Norms_Legacy.keymetricdistributions_fetch: //LEGACY
    selectors: NormId, Level
  }
  referenceData custom #norms { //list of norms for selector
   // table: Momentum_Norms.ResponseCounts: //NEW
    table: Momentum_Norms_Legacy.ResponseCounts_fetch: //LEGACY
    selectors: NormId, QuestionId, ResponseValue//, Type
  }
  referenceData custom #KeyMetricNorm {
    //table: Momentum_Norms.norms: // for Health Check widget comparison
    table: Momentum_Norms_Legacy.norms_fetch: // for Health Check widget comparison
    selectors: NormId
  }
  reportingHierarchy selfRefLookup #selfRefLookupReportinghierarchy {
    source: :OrgStructure
    label: "Hierarchy"
  }
  dataset custom #layouttable {
    publicName: Layout
    defaultTable: LayoutControl
  }
  dataset custom #legacynormlist { //for for QA
    publicName: Momentum_Norms_Legacy
    defaultTable: Norms
  }
  dataset custom #newnormlist { //for qa
    publicName: momentum_norms_new
    defaultTable: norms
  }
  dataSet: surveyDataset

  dataset survey #surveyDataset {
    publicName: @cp.mainprojectid
    propagateFilter #propagateFilter {
      from: .response:
      to: .respondent:
    }
    table dimensions = .dg1_dimensions:
    table items = .dg1_questions:
    table benchmarks = project_config.benchmark_list:

//these relations are neccessary to report dim scores from questionsScores table. this sets a Requirement for viastrategy:shortest on widgets that tries to use like dimensions_questions table or dimension table or question table
    relation oneToMany {
      primaryKey: .dg1_dimension_question:questionId
      foreignKey: .dg1_questionScore:dg1_questionScore
//needed at least for What are my top scoring - fetching dim label
    }
    relation oneToMany {
      primaryKey: .dg1_dimension_question:dimensionId
      foreignKey: .dg1_dimensionScore:dg1_dimensionScore
//needed for calculting dim corrs with eng inside items row table (top priority list popup)
    }
    relation oneToMany { //LEGACY
      primaryKey: .dg1_dimension_question:questionId
      foreignKey: Momentum_Norms_Legacy.ResponseCounts:questionId
      //in order to create normscores for dims in Legacy
    }
    relation oneToMany { //NEW
      primaryKey: .dg1_dimension_question:questionId
      foreignKey: Momentum_Norms.ResponseCounts:questionId
      //in order to create normscores for dims in NEW
    }



//SCORE CALC

    measure custom #itemTopTwoDouble { //for testing double rounding, works
      value: IIF(count(:, @cp.completes) >= @cp.confidentiality, Round(average(numeric(.dg1_questionScore:questionFavorableNumeric5s)) * 100, 0) + Round(average(numeric(.dg1_questionScore:questionFavorableNumeric6s)) * 100, 0))
        //    value: IIF(count(:, @cp.completes) >= @cp.confidentiality, Round(average(numeric(.dg1_questionScore:questionFavorableNumeric)) * 100, 0))
    }

    measure custom #itemTopTwo {
     // value: IIF(count(:, @cp.completes) >= @cp.confidentiality, average(numeric(.dg1_questionScore:questionFavorableNumeric)) * 100)
      value: IIF(count(:, @cp.completes) >= @cp.confidentiality, Round(average(numeric(.dg1_questionScore:questionFavorableNumeric)) * 100, 0))
    }

    measure custom #dimensionTopTwoNEW {
      value: Round(item(vpercent([column = /magicfav]), "1"), 0)
    }
    measure custom #dimensionTopTwoNEW2 {
      value: IIF(sum(.dg1_dimensionScore:answerCounts, @cp.completes) >= @cp.confidentiality, Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0))
  //     value: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
    }

//layaoutmaesures
    measure custom #responseratehidenumeric { //tho have a numeric to test by
      value: IIF(@cp.responseratehide = true, 1, 0)

    }

//FILTERS TO CONTROL DIMS AND INDICIES (SHOULD BE MOVED TO TRANSFORM)

//*********Filter for KeyIndicies - which dimensions to show use Dim ID, not label

    measure filter #filterMeasure { //measure filters disappear
      value: selected(.dg1_dimensionScore:dg1_dimensionScore, "engagement")
      label: "Engagement Dimension Only"
    }

//Filter for KeyIndicies - which dimensions to show use Dim ID, not label
    measure filter #keyindices { //gets deleted for some reason, copy
      value: selected(.dg1_dimensionScore:dg1_dimensionScore, "Agility", "Manager_support", "Engaging_Leadership", "Talent_Focus", "Mental_Health")//, "Decision__making", "wellness", "collaboration", "careerDevelopment")
      label: "Condition"
    }

//Filter for KeyIndicies - which dimensions to show use Dim ID, not label
//bckup in case filters are deleted - when deleting widgets?
//      measure filter #filterMeasure { //measure filters disappear
//       value: selected(.dg1_dimensionScore:dg1_dimensionScore, "engagement")
//       label: "Engagement Dimension Only"
//     }

// //Filter for KeyIndicies - which dimensions to show use Dim ID, not label
//     measure filter #keyindices { //gets deleted for some reason, copy
//      value: selected(.dg1_dimensionScore:dg1_dimensionScore, "Agility", "Manager_support", "Engaging_Leadership", "Talent_Focus", "Mental_Health")//, "Decision__making", "wellness", "collaboration", "careerDevelopment")
//       label: "Condition"
//     }

    variable numeric #forDimension { //take out "outcome" Engagement_legacy, Intent to stay
      table: :
      value: avg(.dg1_dimensionScore:dimensionScoreValue, .dg1_dimensionScore:dg1_dimensionScore = "Engagement", :)
    }


//Legacy Engagement Score calc
    variable numeric #engscorecountlegacysay { //Legacy model, only those who answer at least one of say stay strive participate in Engscore
      table: .response:
      value: IIF(count(:EN0001) + count(:EN0004) > 0, 1)
    }
    variable numeric #engscorecountlegacystay { //Legacy model, only those who answer at least one of say stay strive participate in Engscore
      table: .response:
      value: IIF(count(:EN0002) + count(:EN0005) > 0, 1)
    }
    variable numeric #engscorecountlegacystrive { //Legacy model, only those who answer at least one of say stay strive participate in Engscore
      table: .response:
      value: IIF(count(:EN0003) + count(:EN0006) > 0, 1)
    }
    variable numeric #engscorecount { //Legacy model, only those who answer at least one of say stay strive participate in Engscore
      table: .response:
      value: count(:engscorecountlegacysay) + count(:engscorecountlegacystay) + count(:engscorecountlegacystrive)
    }

    variable numeric #engScore { //LEGACY //average per person 
      table: .response:
      value: IIF(:engscorecount = 3, (numeric(.response:EN0001) + numeric(.response:EN0002) + numeric(.response:EN0003) + numeric(.response:EN0004) + numeric(.response:EN0005) + numeric(.response:EN0006)) / 6)
     //should be an average function
    }

//NEW Engagement model score calc
  // variable numeric #engscorecount { //NEW model, only those who answer all 4 participate in Engscore
  //     table: .response:
  //     value: count(:EN0558) + count(:EN0556) + count(:EN0467) + count(:EN0290)
  //   }

  //   variable numeric #engScore { //NEW//average per person
  //     table: .response:
  //     value: IIF(:engscorecount = 4, (numeric(.response:EN0558) + numeric(.response:EN0556) + numeric(.response:EN0467) + numeric(.response:EN0290)) / 4) //spencer use en0290 it seems
  //   }

    variable singleChoice #EngagementDistribution { //puts people into boxes based on average
    //A respondent is considered“engaged” if their average score across the 6 Engagement items is greater than or equal to 4.5
    //this means engscore in momemtum is top2box of #EngagementDistribution
      table: :
      value: iif(:engScore < 3.5, "1", iif(:engScore < 4.5, "2", iif(:engScore < 5.5, "3", iif(:engScore <= 6, "4"))))
        //value: iif(:engScore < 3.75, "1", iif(:engScore < 4.75, "2", iif(:engScore < 5.75, "3", iif(:engScore <= 6, "4"))))
      label: "Engagement Distribution"
      required: true

      option code {
        code: "4"
        label: "Highly Engaged"
        score: 4
      }
      option code {
        code: "3"
        label: "Moderately Engaged"
        score: 3
      }
      option code {
        code: "2"
        label: "Passive"
        score: 2
      }
      option code {
        code: "1"
        label: "Actively Disengaged"
        score: 1
      }
    }


    measure custom #engagementscore {
      value: IIF(count(:EngagementDistribution) >= @cp.confidentiality, Round(top2Percent(:EngagementDistribution), 0))
    }
    measure custom #engagementscorecurrentwave {
      value: IIF(count(:EngagementDistribution, @cp.currentwave) >= @cp.confidentiality, Round(top2Percent(:EngagementDistribution, @cp.currentwave), 0))
    }
    measure custom #engagementscorepreviouswave {
      value: IIF(count(:EngagementDistribution, @cp.previouswave) >= @cp.confidentiality, Round(top2Percent(:EngagementDistribution, @cp.previouswave), 0))
    }
    variable singleChoice #wavereverted2 {
      table: surveyDataset:
      value: :combined_sourceid
      option code {
        code: @cp.currentwaveprojectlabel
        label: @cp.currentwavelabel
      }
      option code {
        code: @cp.lastwaveprojectlabel
        label: @cp.previouswavelabel
      }
    }

    variable singleChoice #wave {
      table: surveyDataset:
      value: :combined_sourceid
      option code {
        code: @cp.lastwaveprojectlabel
        label: @cp.previouswavelabel
      }
      option code {
        code: @cp.currentwaveprojectlabel
        label: @cp.currentwavelabel
      }
    }

  } //end dataset Surveydataset
  variableSet #demographics {
    label: "Selector"
    table: :
    variables: :D1, :Q74, :q73 //:Age_group, :Gender, :Region_by_Location, :Subregion, :Country, :Office, :Cohort, :Practice, :Generation, :Tenure_Group //:EngagementDistribution,
  }

  variableSet #openended {
    label: "Selector"
    table: :
    variables: :q89.start, :q89.stop,:q89.continue //:Age_group, :Gender, :Region_by_Location, :Subregion, :Country, :Office, :Cohort, :Practice, :Generation, :Tenure_Group //:EngagementDistribution,
  }

  valueSet #openendedvalueset {
    item {
      label: "In a few words, please tell us what Fetch TV should start doing to help you to contribute to the best of your ability"
      value:  {
        qid: :q89.start
        filterid: "Q89|start"
        text: "In a few words, please tell us what Fetch TV should start doing to help you to contribute to the best of your ability"
      }
    }
    item {
      label: "In a few words, please tell us what Fetch TV should stop doing to help you to contribute to the best of your ability"
      value:  {
        qid: :q89.stop
        filterid: "Q89|stop"
        text: "In a few words, please tell us what Fetch TV should stop doing to help you to contribute to the best of your ability"
      }
    }
    item {
      label: "In a few words, please tell us what Fetch TV should continue doing to help you to contribute to the best of your ability"
      value:  {
        qid: :q89.continue
        filterid: "Q89|continue"
        text: "In a few words, please tell us what Fetch TV should continue doing to help you to contribute to the best of your ability"
      }
    }
  }

  valueSet #rankedfocusitems {
    item {
      label: "Top 10"
      value:  {
        top: 10

      }
    }
    item {
      label: "All"
      value:  {
        top: 100
      }
    }

  }

  vtable custom #dimensionScoreOverall {

    variable auto #score {
           value: IIF(sum(.dg1_dimensionScore:answerCounts, @cp.completes) >= @cp.confidentiality, Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0))

//      value: :dimensionTopTwoNEW2() cant use measure as reference in vtable (custom) when permission/restriction Report base is active
    }
    variable text #idText {
      value: toText(.dg1_dimensionScore:dg1_dimensionScore)
      groupBy: values
    }

    filter expression {
      value: @cp.currentwave

    }
  }

  dataTable #dtNormsLegacy {
    dataGrid {

      row list #norms {
        total: none
        table: Momentum_Norms_Legacy.norms_fetch: //Momentum_Norms.norms
        value: ""
        sortBy: "/order"
        sortOrder: ascending
        takeTop: 3
      }
      column #order {
        hide: true
        cell {
          value: Momentum_Norms_Legacy.norms_fetch:NormId
        }
      }
      column #results {
        cell custom {
          expression #label {
            value: Momentum_Norms_Legacy.norms_fetch:Name
          }
          expression #id {
            value: Momentum_Norms_Legacy.norms_fetch:NormId
          }
          expression #idText {
            value: toText(Momentum_Norms_Legacy.norms_fetch:NormId)
          }

          expression #order {
            value: toText(Momentum_Norms_Legacy.norms_fetch:NormId)
          }

          formatString: "{label} {definitionId} {isDefault}"
        }
      }
    }
    map #forSelect {
      from: "norms"
      to: item {
        label: this.results.label
        value: this.results.id
        idText: this.results.idText
      }
    }

  }
  dataTable #dtNormsNew {
    dataGrid {
      //filter expression {
      //  value: Momentum_Norms.norms:NormId = "1644NEWEB2024V1"//"3721NEWEB2024V1"
      //}
      row list #norms {
        total: none
        table: Momentum_Norms.norms: //Momentum_Norms.norms
        value: ""
        sortBy: "/order"
        sortOrder: descending
        takeTop: 50
      }
      column #order {
        hide: true
        cell {
          value: Momentum_Norms.norms:NormId
        }
      }
      column #results {
        cell custom {
          expression #label {
            value: Momentum_Norms.norms:Name
          }
          expression #id {
            value: Momentum_Norms.norms:NormId
          }
          expression #idText {
            value: toText(Momentum_Norms.norms:NormId)
          }

          expression #order {
            value: toText(Momentum_Norms.norms:NormId)
          }

          formatString: "{label} {definitionId} {isDefault}"
        }
      }
    }
    map #forSelect {
      from: "norms"
      to: item {
        label: this.results.label
        value: this.results.id
        idText: this.results.idText
      }
    }

  }

} //end config hub
config queryOptions {
  // added automatically during report creation
  boolNullsAsFalse: false
  explicitLevelAggregation: true
}

layoutArea toolbar #headerResponse { //
  useDynamicFilters: true
  widget toolbarWidget {
    // scope reportingHierarchy {
    //   reportingHierarchy: unitHierarchy
    //   mode: @rollupMode.selected.mode
    // }



    select #comparisonPeriodSelector {
      mode: single

      options: item {
        label: "Comparison vs. 2023"
        value:  {

          filter: @cp.previouswave
        }
      }

      // },
      // item {
      //   label: "Comparison vs. 2022"
      //   value: {

      //           filter: :year = 'F22'
      //   }
      // }
    }


    select #benchmarksListItemsSelector {
      areaId: benchmarksList
      mode: single
     // options: @dtNormsNew.forSelect.data //NEW
      options: @dtNormsLegacy.forSelect.data //LEGACY
      defaultOption: @cp.defaultnorm
      compareBy: this.idText
    }


    tile custom {

      expression #first {
        value: @DTResponseRates.m.data.responses.currentResponses
       // value: count(:)
        formatter: bigNumberFormatter
      }
      expression #second {
        value: IIF(@cp.responseratehide = false, @DTResponseRates.m.data.responseRate.currentResponseRate) //@cp.WFComplete / COUNT(:responseid) * 100
        formatter: percentNoDecimal
      }
      style #style {
        fontSize: 18
        fontWeight: 600
        //fontFamily: "Source Sans Pro"
      }
      formatString: "{first} Responses | {second}"
    }
    // select #rollupMode {
    //   //label: "Rollup mode"
    //   options: @dtModes.forSelect.data
    // }

  }
  filter reportingHierarchy #reportingHierarchyFilter {
    reportingHierarchy: selfRefLookupReportinghierarchy
    label: "Hierarchy"
  }
  filter multiselect #fromQuestionFilter_2 {
    optionsFrom: :D1
    label: "Type of Job"
  }
  filter multiselect #fromQuestionFilter_3 {
    optionsFrom: surveyDataset:Q74
  }
  filter multiselect #fromQuestionFilter_4 {
    optionsFrom: surveyDataset:Q73
  }
}

layoutArea toolbar {
  useDynamicFilters: true
  filter reportingPeriod #reportingPeriodFilter {
    label: "Reporting Period"
    hide: true
  }

  // filter multiselect #fromQuestionFilter_3 {
  //   optionsFrom: :Gender
  //   label: "Gender"
  // }

  // filter multiselect #fromQuestionFilter_5 {
  //   optionsFrom: :Region_by_Location
  //   label: "Region by Location"
  // }

  // filter multiselect #fromQuestionFilter_6 {
  //   optionsFrom: :Subregion
  //   label: "Subregion"
  // }

  // filter multiselect #fromQuestionFilter_7 {
  //   optionsFrom: :Country
  //   label: "Country"
  // }

  // filter multiselect #fromQuestionFilter_8 {
  //   optionsFrom: :Office
  //   label: "Office"
  // }
  // filter multiselect #fromQuestionFilter_9 {
  //   optionsFrom: :Cohort
  //   label: "Cohort"
  // }

  // filter multiselect #fromQuestionFilter_10 {
  //   optionsFrom: :Practice
  //   label: "Practice"
  // }

  // filter multiselect #fromQuestionFilter_11 {
  //   optionsFrom: :Generation
  //   label: "Generation"
  // }
  // filter multiselect #fromQuestionFilter_12 {
  //   optionsFrom: :Tenure_Group
  //   label: "Tenure Group"
  // }
}

config style #styleConfig {
  theme: modern
}

config pdfExport {
  pageSize: A4
  pageOrientation: landscape
  pageScaling: fitToWidth
  exportMode: htmlToPdf
  version: 2
  allowFileNaming: true
  pageMargins: 0.4
}



config report #reportConfig {
 // logo: "https://dependentverification.mercer.com/edwardjones/client/images/banner/logo_mercer.gif"
  palette #mercer {
    colors: "#5c2e8e", "#037cc2","#fcb415", "#d13131" // "#fcb415", This is the negative hesitance color.
    label: "Mercer Distribution"
  }

  palette answerList #mercerlist {
    item {
      code: 1
      color: #d13131
    }
    item {
      code: 2
      color: #fcb415
    }
    item {
      code: 3
      color: #037cc2
    }
    item {
      code: 4
      color: #5c2e8e
    }
  }
  palette #copy_of_mercer {
    colors: "#d13131", "#fcb415", "#037cc2", "#5c2e8e"
    label: "Mercer Distribution Reversed"
  }
  palette #mercer_1_color {
    colors: "#5c2e8e", "#d1d1d1"
    label: "Mercer 1 Color"
  }
  palette #mercer_1_color_reversed {
    colors: "#d1d1d1", "#5c2e8e"
    label: "Mercer Reversed"
  }
  formatter number #numberFormatter {
    decimalSeparator: "."
    label: "GiveMeAComma"
    integerSeparator: ","
  }
  formatter color #wccolor {
    thresholds: "#5c2e8e" > 0
  }

  formatter color #heatmapbackgroundcolor {
    thresholds: #002c77 >= 90, #2e3f87 >= 80, #4b5498 >= 70, #6469a9 >= 60, #7d7fba >= 50, #9596cb >= 40, #c7c6ed >= 30, #c7c6ed >= 20, #e0dfff < 20
  }
  formatter color #heatmapbackgroundcolorvalue {
    thresholds: #e0dfff >= 90, #e0dfff >= 80, #e0dfff >= 70, #e0dfff >= 60, #e0dfff >= 50, #003145 >= 40, #003145 >= 30, #003145 >= 20, #003145 < 20
  }
  formatter color #dynamicheatmapbackgroundcolor {
    thresholds: #002c77 >= @maxminselector.selected.max90, #2e3f87 >= @maxminselector.selected.max80, #4b5498 >= @maxminselector.selected.max70, #6469a9 >= @maxminselector.selected.max60, #7d7fba >= @maxminselector.selected.max50, #9596cb >= @maxminselector.selected.max40, #c7c6ed >= @maxminselector.selected.max30, #c7c6ed >= @maxminselector.selected.max20, #e0dfff < @maxminselector.selected.max20
  }
  formatter color #dynamicheatmapbackgroundcolorvalue {
    thresholds: #e0dfff >= @maxminselector.selected.max90, #e0dfff >= @maxminselector.selected.max80, #e0dfff >= @maxminselector.selected.max70, #e0dfff >= @maxminselector.selected.max60, #e0dfff >= @maxminselector.selected.max50, #e0dfff >= @maxminselector.selected.max40, #003145 >= @maxminselector.selected.max30, #003145 >= @maxminselector.selected.max20, #003145 < @maxminselector.selected.max20

  }

  formatter color #tileset {
    thresholds: #34ae9a > 0, #d02625 < 0, #000000 = 0
  }
  formatter valueMapping #upordown {
    thresholds: "↓" <0, "↑" > 0 , "-" = 0
//thresholds: "⬇" <0, "⬆" > 0 , "-" = 0
  }

  palette #palette_5 {
    colors: "#d67d00"
    label: "Orange"
  }

//for Health check gauge:
  palette #zones {
    colors: "#D03131", "#FCB429", "#5C2E8E", "#E7BA3C", "#E7BA3C", "#65A476"
    label: "sectorsPalette"
  }
  palette #metricBackgroundPalette {
    colors: "#D9D9D9"
    label: "background"
  }
  palette #metricValuePalette {
    colors: "#5C2E8E", "#D9D9D9"
  }

}
page #Changelog {
  label: "Change Log"
  widget canvas #canvasWidget {
    size: large
    hide: true
    label: "Canvas"
    container: container position {
      width: 1368px
      height: 800px
      area #gauge {
        top: "150px"
        left: "150px"
        position: "absolute"
      }
      area #text {
        top: "236px"
        left: "231px"
        position: "absolute"
      }
    }
    tile custom #gauge {
      areaId: gauge
      expression #value {
        value: 41
      }
      expression #minValue {
        value: 0
      }
      expression #maxValue {
        value: 100
      }
      expression #targetValue {
        value: 30
      }
      formula #belowTarget {
        value: IIF(value[] < targetValue[], value[])
      }
      formula #aboveTarget {
        value: IIF(value[] >= targetValue[], value[])
      }
      formula #noTarget {
        value: IIF(isNull(targetValue[], true), value[])
      }
      formatString: ""
      view svg {
        group polar #gauge {
          cx: 50
          startAngle: 180
          endAngle: 0
          max: this.maxValue
          min: this.minValue
          shape sectors #zones {
            valueType: 'cumulative'
            innerRadius: '36%'
            outerRadius: '39%'
            padAngle: 0.4
            palette: 'zones'
            value: {value: 30 label: "fist"}, {value: 35 label: "fist"}, {value: 40 label: "second"}, {value: 47 label: "third"}, {value: 50 label: "forth"}, {value: 65 label: "third"}, {value: 80 label: "third"}, {value: 100 label: "third"}
          }
          shape sectors #background {
            innerRadius: '40%'
            outerRadius: '50%'
            palette: 'background'
            value:  {
              value: this.maxValue
              label: ""
            }
          }
          shape sectors #metric {
            palette: paletteValue
            innerRadius: '42%'
            outerRadius: '48%'
            value: { value: this.belowTarget label: "waht" }, { value: this.aboveTarget label: "" }, { value: this.noTarget label: "" }
          }
          shape custom #target {
            angle: this.targetValue
            radius: '50%'
            // value: '<path stroke=black d="M0,0 L-10,0" />'
            value: '<line x1="0" y1="0" x2="9.5%" y2="0" style="stroke:black;stroke-width:1" />'
          }
          // shape custom #secondTarget {
          //   angle: this.secondTarget
          //   radius: '80%'
          //   value: '<path stroke="#777777" d="M0,0 L-10,0" />'
          // }
          shape custom #scaleMin {
            angle: this.minValue
            radius: '45%'
            rotate: false
            value: '<text transform="translate(0,6)" font-size=7 text-anchor="middle" fill="grey">{this.minValue}</text>'
          }
          shape custom #scaleMax {
            angle: this.maxValue
            radius: '45%'
            rotate: false
            value: '<text transform="translate(0,6)" font-size=7 text-anchor="middle" fill="grey">{this.maxValue}</text>'
          }
        }
      }
    }

    tile custom #text {
      areaId: text
      expression #value {
        value: round(avg(numeric(:EN0001)), 2) + 10
        formatter: percentNoDecimal
      }
      expression #targetValue {
        value: 30
        formatter: percentNoDecimal
      }
      formula #diffToTarget {
        value: value[] - targetValue[]
        formatter: percentDefaultFormatter
      }
      formatString: ""
      switch {
        byValue: diffToTarget
        case {
          condition: "<0"
          body {
            formatString: 'Your value <br><span style="font-size: 2em;">{value}</span><br>is below target<br>{diffToTarget}'
          }
        }
        case {
          condition: ">0"
          body {
            formatString: 'Your value <br><span style="font-size: 2em;">{value}</span><br>is above target<br>{diffToTarget}'
          }
        }
        case {
          condition: "=0"
          body {
            formatString: 'Your value<br><span style="font-size: 2em;">{value}</span><br>is at target'
          }
        }
        case {
          condition: isNull
          body {
            formatString: 'Your value<br><span style="font-size: 2em;">{value}</span>'
          }
        }
      }
      style {
        fontSize: 20px
        textAlign: center
      }
      label: "the inner stuff"
    }
  }


  widget markdown #markdownWidget {
    label: "Change Log"
    size: halfwidth
    markdown: "Aug 19
Key indices.: Added trend arrows,checked to remove if not present or lower than conflevel.
Segmentation popup: Added  info on dim/item selected

**Aug 15**
Found a bug where arrow symbols didnt print to pdf on the momentum site. Did on other site. Exchanged with safer symbols. published. Can review  symbols  later.

Removed Engagement from Dimensions on Heatmap. it didn't seem useful to have its own widget for heatmapping for just engagement
Remove change log page for users
Suppress for previous wave when less than confi level (except pdf)
Completed PDF Export update to align with rest of report.
Split engagement on Learn into two widgets to separate legends so they dont appear confusing
Fixed a bug where trend was showing on health check gauge when comparison < conf level


**AUG 14**
Fixed an issue when selecting filters returning than 5.
Fixed an issue where Indicies weren't suppressed if less than confidentiality. (typically Manager_support)
Fixed the wordcloud hiding if less than commentconfidentiality 
Fixed another suppress issue on engagement distribution and checked all other widgets




Fixed an issue with Finance department creating an error
Removed % on gaps


Moved the Dev and Live reports back to Momentum site
Started to remove previous year data when to few answers for filtered unit
Added information boxes (CHRIS)
segmentatio page added  ʺ< conflevelʺ instead of count
segmentation page: split lower table into one for dims and one for items in order to enable View segment for dims
Moved the ʺview segments first column (right would require user to scroll to find it on large demographics)


Ranked focus item, updated order, will not hit Michals exactly due to new data
Made several resources configurable


**AUG 13**
Alina: Added two global filters Q73 q74
Alina: Added the full text on the comments question selector
Barbara: Added the black expansion arrow on Engagement-learnpage
Barbara:  Too many legend wen selector full distribution and dim/items? for discussion
Barbara: Learn selectingitems bug, fixed
Barbara: Number of demographics answers on the chart? For discussion
Barbara: Segmentation - numbers are hidden if below confidentiality level

Segmentation page: Added counts
BUG on Item trend: items was displaying empty engagement items. now removed
BUG, heatmap orgview, added a wavefilter on the popup
BUG, Learn page: Comparison vs Overall company did't work for dimensions

What happens if comparison# < confidentiality

Added help / context information to Learn, Segmentation, Comments, Org Trends, Item Trends, and Heatmaps

**AUG 12**
Logo: Keeping client logo only for online
PDF - updated the suggested new banner to all pages
Moved PDF Export page to last page

**Aug 11** CURRENT LIVE version
Fixed the Feedback on the distribution norms by changing the norms file, not the report. 4 is Highly engaged, not 1 as it was there
For the other feedback on Norm distance slightly off on two dimensions, yes I find if I remove rounding on the items scores (which produce the dimension distance), it brings the Michal result. 

Health Check Participation Rate - dash is gone and reintroduced title. No word changes as of yet

All online pages: added client logo, configurable. 

PDF Export: 
The content is now complete, with 2-3 dimensions/indices per page. Some configuration is necessary per client in terms of items per dimension. Made a couple of configurable settings to adjust column widths of items text and distirbution.
Had to remove sorting on  dimensions due to no current solution to split it to two pages sorted. 

 Split the banner into two, in order to show configurable clientlogo to align right. Lost the line due to configurable logo
 Also this change require to remove banner widget frames that made the banner look split. This resulted in mercer logo blue on blue background so its invisible on page. HEnce changed blue page background color to white. This also displays expected export view and makes a difference from other pages. 
 
**Aug 9**
Health Check, Gauge now displays correctly when prior cycle scores less than current cycle
Top Scoring questions show label for both Dimensions and Key Indices when an item is connected to both
Engagement Distribution for the Selected Demographic chart suppression is fixed
Word Cloud excludes Stop Words set up in configuration


**Aug 8** 
PDF EXPORT Added a first version, aligned with Momemtum online content and adapted a bit to the content from FETCH ppt 2023. its in early state
PDF export - Removed portrait mode, letter and A3page sizes

Health check gauge is now in, note a buggy behavior when filtering to a unit where the currentyear score is higher than target. 
Health check gauge - added a configurable legend to explain ranges and prior cycle

Learn: default view mode is still dimensions, but in the dimension and items table below, its expandable one by one. Users can still select Dimensions and items in the top selector to see all expanded.

Fix 6 feedback items from Michal this morning (removed mainwaveselector, made defaultnorm only for Ranked focus items, added demographics, added

Comments: Brought back in the wordcloud for you to decide if Fetch should see it.
Comments: Made confidentiality requirement connect to the configurable one for comments (currently 30)

**Aug 7**
Fixed the feedback that Engagement - comparison to prev (and also overall score) to run on engagementscore, not favorable

**AUG 6:**
Made the charts on segementation configurable to turn on or off and default kept them on

Note - Significance texts from Demo are hardcoded out as we dont have the methodology for it.

**AUG 5 demo**
Norms added

Norms for dims are calc as avg item norm distance

Ranked Focus areas - now inherits impact from levels above to hit at least 30 respondents

Dashboard and Learn:
- Dimensionsuppression now reacts to avg rounded items counts. so for treshold 10, 9.5 is needed. for 5, 4.5 is needed.
- Itemsuppress implemented
- General report base suppress implemented
- introduced a text for ʺtoo fewʺ being ʺ< [confidentialitylevel]. This text is now a configurable

Several places:  removed legend when showing favorable to avoid display of ʺunfavorableʺ.  Also on hover replaced with ʺ-ʺ
Several places: made a configurable setting to remove ResponseRate displays

Impact widget made a configurable setting that hides Impact due to incompatibility with Fetch and also to show RAnked Focus Items directly
TopScoringQuestions: hardcoded a filter to remove ʺmanager_supportʺ from topscoring questions

key indices - suppressed manager support??

Learn: Change Engagement Distribution from perception to actual engagementdistribution
Learn: hid the chart with engagement distribution, as its redundant.

Segmentation: Made selectors as in Learn
Segmentation: Enabled full distribution. Kept legends hidden.
Segmentation: removed the chart, as the info is in the Engagement widget above (but different)

Comments - removed Wordcloud - no meaning. Made configurable


Health check - fixed a bug where Normgap was calculating the opposite gap.
"

  }
  widget markdown #copy_of_markdownWidget {
    label: "Backlog before final realease of Fetch"
    size: halfwidth

    markdown: "
Other Backlog not for Fetch:

Review the use of grey bar with a score of ʺthe restʺ earlier labelled ʺunfavorableʺ and see if this visualisation should change to Bar instead of Stackedbar.

Handling two logos online(divider)
Segmentation page: Changing graphs to tables for high count demographics that will not fit graph
Rounded corners on certain widgets (canvas)
PDF statics (Mercer to deliver updated branding)
Find a way to make pdf dimension pages sortable
configurable for hiding impact/ranked items when less than 30
On segmentation page, find a way to enable one single widget to view segments (dims dont filter on the desired view)"
  }

  hide: true
  modal: false

}


page #Insights {
  label: "Insights Dashboard"
  dataTable #top3dimNew {
    dataGrid #dataGridWidget {
      viaStrategy: shortest
      label: "works as DT "
      size: "large"
      filter expression {
        value: NOT(IN(.dg1_dimensions:Id, "Engagement", "Mental_Health", "Manager_support", "Talent_focus", "Agility", "engaging_leadership"))
      }
      filter expression #removenonRWA {
        value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
      }
      filter expression {
        value: @cp.currentwave
      }
      filter expression {
        value: .dg1_dimension_question:dimensionId != "Mental_Health" AND .dg1_dimension_question:dimensionId != "Manager_support" AND .dg1_dimension_question:dimensionId != "Talent_Focus" AND .dg1_dimension_question:dimensionId != "Agility" AND .dg1_dimension_question:dimensionId != "Engaging_Leadership" AND .dg1_dimension_question:dimensionId != "Positive_Duty"
      }

      filter expression #exclude_positive_duty {
        value: .dg1_questions:Id != "Q66" AND .dg1_questions:Id != "Q67" AND .dg1_questions:Id != "Q68" AND .dg1_questions:Id != "Q69" AND .dg1_questions:Id != "Q70" AND .dg1_questions:Id != "Q71" AND .dg1_questions:Id != "Q72"
      }
      filter expression #exclude_manager_support {
        value: .dg1_questions:Id != "Q75" AND .dg1_questions:Id != "Q76" AND .dg1_questions:Id != "Q77" AND .dg1_questions:Id != "Q78" AND .dg1_questions:Id != "Q79" AND .dg1_questions:Id != "Q80" AND .dg1_questions:Id != "Q81" AND .dg1_questions:Id != "Q82" AND .dg1_questions:Id != "Q83" AND .dg1_questions:Id != "Q84" AND .dg1_questions:Id != "Q85" AND .dg1_questions:Id != "Q86" AND .dg1_questions:Id != "Q87"
      }

      activeRows: rankeddimensions, both

      row nestedHeaders #both {
        viewMode: expanded
        nesting byTable {
          parent: .dg1_dimension_question:dimensionId
          child: .dg1_dimension_question:questionId
        }

        parent list #dimensions {
          total: none
          table: .dg1_dimensions:
          value: .dg1_dimensions:Id
          sortBy: .dg1_dimensions:SequenceId
          sortOrder: ascending
        }

        child list #items {
          total: none
          table: .dg1_questions:
          value: answerText(.dg1_questions:Id)
          sortBy: .dg1_questions:SequenceId
          sortOrder: ascending
        }
      }

      row list #rankeddimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: "/forrankeddimensions"
        sortOrder: ascending
        takeTop: 3

      }

      column #forrankeddimensions {
        label: "Dim rank by items"

        cell custom {
          column: forrankeddimensions
          row: rankeddimensions
          formula #value {
            value: value[column = /totalrankscore, row = /dimensions.%/both]
          }
          formatString: "{value}"
        }
      }

      column #dimensionlabel {
        label: "Dimension"
        cell custom #cell {
          // row: items
          // column: dimensionlabel
          expression #dimensionlabel {

            value: aggText(.dg1_dimensions:label, ", ")
          }
          formatString: ""
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
        }
      }

      column #totalrankscore {
        label: "Total Rank"
        hide: false
        cell custom {
          column: totalrankscore
          row: items
          formula #averagerank {
            value: 0 - average(value[column = /favorablerank], value[column = /cofrank2], value[column = /ranknormgap])
          }
          rank #value {
            mode: all
            sourceValue: averagerank
            dimension: rows
          }
          formatString: " {value}{averagerank} "
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
        }
      }

//needs to be the one allowed global cell
      cell custom {
        column: totalrankscore
        row: dimensions
        formula #value {
          value: min(value[column = /totalrankscore, row = items.*])
        }
        formatString: "{value}"
      }
      column #cofrank2 {
        hide: false
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: AllData//@dtscopeprint.m.data.scope.scopetouse
        }
        label: "Highest DIM Impact Rank"
        cell {
          row: items
          column: cofrank2
          value: DenseRankRev(correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)) //DenseRank?
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
        }
      }
      column #favorablerank {
        hide: false
        label: "Lowest Score Rank"
        cell custom {
          row: items
          column: favorablerank
          expression #value {
            value: isNull(Rank(:itemTopTwo()), 0)
          }
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
          formatString: "{value}"
        }
      }
      column #ranknormgap {
        hide: false
        label: "Worst Gap To Norm Rank"
        cell custom {
          row: items
          column: ranknormgap

          formula #normgapreal { //normgap
            value: value[column = /norm] - value[column = /favorable]
          }
          formula #normgap {
            value: isNull(normgapreal[], "")
          }

          rank #value {
            mode: all
            sourceValue: normgap
            dimension: rows
          }
          formatString: "{value}"
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
        }
      }
//*******************columns********************************

      column #norm {
        hide: false

        label: "norm"
        cell custom {
          row: items
          column: norm
          lookup value #normscore {
            source: norms
            mapping value {
              value: "2Fetch" //@benchmarksListItemsSelector.selected
              selector: NormId
            }
            mapping value {
              selector: ResponseValue
              value: 6
            }
            mapping header {
              header: 'items'
              selector: QuestionId
            }
            value: ResponseCount
          }
          formula #value {
            value: normscore[] / 1000
            formatter: percentNoDecimal
          }
          formatString: "{value}"
        }
      }
      column #favorable {
        label: "Total Favorable Score"
        filter expression {
          value: @cp.currentwave AND @cp.completes
        }
        cell custom {
          row: items
          column: favorable

          expression #value {
            value: :itemTopTwo()
            formatter: percentNoDecimal
          }
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
          formatString: "{value}"
        }
      }
    } //end dg
    map #map {
      from: rankeddimensions
      to:  {
     //   totalrankscore: this.totalrankscore.value
        dimensionlabel: this.dimensionlabel.dimensionlabel
//        sequenceid: this.norm.sequenceid
//        coefficient: this.cof.value
//        cofrank: this.cofrank.value
//        overall: this.overall.value
//        priorcycle: this.priorcycle.value
//        norm: this.norm.value
//        favorable: this.favorable.value
//        label: this._label.value
//        _id: this._id.value
      }
      toRecord byIndex {

      }
    }


  } //end dt
  dataTable #dtscope {
    dataGrid #dataGridWidget_2 {
      label: "Finding level with 30 or more"
      size: "large"
      row #row {
        label: "count completes in currentwave"

      }
      column #scope {
        label: "scope to use"
        cell custom {
          formula #scopetouse {
            value: IIF(value[column = /self] > 30, "ParentsFromCurrent 0", IIF(value[column = /parent1] > 30, "ParentsFromCurrent 1", IIF(value[column = /parent2] > 30, "ParentsFromCurrent 2", "ParentsFromCurrent 3")))

          }
          formatString: "{scopetouse} "

        }
      }
      column #self {
        label: "SELF"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: "ParentsFromCurrent 0"
        }
        cell #cell {
          value: count(:, @cp.completes AND @cp.currentwave)
        }
      }
      column #parent1 {
        label: "parent1"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: "ParentsFromCurrent 1"
        }
        cell #cell {
          value: count(:, @cp.completes AND @cp.currentwave)
        }
      }
      column #parent2 {
        label: "parent2"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: "ParentsFromCurrent 2"
        }
        cell #cell {
          value: count(:, @cp.completes AND @cp.currentwave)
        }
      }
    }
    map #m {
      from: row
      //ifEmpty: "-"
    }
  }

  dataTable #comparisonIndexYear {
    dataGrid {



      row #r {
      }

      column #currentCycle {
        filter expression {
          value: @cp.currentwave
        }
        cell {
          value: :engagementscore()
        }
      }

      column #overall {
        filter expression {
          value: @cp.currentwave
        }
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: AllData
        }
        cell {
          value: :engagementscore()
        }
      }

      column #yearWave {
        filter expression {
          value: @comparisonPeriodSelector.selected.filter
        }
        cell {
          value: :engagementscore()
        }
      }

      column #norm {
        cell {
          value: lookup value {
            source: KeyMetricNorm
            mapping value {
              value: @benchmarksListItemsSelector.selected
              selector: NormId
            }
            value: KeyMetricScore
          }
        }
      }
    }

    map #m {
      from: r
    }
  }

  dataTable #categoryList {
    dataGrid #dataGridWidgetCats {
      viaStrategy: shortest

      column #favScores {
        cell custom {
          expression #count {
            value: count(.dg1_dimensionScore:dimensionScoreValue)

          }
          expression #toofewtext {
            value: @cp.toofewresponses

          }
          formula #value {
            value: IIF(count[] < @cp.confidentiality, toofewtext[], score[])
          }
          expression #score {
            value: :dimensionTopTwoNEW2()
          }
          formula #value2 {
            value: IsNull(score[], "na")
          }
          headerInfo #label {
            headerId: cats
            type: label
          }
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }
          formatString: "{label} - {value} {count}"

        }
      }

      column #favScoresPrev {
        filter expression {
          value: @cp.previouswave
        }
        cell custom {
          expression #count {
            value: count(.dg1_dimensionScore:dimensionScoreValue)

          }
          expression #toofewtext {
            value: @cp.toofewresponses

          }
          formula #value {
            value: IIF(count[] < @cp.confidentiality, toofewtext[], score[])
          }
          expression #score {
            value: :dimensionTopTwoNEW2()
          }
          formula #value2 {
            value: IsNull(score[], "na")
          }
          headerInfo #label {
            headerId: cats
            type: label
          }
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }
          formatString: "{label} - {value} {count}"

        }

      }

      column #microchart {
        cell microchart {
          value: sum(.dg1_dimensionScore:favorabilityCounts2point)
          microchart pie {
          }
        }
      }

      column #diff {
        cell custom {
          formula #value {
            value: value[column = /favScores] - value[column = /favScoresPrev]
          }

          formula #value2 {
            value: IsNull(value[], "na")
            formatter: upordown
          }

          formula #color {
            value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
          }

          headerInfo #label {
            headerId: cats
            type: label
          }

          formatString: '<span style ="color:{color}">{value} {value2}</span>'
          //formatString: '{label} - {value}'
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }

        }
      }
      row cut #cats {
        value: .dg1_dimensionScore:dg1_dimensionScore
        total: "none"
        filter expression #expressionFilter {
          value: :keyindices()
        }
      }

      removeEmptyRows: true
      removeEmptyColumns: true
    }

    map #m {
      from: cats
      ifEmpty: "-"
    }
  }

  dataTable #top3dimcorr {
    dataGrid #dimqatable {//Start of My Team View Key Drivers
      label: "Top 3 DIM corr between other dims and Engagement"
      size: large
      cardCorners: 10px
      viaStrategy: shortest
      filter expression {
        value: .dg1_dimensions:Id != "Engagement" AND .dg1_dimensions:Id != "Engagement_Legacy" AND .dg1_dimensions:Id != "Intent_to_stay"
      }
      sort rows {
        sortBy: "/cof"
        sortOrder: descending
        //takeTop: 3
      }

      row list #dimensions {
        total: none
        value: ""//.dg1_dimensions:id
        table: .dg1_dimensions:
      }

      column #_label {
        label: "dimlabel"
        cell {
          value: .dg1_dimensions:id
        }
      }
      column #_id {
        label: "Dim id"
        cell {
          value: .dg1_dimensions:id + "" //calls the code
        }
      }
      column #cofrank {
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }
        hide: false
        label: "Highest Impact Rank"
        cell {
          value: RankRev(correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension))
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
        }
      }
      column #cof {
        hide: false
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }

        label: "Correlation"
        cell {
          value: correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)
        }
      }
      column #favorable {
        label: "Total Favorable Score"
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }
      }
      column #overall {
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }
        hide: false
        label: "overall"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: AllData
        }

      }
      column #priorcycle {
        hide: false
        label: "priorcycle"
        filter expression #tempcyclefilter {
          value: @cp.previouswave
        }
      }

      column #norm {
        hide: false
        cell custom {
          row: dimensions
          expression #mean {
            value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
       // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)

      // no. of questions behind each norm:  value: count(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue= 6 AND momentum_norms_legacy.ResponseCounts:NormId= @benchmarksListItemsSelector.selected)
     // check against dg on QA page

          }
          formula #value {
            value: mean[] / 1000
            formatter: percentNoDecimal

          }
          expression #sequenceid {
            value: .dg1_dimensions:sequenceId
          }
          formatString: "{value}"

        }
        label: "norm"
      }


      cell custom {
        row: dimensions
        column: favorable, overall,priorcycle
        expression #value {
          value: :dimensionTopTwoNEW2()
          formatter: percentNoDecimal
        }
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
        formatString: "{value}"

      }
    }

    map #map {
      from: dimensions
      to:  {
       // totalrankscore: this.totalrankscore.value
//dimensionlabel: this.dimensionlabel.value
        sequenceid: this.norm.sequenceid
        coefficient: this.cof.value
        cofrank: this.cofrank.value
        overall: this.overall.value
        priorcycle: this.priorcycle.value
        norm: this.norm.value
        favorable: this.favorable.value
        label: this._label.value
        _id: this._id.value
      }
      toRecord byIndex {

      }
    }
  }

  widget canvas #HealthCheckWidget {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    label: "Health Check"
    container: container position {
      width: 1368px
      height: "489px"
      area #area_37 {
        position: "absolute"
        top: "160px"
        left: "521px"
      }
      area #area_36 {
        position: "absolute"
        top: "160px"
        left: "1070px"
      }
      area #area_35 {
        position: "absolute"
        top: "160px"
        left: "106px"
      }
      area #headerarea {
        position: "absolute"
        top: "0px"
        left: "18px"
      }
      area #headerarea_2 {
        position: "absolute"
        top: "37px"
        left: "18px"
      }
      area #headerarea_3 {
        position: "absolute"
        top: "20px"
        left: "910px"
      }
      area #area {
        position: "absolute"
        top: "177px"
        left: "106px"
      }
      area #area_2 {
        top: "223px"
        left: "172px"
        position: "absolute"
      }
      area #area_3 {
        top: "289px"
        left: "245px"
        position: "absolute"
      }
      area #area_4 {
        top: "321px"
        left: "245px"
        position: "absolute"
      }
      area #area_5 {
        position: "absolute"
        top: "287px"
        left: "123px"
      }
      area #area_6 {
        position: "absolute"
        top: "321px"
        left: "139px"
      }
      area #area_8 {
        position: "absolute"
        top: "176px"
        left: "1097px"
      }
      area #area_10 {
        position: "absolute"
        top: "240px"
        left: "1047px"
      }
      area #area_11 {
        position: "absolute"
        top: "272px"
        left: "1068px"
      }
      area #area_12 {
        position: "absolute"
        top: "308px"
        left: "1047px"
      }
      area #area_13 {
        position: "absolute"
        top: "83px"
        left: "358px"
      }
      area #area_14 {
        top: "237px"
        left: "1229px"
        position: "absolute"
      }
      area #area_15 {
        position: "absolute"
        top: "228px"
        left: "1213px"
      }
      area #area_16 {
        position: "absolute"
        top: "273px"
        left: "1229px"
      }
      area #area_17 {
        position: "absolute"
        top: "265px"
        left: "1213px"
      }
      area #area_18 {
        position: "absolute"
        top: "311px"
        left: "1233px"
      }
      area #area_19 {
        position: "absolute"
        top: "303px"
        left: "1213px"
      }
      area #benchmarkChart_Marker {
        position: "absolute"
        top: "378px"
        left: "430px" //offset 20 to get it precise
      }
      area #benchmarkChart_TopLabel {
        position: "absolute"
        top: "378px"
        left: "450px"
      }
      area #benchmarkChart_BottomLabel {
        position: "absolute"
        top: "378px"
        left: "450px"
      }
      area #benchmarkChart_TopQuartValue {
        position: "absolute"
        top: "74px"
        left: "7px"
      }
      area #benchmarkChart_BottomQuartValue {
        position: "absolute"
        top: "74px"
        left: "102px"
      }
      area #area_31 {
        position: "absolute"
        top: "374px"
        left: "407px"
      }
      area #divider_left {
        position: "absolute"
        top: "170px"
        left: "358px"
      }
      area #divider_right {
        position: "absolute"
        top: "170px"
        left: "1050px"
      }
      background: #ffffff
      area #area_33 {
        position: "absolute"
        top: "240px"
        left: "598px"
      }
    }
    tile text #headertextTile {
      value: "Health Check"
      areaId: "headerarea"
      style #style {
        fontSize: 18
        fontWeight: "bold"
      }
    }
    tile text #headertextTile_2 {
      value: "Reflection of employees' current feelings towards their experience at the company including their job, role, and the organization overall."
      areaId: "headerarea_2"
      style #style {
        fontSize: 18
        fontWeight: 600
        fontFamily: "Source Sans Pro"
      }
    }


    tile text #textTile {
      value: IIF(@cp.responseratehide = false, "Participation Rate", "Participation Rate")
      areaId: "area"
      style #style {
        fontSize: 23
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        textAlign: "center"
        width: "220px"
        height: "46px"
      }
    }
    tile value #valueTile {
      areaId: "area_2"
      label: "Response Rate (Does not include partials)"
      value: @DTResponseRates.m.data.responseRate.currentResponseRate
      style #style {
        justifyContent: "center"
        alignItems: "start"
        fontSize: 27
        width: "88px"
        height: "66px"
        color: #7d7d7d
        fontFamily: "Trebuchet MS"
      }
      valueFormatter: percentNoDecimal
    }
    tile value #valueTile_2 {
      areaId: "area_3"
      label: "Number of responses"
      value: @DTResponseRates.m.data.responses.currentResponses
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 16
        fontWeight: "bold"
        color: #7d7d7d
        fontFamily: "Trebuchet MS"
      }
      valueFormatter: numberFormatter
    }
    tile value #valueTile_3 {
      areaId: "area_4"
      label: "Number of invited"
      //hardcode
      value: IIF(@cp.responseratehide = false, @DTResponseRates.m.data.respondents.currentRespondents)
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 16
        color: #7d7d7d
        fontFamily: "Trebuchet MS"
        fontWeight: "bold"
      }
      valueFormatter: numberFormatter
    }
    tile text #textTile_2 {
      value: "Completed"
      areaId: "area_5"
      style #style {
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "113px"
        height: "32px"
        textAlign: "right"
        fontSize: 18
      }
    }
    tile text #textTile_3 {
      value: IIF(@cp.responseratehide = false, "Invited", " ")
      areaId: "area_6"
      style #style {
        fontSize: 18
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "93px"
        height: "32px"
        textAlign: "right"
      }
    }
    //PRY
    tile text #textTile_4 {
      value: "Comparisons"
      areaId: "area_8"
      style #style {
        fontSize: 23
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "193px"
        height: "32px"
        fontWeight: "bold"
      }
    }
    tile text #textTile_6 {
      value: @comparisonPeriodSelector.selectedLabel //"Prior Cycle:"
      areaId: "area_10"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "170px"
        height: "32px"
        fontWeight: "bold"
        textAlign: "right"
      }
    }
    tile text #textTile_7 {
      value: "Company Overall:"
      areaId: "area_11"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "149px"
        height: "32px"
        fontWeight: "bold"
        textAlign: "right"
      }
    }
    tile text #textTile_8 {
      value: @benchmarksListItemsSelector.selectedLabel
      areaId: "area_12"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "170px"
        height: "32px"
        fontWeight: "bold"
        textAlign: "right"
      }
    }
    tile text #textTile_9 {

      value: " " //Insight Text
      areaId: "area_13"
      style #style {
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        textAlign: "center"
        width: "695px"
        height: "61px"
        fontSize: 25
      }
      label: "Insight Text"
    }
    tile value #valueTile_5 {
      areaId: "area_14"
      label: "Engagement Prior Year"
      valueFormatter: bigNumberFormatter
      value: @comparisonIndexYear.m.data.currentCycle.value - @comparisonIndexYear.m.data.yearWave.value
      style #style {
        justifyContent: "center"
        alignItems: "center"
        fontSize: 18
        width: "43px"
        height: "35px"
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
      }
    }
    tile text #textTile_10 {
      value: " "
      areaId: "area_15"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "32px"
        height: "43px"
        fontWeight: "bold"
      }
      label: "Prior Indicator"
      switch #switch {
        linkedToValue: @valueTile_5
        case #case {
          condition: "<0"
          body #body {
            value: "↓"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 25
              fontFamily: "Trebuchet MS"
              color: #7d7d7d
              textAlign: "center"
            }
          }
        }
        case #case_2 {
          condition: ">0"
          body #body {
            value: "↑"
            style #bodyStyle {
              fontSize: 25
              textAlign: "center"
              color: #7d7d7d
            }
          }
        }
        case #case_3 {
          condition: "=0"
          body #body {
            value: "↔"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 15
              color: #7d7d7d
            }
          }
        }
      }
    }
    tile value #valueTile_6 {
      areaId: "area_16"
      label: "Engagement Overall"
      value: @comparisonIndexYear.m.data.currentCycle.value - @comparisonIndexYear.m.data.overall.value
      style #style {
        justifyContent: "center"
        alignItems: "center"
        fontSize: 18
        width: "43px"
        height: "35px"
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
      }
      valueFormatter: bigNumberFormatter
    }
    tile text #textTile_11 {
      value: " "
      areaId: "area_17"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "32px"
        height: "43px"
        fontWeight: "bold"
      }
      label: "Prior Indicator"
      switch #switch {
        linkedToValue: @valueTile_6
        case #case {
          condition: "<0"
          body #body {
            value: "↓"
            style #bodyStyle {
              fontSize: 25
              fontFamily: "Trebuchet MS"
              color: #7d7d7d
              textAlign: "center"
            }
          }
        }
        case #case_2 {
          condition: ">0"
          body #body {
            value: "↑"
            style #bodyStyle {
              fontSize: 26
              textAlign: "center"
            }
          }
        }
        case #case_3 {
          condition: "=0"
          body #body {
            value: "↔"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 15
              color: #7d7d7d
            }
          }
        }
      }
    }
    tile value #valueTile_7 {
      areaId: "area_18"
      label: "Top Quartile"
      value: @comparisonIndexYear.m.data.currentCycle.value - @comparisonIndexYear.m.data.norm.value

      style #style {
        justifyContent: "center"
        alignItems: "center"
        fontSize: 18
        width: "43px"
        height: "35px"
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
      }
      valueFormatter: bigNumberFormatter
    }
    tile text #textTile_12 {
      value: " "
      areaId: "area_19"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "32px"
        height: "43px"
        fontWeight: "bold"
      }
      label: "Prior Indicator"
      switch #switch {
        linkedToValue: @valueTile_7
        case #case {
          condition: "<0"
          body #body {
            value: "↓"
            style #bodyStyle {
              fontSize: 25
              fontFamily: "Trebuchet MS"
              color: #7d7d7d
              textAlign: "center"
            }
          }
        }
        case #case_2 {
          condition: ">0"
          body #body {
            value: "↑"
            style #bodyStyle {
              fontSize: 26
              textAlign: "center"
            }
          }
        }
        case #case_3 {
          condition: "=0"
          body #body {
            value: "↔"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 15
              color: #7d7d7d
            }
          }
        }
      }
    }
    //Begin Chart

    tile value #topQuartileValue {
      areaId: "benchmarkChart_TopQuartValue"
      label: "75th"
      value: 85
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 55
        width: "86px"
        height: "85px"
        color: "#ffffff"
      }
    }
    tile value #bottomQuartileValue {
      areaId: "benchmarkChart_BottomQuartValue"
      label: "25th"
      value: 55
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 55
        width: "86px"
        height: "85px"
        color: "#ffffff"
      }
    }

    tile text #textTile_22 {
      value: "  "
      areaId: "area_35"
      style #style {
        fontSize: 24
        width: "220px"
        height: "204px"
      }
      label: "Participation Box"
    }
    tile text #textTile_23 {
      value: "  "
      areaId: "area_36"
      style #style {
        fontSize: 24
        width: "220px"
        height: "204px"
      }
      label: "Comparison Box"
    }

    tile custom #text {
      areaId: area_33
      formatString: 'Current Cycle<br><span style="font-size: 2em;">{value}</span>'
      expression #value {
        value: :engagementscorecurrentwave()
        formatter: percentNoDecimal
      }
      expression #targetValue {
        value: :engagementscorepreviouswave()
        formatter: percentNoDecimal
      }
      formula #diffToTarget {
        value: value[] - targetValue[]
        formatter: percentNoDecimal
      }
      // switch {
      //   byValue: diffToTarget
      //   case {
      //     condition: "<0"
      //     body {
      //       formatString: 'Current Cycle <br><span style="font-size: 2em;">{value}</span><br>is below target<br>{diffToTarget}'
      //     }
      //   }
      //   case {
      //     condition: ">0"
      //     body {
      //       formatString: 'Your value <br><span style="font-size: 2em;">{value}</span><br>is above target<br>{diffToTarget}'
      //     }
      //   }
      //   case {
      //     condition: "=0"
      //     body {
      //       formatString: 'Your value<br><span style="font-size: 2em;">{value}</span><br>is at target'
      //     }
      //   }
      //   case {
      //     condition: isNull
      //     body {
      //       formatString: 'Your value<br><span style="font-size: 2em;">{value}</span>'
      //     }
      //   }
      // }
      style {
        fontSize: 22px
        fontWeight: bold
        textAlign: center
      }
    }
    tile custom #gauge {
      formatString: ""
      areaId: area_37
      style {
        width: '100%'
        height: '100%'
      }
      expression #value {
        value: :engagementscorecurrentwave()
      }
      expression #minValue {
        value: 0
      }
      expression #maxValue {
        value: 100
      }
      expression #targetValue {
        value: :engagementscorepreviouswave()
      }
      formula #belowTarget {
        value: value[]//IIF(value[] < targetValue[], value[])
      }
      formula #aboveTarget {
        value: value[]//IIF(value[] >= targetValue[], value[])
      }
      formula #noTarget {
        value: value[]//IIF(isNull(targetValue[], true), value[])
      }
        /*
        later
        formula #zones {
          value = zones[tile = datum]
        }
        */

      view svg {

          //viewBox: "0 0 100 100"
        group polar #gauge {
          cx: 50
          startAngle: 180
          endAngle: 0
          max: this.maxValue
          min: this.minValue
          shape sectors #zones {
            valueType: 'cumulative'
            innerRadius: '36%'
            outerRadius: '39%'
            padAngle: 0.4
            palette: zones
              /*
              later
              value: this.zones
              */
            value: {value: 60 label: "Bottom Quartile"}, {value: 80 label: "Moderate Zone"}, {value: 100 label: "Top Quartile"}, {value: 47 label: "third"}, {value: 50 label: "forth"}, {value: 65 label: "third"}, {value: 80 label: "third"}, {value: 100 label: "third"}
          }
          shape sectors #background {
            innerRadius: '42%'
            outerRadius: '48%'
            palette: metricBackgroundPalette
            value:  {
              value: this.maxValue
              label: ""
            }
          }
          shape sectors #metric {
            palette: metricValuePalette
            innerRadius: '42%'
            outerRadius: '48%'
            value: { value: this.belowTarget label: "" }, { value: this.aboveTarget label: "" }, { value: this.noTarget label: "" }
          }
          shape custom #target {
            angle: this.targetValue
            radius: '50%'
            // value: '<path stroke=black d="M0,0 L-10,0" />'
            value: '<line x1="0" y1="0" x2="9.5%" y2="0" style="stroke:black;stroke-width:1" />'
          }
          // shape custom #secondTarget {
          //   angle: this.secondTarget
          //   radius: '80%'
          //   value: '<path stroke="#777777" d="M0,0 L-10,0" />'
          // }
          shape custom #scaleMin {
            angle: this.minValue
            radius: '45%'
            rotate: false
            value: '<text transform="translate(0,6)" font-size=7 text-anchor="middle" fill="grey">{this.minValue}</text>'
          }
          shape custom #scaleMax {
            angle: this.maxValue
            radius: '45%'
            rotate: false
            value: '<text transform="translate(0,6)" font-size=7 text-anchor="middle" fill="grey">{this.maxValue}</text>'
          }
        }
      }
    }

    tile custom #legend {
      areaId: area_31
      formula #btext {
        value: @cp.bottomquartiletext + " (0-" + @cp.bottomquartileastext + "%)  "
      }
      formula #mtext {
        value: @cp.moderatezonetext + " (" + @cp.bottomquartileastext + "-" + @cp.moderatezoneastext + "%)  "
      }
      formula #ttext {
        value: @cp.topquartiletext + " (" + @cp.moderatezoneastext + "-" + @cp.topquartileastext + "%)"
      }
      formula #trtext {
        value: @cp.priorcycletext
      }
      formatString: '<span style="color:#D03131;">▉</span> {btext} <span style="color:#FCB429;">▉</span> {mtext} <span style="color:#5C2E8E;">▉</span> {ttext} <br><span style="font-weight: bold;">—</span> {trtext} '

      style {
        fontSize: 16px
        alignItems: "center"
        textAlign: "center"
        fontFamily: "Trebuchet MS"
        fontWeight: bold
      }
      label: "customlegend"
    }


    tile image #left_divider {
      value: @cp.dividervertical
      areaId: "divider_left"
      style #style {
        width: "3px"
        height: "65px"
      }
      label: "Divider"
    }
    tile image #right_divider {
      value: @cp.dividervertical
      areaId: "divider_right"
      style #style {
        width: "3px"
        height: "65px"
      }
      label: "Divider"
    }
    cardTransparent: true

  }
  widget headline #keyindices {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }

    label: "Key Indices"
    container: container flex {
      flexDirection: row
      flexWrap: wrap
      area #donuts {
        width: '100%'
        display: flex
        paddingLeft: 30px
        paddingBottom: 10px
        justifyContent: "center"//"space-evenly"
      }

    }

    tile set #tileSet {
      areaId: donuts

      container: container grid {
        rows: 'A A A A A'
        justifyContent: spaceEvenly

      }
      itemContainer: container flex {
        flexDirection: column
        width: 250px

        area #label {
          height: 40px
          display: block
          textAlign: "center"
        }
        area #main {
          position: relative
          area #donut {
          }
          area #center {
            position: absolute
            top: 30px

          }
          area #indicator {
            position: absolute
            left: 95px
            top: 100px
          }
          area #arrow {
            position: absolute
            left: 130px
            top: 100px
          }

        }

      }

      breakdownBy inlineData {
        value: @categoryList.m.data
      }

      tile value #diff {
        areaId: indicator
        value: this.diff.value
        valueColorFormatter: tileset
        fontSize: 24
      }

      tile value #arrow {
        value: this.diff.value2
        valueFormatter: upordown
        valueColorFormatter: tileset
        areaId: arrow
        fontSize: 24
      }

      tile text #textTile {
        areaId: label
        value: this.favScores.label
        fontSize: 18
        fontWeight: 'bold'
        textAlign: "center"
      }

      tile value #valueTile {
        areaId: center
        value: this.favScores.value
        fontSize: 45
        valueFormatter: percentNoDecimal
      }
      tile microchart #kpiMicrocharts {
        areaId: donut
        value: this.microchart.value
        format: floatDefaultFormatter

        microchart pie {
          donutWidth: 20%
          startAngle: 220
          endAngle: -40
          palette: mercer_1_color
          valuePosition: none
          showTooltip: false
        }
        style {
          height: 170px
          width: 200px

        }
      }

    }
    size: large
  }



  widget chart #chartWidget {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }

    label: "Engagement Distribution"
    series #series {
      chart bar #barChart {
        mode: "clustered"
        palette: 'mercer'
      }

      value: count(.response:responseid)
      palette: mercer
      percentOver: "categories"
      format: percentNoDecimal
      breakdownBy cut #cutBreakdownby {
        value: :wavereverted2
        categories: @cp.engagementmodelB_yearcategories

      }
      label: "Engagement Levels"
    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    category cut #cutCategory {
      value: .response:EngagementDistribution

    }
    size: large


    series #norms {
      label: @benchmarksListItemsSelector.selectedLabel
      chart line #barChart {
      }
      value: lookup value {
        source: keymetricdistributions
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping header {
          header: cutCategory
          selector: Level
        }
        value: Norm
      }
      palette: palette_5
    }

    legend: "bottomCenter"

    palette: mercer
  }
  widget dataGrid #dataGridWidget {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    filter expression {
      value: @cp.currentwave

    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Manager_support" //Fetch custom
    }
    label: "What Are My Top Scoring Questions?"
    size: "large"
    //viaStrategy: shortest
    select #distributionType {
      Label: "Score Distribution"
      options: item {
        label:"Favorable"
        value:{
            question: .dg1_questionScore:twoPoint
            palette: 'mercer_1_color'
            showlegend:false
            text: "Total Favorable Score"
        }
      },
      item{
        label: "Full Distribution"
        value:{
          question: .dg1_questionScore:fourpoint
            palette: mercerlist
            showlegend:true
            text: "Full Distribution"
        }
      }

    }
    via: .dg1_dimension_question:
    sort rows {
      sortBy: "/favScore"
      sortOrder: descending
      takeTop: 5

    }

    row cut #row {
      value: .dg1_questionScore:dg1_questionScore

      total: "none"
      showLabel: false
      label: "Item"
    }

//to display multiple items in the table
    column #column_3 {
      label: "Dimension"
      cell #cell {
        value: aggText(.dg1_dimensions:label, ", ") //max(.dg1_dimensions:label)
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #favScore {
      cell {
        value: :itemTopTwo()

        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }


      }
      label: "Total Favorable Score"
    }

    column #favChart {
      width: 500px

      cell microchart #cell {
        suppression respondentsBase {
          threshold: @cp.confidentiality

        }
        microchart stacked100PercentBar #barMicrochart {
          palette: @distributionType.selected.palette
          percentFormat: percentNoDecimal
          showLegend: @distributionType.selected.showlegend
        }

        value: count(.dg1_questionScore:)

        palette: mercer
        breakdownBy cut #cutBreakdownby {
          value: @distributionType.selected.question// .dg1_questionScore:twoPoint
        }
      }
      label: @distributionType.selected.text
    }
  }

  widget actionPlannerDataGrid #rankedfocuseditems {
    hide: @cp.hiderankedfocusitems
    label: "Ranked Focus Items"
    size: large
    cardCorners: 10px

    suppressRule {
      criteria: @cp.currenthasdata = false
    }

    viaStrategy: shortest

    select #showtopselector {
      options: @rankedfocusitems.items
      view list {
        direction: horizontal
      }
    }
    sort rows {
      sortBy: "/totalrankscore" //"/totalrankrwa" //
      sortOrder: ascending
      takeTop: @showtopselector.selected.top
    }

    filter expression {
      value: @cp.currentwave
    }
    filter expression {
      value: .dg1_dimension_question:dimensionId != "Mental_Health" AND .dg1_dimension_question:dimensionId != "Manager_support" AND .dg1_dimension_question:dimensionId != "Talent_Focus" AND .dg1_dimension_question:dimensionId != "Agility" AND .dg1_dimension_question:dimensionId != "Engaging_Leadership" AND .dg1_dimension_question:dimensionId != "Positive_Duty"

    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Engagement" AND .dg1_dimension_question:dimensionId != "Engagement_Legacy" AND .dg1_dimension_question:dimensionId != "Intent_to_stay"
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    // filter expression #removenonRWA2 {
    //   value: .dg1_questions:Id != "EN0290" AND .dg1_questions:Id != "EN0556" AND .dg1_questions:Id != "EN0558" AND .dg1_questions:Id != "EN0467" AND .dg1_questions:Id != "EN0559"
    // }
    filter expression #exclude_positive_duty {
      value: .dg1_questions:Id != "Q66" AND .dg1_questions:Id != "Q67" AND .dg1_questions:Id != "Q68" AND .dg1_questions:Id != "Q69" AND .dg1_questions:Id != "Q70" AND .dg1_questions:Id != "Q71" AND .dg1_questions:Id != "Q72"
    }
    filter expression #exclude_manager_support {
      value: .dg1_questions:Id != "Q75" AND .dg1_questions:Id != "Q76" AND .dg1_questions:Id != "Q77" AND .dg1_questions:Id != "Q78" AND .dg1_questions:Id != "Q79" AND .dg1_questions:Id != "Q80" AND .dg1_questions:Id != "Q81" AND .dg1_questions:Id != "Q82" AND .dg1_questions:Id != "Q83" AND .dg1_questions:Id != "Q84" AND .dg1_questions:Id != "Q85" AND .dg1_questions:Id != "Q86" AND .dg1_questions:Id != "Q87"
    }


    row list #items {
      total: none
      value: .dg1_questions:id
      table: .dg1_questions:
    }

    column #dimensionlabel {
      label: "Dimension"

      cell #cell {
        value: Max(toText(answerText(.dg1_dimension_question:dimensionId))) //max just picks one of the dims to avoid relation violation
        style #body {
          alignItems: 'start'
        }
      }
    }

    column #cofrank2 { //this is now the rwa going into the sorting
      hide: true
      cell custom {
        lookup value #value {
          source: RWA
          mapping value {
            value: "1Fetch"
            selector: NormId
          }
          mapping header {
            header: items
            selector: id
          }
          value: rwacofrank
        }
        rank #notneeded {
          mode: all
//          sourceValueId: value[]
          sourceValue: lookuprwa
          dimension: rows
        }

        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
      label: "rwacof"
    }
    column #totalrankrwa {
      hide: true
      label: "Total Rank uploaded"
      cell custom {
        lookup value #value {
          source: RWA
          mapping value {
            value: "1Fetch"
            selector: NormId
          }
          mapping header {
            header: items
            selector: id
          }
          value: rwarank
        }

        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #totalrankscore {
      label: "Total Rank"
      hide: false
      cell custom {
        formula #averagerank {
          value: 0 - average(value[column = /favorablerank], value[column = /cofrank2], value[column = /ranknormgap])

        }
        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: averagerank
          dimension: rows
        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #cofrank2Forsta {
      hide: true
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: @dtscope.m.data.scope.scopetouse

      }
      label: "Highest DIM Impact Rank"
      cell {
        value: DenseRankRev(correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)) //DenseRank?
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #favorablerank {
      hide: true
      label: "Lowest Score Rank"
      cell custom {

        expression #value {
          value: isNull(Rank(:itemTopTwo()), 0)
        }
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
        formatString: "{value}"
      }
    }

    column #ranknormgap {
      hide: true
      label: "Worst Gap To Norm Rank"
      cell custom {

        formula #normgapreal { //normgap
          value: value[column = /norm] - value[column = /favorable]
        }
        formula #normgap {
          value: isNull(normgapreal[], "")
        }
        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: normgap
          dimension: rows
        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #cofrank {
      hide: true
      label: "Highest Item Impact Rank"
      cell {
        value: RankRev(correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension))
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column #favorable {
      label: "Favorable Score"
      hide: true
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave

      }
      label: @distributionType.selected.text
      width: 200px

      cell microchart {
        suppression respondentsBase {
          threshold: @cp.confidentiality

        }
        column: distribution
        value: count(.dg1_questionScore:) //runs on questionscore too
        breakdownBy cut {
          value: @distributionType.selected.question
        }

        microchart stacked100PercentBar {
          palette: @distributionType.selected.palette//question
          percentFormat: percentNoDecimal
          showLegend: @distributionType.selected.showlegend
        }
      }
    }
    column #cof {
      hide: true
      label: "Impact DIMS"
      cell {
        value: correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)
      }
    }

    column #overall {
      hide: true
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }
    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @cp.previouswave
      }
    }

    column #normgapcol {
      label: "Distance from Norm"
      hide: false
      cell custom {
        formula #value {
          value: value[column = /favorable] - value[column = /norm]
          formatter: bigNumberFormatter
        }
        formula #vsarrow {
          value: isNull(value[], "")
          formatter: upordown
        }
        formula #color {
          value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
        }

        formatString: '<span style ="color:{color}">{value} {vsarrow} </span>'
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #norm {
      hide: true
      cell custom {
        lookup value #mean {
          source: norms
          mapping value {
            value: @cp.defaultnorm
            selector: NormId
          }
          mapping value {
            selector: ResponseValue
            value: 6
          }
          mapping header {
            header: items
            selector: QuestionId
          }
          value: ResponseCount
        }
        formula #value {
          value: Round(mean[] / 1000, 0)
          formatter: percentNoDecimal
        }

        expression #sequenceid {
          value: .dg1_questions:sequenceId
        }
        formatString: "{value}"
      }
      label: "norm"
    }
    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide

      cell custom {
        row: items
        view: actionPlanner
        expression #id {
          value: toText(surveyDataset.items:id)
        }
        formatString: "Add plan"
      }
    }

    cell custom {
      row: items
      column: favorable, overall,priorcycle
      expression #value {
        value: :itemTopTwo()
          //formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}%"
    }
    description: "Improve your employees' engagement by focusing on these opportunity areas."
  }

//hidden due to few comments for finance
  // widget canvas #ImpactEngagement {
  //   hide: @cp.hideimpact

  //   cardCorners: 10px

  //   label: "FocusAreas"
  //   size: large
  //   container: container position {
  //     width: 1368px
  //     height: "875px"
  //     area #headerarea {
  //       position: "absolute"
  //       top: "0px"
  //       left: "18px"
  //     }
  //     area #headerarea_2 {
  //       position: "absolute"
  //       top: "37px"
  //       left: "18px"
  //     }

  //     area #area_8 {
  //       position: "absolute"
  //       top: "462px"
  //       left: "24px"
  //     }
  //     area #area {
  //       position: "absolute"
  //       top: "104px"
  //       left: "24px"
  //     }
  //     area #area_2 {
  //       position: "absolute"
  //       top: "103px"
  //       left: "470px"
  //     }
  //     area #area_3 {
  //       position: "absolute"
  //       top: "103px"
  //       left: "916px"
  //     }
  //     area #area_4 {
  //       position: "absolute"
  //       top: "122px"
  //       left: "337.15668296193076px"
  //     }
  //     area #area_5 {
  //       position: "absolute"
  //       top: "122px"
  //       left: "791px"
  //     }
  //     area #area_6 {
  //       position: "absolute"
  //       top: "122px"
  //       left: "1245px"
  //     }
  //     area #area_7 {
  //       position: "absolute"
  //       top: "480px"
  //       left: "37px"
  //     }
  //     area #area_9 {
  //       position: "absolute"
  //       top: "558px"
  //       left: "38px"
  //     }
  //     area #area_10 {
  //       position: "absolute"
  //       top: "141px"
  //       left: "52px"
  //     }
  //     area #area_11 {
  //       top: "175px"
  //       left: "52px"
  //       position: "absolute"
  //     }
  //     area #area_12 {
  //       position: "absolute"
  //       top: "241px"
  //       left: "51px"
  //     }
  //     area #area_13 {
  //       top: "269px"
  //       left: "71px"
  //       position: "absolute"
  //     }
  //     area #area_15 {
  //       position: "absolute"
  //       top: "312px"
  //       left: "51px"
  //     }
  //     area #area_16 {
  //       top: "340px"
  //       left: "68px"
  //       position: "absolute"
  //     }
  //     area #area_17 {
  //       position: "absolute"
  //       top: "373px"
  //       left: "52px"
  //     }
  //     area #area_18 {
  //       position: "absolute"
  //       top: "397px"
  //       left: "67px"
  //     }
  //     area #area_19 {
  //       position: "absolute"
  //       top: "141px"
  //       left: "502px"
  //     }
  //     area #area_20 {
  //       position: "absolute"
  //       top: "175px"
  //       left: "502px"
  //     }
  //     area #area_21 {
  //       position: "absolute"
  //       top: "241px"
  //       left: "502px"
  //     }
  //     area #area_22 {
  //       position: "absolute"
  //       top: "269px"
  //       left: "519px"
  //     }
  //     area #area_23 {
  //       position: "absolute"
  //       top: "313px"
  //       left: "502px"
  //     }
  //     area #area_24 {
  //       position: "absolute"
  //       top: "340px"
  //       left: "519px"
  //     }
  //     area #area_25 {
  //       position: "absolute"
  //       top: "373px"
  //       left: "494px"
  //     }
  //     area #area_26 {
  //       position: "absolute"
  //       top: "397px"
  //       left: "514px"
  //     }
  //     area #area_27 {
  //       position: "absolute"
  //       top: "141px"
  //       left: "934px"
  //     }
  //     area #area_28 {
  //       position: "absolute"
  //       top: "175px"
  //       left: "934px"
  //     }
  //     area #area_29 {
  //       position: "absolute"
  //       top: "241px"
  //       left: "934px"
  //     }
  //     area #area_30 {
  //       position: "absolute"
  //       top: "269px"
  //       left: "952px"
  //     }
  //     area #area_31 {
  //       position: "absolute"
  //       top: "313px"
  //       left: "934px"
  //     }
  //     area #area_32 {
  //       position: "absolute"
  //       top: "341px"
  //       left: "954px"
  //     }
  //     area #area_33 {
  //       position: "absolute"
  //       top: "373px"
  //       left: "934px"
  //     }
  //     area #area_34 {
  //       position: "absolute"
  //       top: "397px"
  //       left: "946px"
  //     }
  //     area #area_35 {
  //       position: "absolute"
  //       top: "605px"
  //       left: "37px"
  //     }
  //     area #area_38 {
  //       position: "absolute"
  //       top: "558px"
  //       left: "1198px"
  //     }
  //     area #area_39 {
  //       position: "absolute"
  //       top: "603px"
  //       left: "470px"
  //     }
  //     area #area_40 {
  //       position: "absolute"
  //       top: "603px"
  //       left: "916px"
  //     }
  //     area #area_41 {
  //       position: "absolute"
  //       top: "731px"
  //       left: "37px"
  //     }
  //     area #area_42 {
  //       position: "absolute"
  //       top: "731px"
  //       left: "470px"
  //     }
  //     area #area_43 {
  //       position: "absolute"
  //       top: "731px"
  //       left: "916px"
  //     }
  //     area #area_44 {
  //       position: "absolute"
  //       top: "398px"
  //       left: "344px"
  //     }
  //     area #area_45 {
  //       position: "absolute"
  //       top: "395px"
  //       left: "786px"
  //     }
  //     area #area_46 {
  //       position: "absolute"
  //       top: "392px"
  //       left: "1245px"
  //     }
  //     area #area_47 {
  //       position: "absolute"
  //       top: "425px"
  //       left: "52px"
  //     }
  //     area #area_48 {
  //       position: "absolute"
  //       top: "425px"
  //       left: "502px"
  //     }
  //     area #area_49 {
  //       position: "absolute"
  //       top: "425px"
  //       left: "934px"
  //     }
  //     area #area_50 {
  //       position: "absolute"
  //       top: "20px"
  //       left: "1184px"
  //     }
  //     area #area_51 {
  //       position: "absolute"
  //       top: "275px"
  //       left: "50px"
  //     }
  //     area #area_52 {
  //       position: "absolute"
  //       top: "275px"
  //       left: "503px"
  //     }
  //     area #area_53 {
  //       position: "absolute"
  //       top: "275px"
  //       left: "936px"
  //     }
  //     area #area_54 {
  //       position: "absolute"
  //       top: "345px"
  //       left: "48px"
  //     }
  //     area #area_55 {
  //       position: "absolute"
  //       top: "346px"
  //       left: "502px"
  //     }
  //     area #area_56 {
  //       position: "absolute"
  //       top: "347px"
  //       left: "937px"
  //     }
  //   }

  //   tile text #headertextTile {
  //     value: "How To Positively Impact Engagement?"
  //     areaId: "headerarea"
  //     style #style {
  //       fontSize: 18
  //       fontWeight: "bold"
  //     }
  //   }
  //   tile text #headertextTile_2 {
  //     value: "Improve your employees' engagement by focusing on these opportunity areas."
  //     areaId: "headerarea_2"
  //     style #style {
  //       fontSize: 16
  //     }
  //   }
  //   tile text #textTile_38 {
  //     value: "View All Driver Items"
  //     areaId: "area_50"
  //     navigateTo: driveritemsmodal
  //     navigateOptions: "same_tab"
  //     style #style {
  //       fontSize: 16
  //       background: "#00aa56"
  //       borderRadius: "13.6px"
  //       color: '#ffffff'
  //       fontWeight: "bold"
  //     }
  //   }
  //   tile text #textTile {
  //     value: " "
  //     action setSelector {
  //       value: "1"
  //       select: @layoutselector
  //       compareBy: this.value.id
  //     }

  //     areaId: "area"
  //     style #style {
  //       fontSize: 60
  //       width: "428px"
  //       height: @layoutselector.selected.layouttablesquareoneheight + "px"
  //       background: @layoutselector.selected.layouttablesquareonecolor
  //       borderRadius: "14.559999999999999px"
  //     }
  //     label: "square1"
  //   }
  //   tile text #textTile_2 {
  //     value: " "

  //     action setSelector {
  //       value: "2"
  //       select: @layoutselector
  //       compareBy: this.value.id
  //     }
  //     areaId: "area_2"
  //     style #style {
  //       fontSize: 16
  //       width: "428px"
  //       height: @layoutselector.selected.layouttablesquaretwoheight + "px"
  //       background: @layoutselector.selected.layouttablesquaretwocolor
  //       borderRadius: "14.559999999999999px"
  //     }
  //     label: "square2"
  //   }
  //   tile text #textTile_3 {
  //     action setSelector {
  //       value: "3"
  //       select: @layoutselector
  //       compareBy: this.value.id
  //     }
  //     value: " "
  //     areaId: "area_3"
  //     style #style {
  //       fontSize: 60
  //       width: "429px"
  //       height: @layoutselector.selected.layouttablesquarethreeheight + "px"
  //       background: @layoutselector.selected.layouttablesquarethreecolor
  //       borderRadius: "16.48px"
  //     }
  //     label: "square3"
  //   }

  //   tile value #focusareascore {
  //     value: @layoutselector.selected.layouttablecurrentscore
  //     hide: true
  //   }
  //   tile text #textTile_9 {
  //     value: @layoutselector.selected.layouttablecurrentscoretext
  //     areaId: "area_7"
  //     style #style {
  //       fontSize: 35
  //       fontWeight: "bold"
  //       fontFamily: "Trebuchet MS"
  //       color: #7d7d7d
  //       textAlign: "center"
  //       width: "1296px"
  //       height: "61px"
  //       background: "#EDF4F7"
  //       borderRadius: "13.6px"
  //     }
  //     label: "insighttext"
  //   }

  //   tile text #textTile_8 {
  //     value: " "
  //     areaId: "area_8"
  //     style #style {
  //       fontSize: 60
  //       width: "1321px"
  //       height: "410px"

  //       background: "linear-gradient(225deg, #00ac41, #009de0)" //#0080A5
  //       borderRadius: "13.6px"
  //     }
  //     label: "square4"
  //   }
  //   tile text #textTile_10 {
  //     value: "Here Is What People Are Saying About " + IIF(@layoutselector.selected.id = "1", @top3dimcorr.map.data._0.label, IIF(@layoutselector.selected.id = "2", @top3dimcorr.map.data._1.label, @top3dimcorr.map.data._2.label))

  //     areaId: "area_9"
  //     style #style {
  //       fontSize: 24
  //       color: @layoutselector.selected.layouttablesquareonecolorreverse

  //       color: #fefbfb
  //     }
  //   }
  //   tile text #textTile_11 {
  //     value: @top3dimNew.map.data._0.dimensionlabel
  //     areaId: "area_10"
  //     style #focusareaheader {
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //     label: "top1label"
  //   }
  //   tile value #valueTile {
  //     areaId: "area_11"
  //     label: "PMscore"
  //     value: @top3dimcorr.map.data._0.favorable
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //     valueFormatter: percentNoDecimal
  //   }
  //   tile text #textTile_12 {
  //     value: @comparisonPeriodSelector.selectedLabel//"Prior Cycle"
  //     areaId: "area_12"
  //     style #style {
  //       fontSize: 16
  //       color: @layoutselector.selected.layouttablefontcolor1

  //       width: 157
  //     }
  //   }
  //   tile value #valueTile_2 {
  //     areaId: "area_13"
  //     label: "PMComparisonYearValue"
  //     value: @top3dimcorr.map.data._0.favorable - @top3dimcorr.map.data._0.priorcycle
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile text #textTile_13 {
  //     value: "vs Company Overall"
  //     areaId: "area_15"
  //     style #style {
  //       fontSize: 16
  //       width: "187px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile value #valueTile_3 {
  //     areaId: "area_16"
  //     label: "vscompanyoverall0"
  //     value: @top3dimcorr.map.data._0.favorable - @top3dimcorr.map.data._0.overall
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile text #textTile_14 {
  //     value: @benchmarksListItemsSelector.selectedLabel
  //     areaId: "area_17"
  //     style #style {
  //       fontSize: 16
  //       width: "300px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor1
  //       textOverflow: ellipsis
  //       overflow: hidden
  //       whiteSpace: nowrap

  //     }
  //     label: "NormSeg1"
  //   }
  //   tile value #valueTile_4 {
  //     areaId: "area_18"
  //     label: "Last rendering mode used"
  //     value: @top3dimcorr.map.data._0.norm
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile text #textTile_15 {
  //     value: @top3dimNew.map.data._1.dimensionlabel
  //     areaId: "area_19"
  //     style #style {
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //     label: "top2label"
  //   }
  //   tile value #valueTile_5 {
  //     areaId: "area_20"
  //     label: "EIscore"
  //     value: @top3dimcorr.map.data._1.favorable
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //     valueFormatter: percentNoDecimal
  //   }
  //   tile text #textTile_16 {
  //     value: @comparisonPeriodSelector.selectedLabel//"Prior Cycle"
  //     areaId: "area_21"
  //     style #style {
  //       fontSize: 16
  //       width: "162px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile value #valueTile_6 {
  //     areaId: "area_22"
  //     label: "EIComparisonYearValue"
  //     value: @top3dimcorr.map.data._1.favorable - @top3dimcorr.map.data._1.priorcycle
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile text #textTile_17 {
  //     value: "vs Company Overall"
  //     areaId: "area_23"
  //     style #style {
  //       fontSize: 16
  //       width: "170px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile value #valueTile_7 {
  //     areaId: "area_24"
  //     label: "vscompanyoverall1"
  //     value: @top3dimcorr.map.data._1.favorable - @top3dimcorr.map.data._1.overall
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile text #textTile_18 {
  //     value: @benchmarksListItemsSelector.selectedLabel

  //     areaId: "area_25"
  //     style #style {
  //       fontSize: 16
  //       width: "299px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor2
  //       textOverflow: ellipsis
  //       overflow: hidden
  //       whiteSpace: nowrap

  //     }
  //     label: "NormSeg2"
  //   }
  //   tile value #valueTile_8 {
  //     areaId: "area_26"
  //     label: "Last rendering mode used"
  //     value: @top3dimcorr.map.data._1.norm
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile text #textTile_19 {
  //     value: @top3dimNew.map.data._2.dimensionlabel
  //     areaId: "area_27"
  //     style #style {
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //     label: "top3label"
  //   }
  //   tile value #valueTile_9 {
  //     areaId: "area_28"
  //     label: "RRscore"
  //     value: @top3dimcorr.map.data._2.favorable
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 24
  //       color: @layoutselector.selected.layouttablefontcolor3

  //       fontWeight: "bold"
  //     }
  //     valueFormatter: percentNoDecimal
  //   }
  //   tile text #textTile_20 {
  //     value: @comparisonPeriodSelector.selectedLabel//"Prior Cycle"
  //     areaId: "area_29"
  //     style #style {
  //       fontSize: 16
  //       width: "156px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile value #valueTile_10 {
  //     areaId: "area_30"
  //     label: "RRComparisonYearValue"
  //     value: @top3dimcorr.map.data._2.favorable - @top3dimcorr.map.data._2.priorcycle
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile text #textTile_21 {
  //     value: "vs Company Overall"
  //     areaId: "area_31"
  //     style #style {
  //       fontSize: 16
  //       width: "197px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile value #valueTile_11 {
  //     areaId: "area_32"
  //     label: "vscompanyoverall2"
  //     value: @top3dimcorr.map.data._2.favorable - @top3dimcorr.map.data._2.overall
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile text #textTile_22 {
  //     value: @benchmarksListItemsSelector.selectedLabel

  //     areaId: "area_33"
  //     style #style {
  //       fontSize: 16
  //       width: "304px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor3
  //       textOverflow: ellipsis
  //       overflow: hidden
  //       whiteSpace: nowrap

  //     }
  //     label: "NormSeg3"
  //   }
  //   tile value #valueTile_12 {
  //     areaId: "area_34"
  //     label: "Last rendering mode used"
  //     value: @top3dimcorr.map.data._2.norm
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile text #textTile_23 {
  //     value: @singleresponsetable.map.data._0.comments
  //     areaId: "area_35"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment1"
  //   }
  //   tile text #textTile_26 {
  //     value: "More comments ↗ "
  //     areaId: "area_38"
  //     style #style {
  //       fontSize: 15
  //       color: #EDF4F7
  //       border: "solid thin #edf4f7"
  //       borderRadius: "65.44px"
  //     }
  //     navigateTo: "commentsmodal"
  //     navigateOptions: "same_tab"
  //   }
  //   tile text #textTile_27 {
  //     value: @singleresponsetable.map.data._1.comments
  //     areaId: "area_39"
  //     style #style {
  //       fontSize: 16
  //       width: "425px"
  //       height: "128px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment2"
  //   }
  //   tile text #textTile_28 {
  //     value: @singleresponsetable.map.data._6.comments
  //     areaId: "area_40"
  //     style #style {
  //       fontSize: 16
  //       width: "417px"
  //       height: "128px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment6"
  //   }
  //   tile text #textTile_29 {
  //     value: @singleresponsetable.map.data._3.comments
  //     areaId: "area_41"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment3"
  //   }
  //   tile text #textTile_30 {
  //     value: @singleresponsetable.map.data._4.comments
  //     areaId: "area_42"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment4"
  //   }
  //   tile text #textTile_31 {
  //     value: @singleresponsetable.map.data._5.comments
  //     areaId: "area_43"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment5"
  //   }
  //   tile text #textTile_32 {
  //     value: "🗨 " + toText(count(:Q89.start))//, :BestThingCategory = toText(@top3dimcorr.map.data._0.sequenceid)))
  //     areaId: "area_44"
  //     style #style {
  //       color: @layoutselector.selected.layouttablefontcolor1
  //       fontSize: 30
  //     }
  //     label: "bubble1"
  //   }
  //   tile text #textTile_33 {
  //     value: "🗨 " + toText(count(:Q89.start))//, :BestThingCategory = toText(@top3dimcorr.map.data._1.sequenceid)))
  //     areaId: "area_45"
  //     style #style {
  //       color: @layoutselector.selected.layouttablefontcolor2
  //       fontSize: 30
  //     }
  //     label: "bubble1"
  //   }
  //   tile text #textTile_34 {
  //     value: "🗨 " + toText(count(:Q89.start))//, :BestThingCategory = toText(@top3dimcorr.map.data._3.sequenceid)))
  //     areaId: "area_46"
  //     style #style {
  //       color: @layoutselector.selected.layouttablefontcolor3
  //       fontSize: 30
  //     }
  //     label: "bubble1"
  //   }
  //   tile text #textTile_35 {
  //     navigateTo: itemsmodal
  //     value: "View items ↗"
  //     areaId: "area_47"
  //     style #style {
  //       fontSize: 16
  //       color: #EDF4F7
  //     }
  //     label: "viewitems1"
  //   }
  //   tile text #textTile_36 {
  //     navigateTo: itemsmodal
  //     value: "View items ↗"
  //     areaId: "area_48"
  //     style #style {
  //       fontSize: 16
  //       color: #EDF4F7
  //     }
  //     label: "viewitems2"
  //   }
  //   tile text #textTile_37 {
  //     navigateTo: itemsmodal
  //     value: "View items ↗"
  //     areaId: "area_49"
  //     style #style {
  //       fontSize: 16
  //       color: #EDF4F7
  //     }
  //     label: "viewitems3"
  //   }
  //   tile text #textTile_39 {
  //     value: " "
  //     areaId: "area_51"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "22px"
  //       height: "25px"
  //     }
  //     label: "PMcomparisonYear"
  //     switch #switch {
  //       linkedToValue: @valueTile_2
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  //   tile text #textTile_40 {
  //     value: " "
  //     areaId: "area_52"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       color: #EDF4F7
  //     }
  //     switch #switch {
  //       linkedToValue: @valueTile_6
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor2 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 20
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor2 // #4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor2 // #4d4d4d
  //           }
  //         }
  //       }
  //     }
  //     label: "EIComparisonYear"
  //   }
  //   tile text #textTile_41 {
  //     value: " "
  //     areaId: "area_53"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //     }
  //     switch #switch {
  //       linkedToValue: @valueTile_10
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //     label: "RRComparisonYear"
  //   }
  //   tile text #textTile_42 {
  //     value: " "
  //     areaId: "area_54"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "28px"
  //       height: "33px"
  //     }
  //     label: "PMcompanyOverall"
  //     switch #switch {
  //       linkedToValue: @valueTile_3
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor1 // #4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor1 // #4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  //   tile text #textTile_43 {
  //     value: " "
  //     areaId: "area_55"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "28px"
  //       height: "33px"
  //     }
  //     label: "PMcompanyOverall"
  //     switch #switch {
  //       linkedToValue: @valueTile_7
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor2 // #4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor2 //#4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor2 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  //   tile text #textTile_44 {
  //     value: " "
  //     areaId: "area_56"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "28px"
  //       height: "33px"
  //     }
  //     label: "PMcompanyOverall"
  //     switch #switch {
  //       linkedToValue: @valueTile_11
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor3 // #4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  // }




}
page #Learn {
  label: "Learn"
  widget headline #headlineWidget {
    label: "Learn"
    cardCorners: 10px
    size: large
    tile text #textTile_2 {
      value: "The Learn chapter allows you to dive deeper in to your Engagement, Item & Dimension results by using the filters below"
      fontSize: 25
    }
    infobox #infobox {
      label: "Additional Information"
      size: medium
      info: " The widgets in this chapter allow you to:
 - explore levels of Engagement by using 'Engagement' & 'Engagement Distribution by Year'
 - dive deeper in to your item & dimension results in 'Dimensions & Items'. In the second filter dropdown, switch between showing dimensions only, items only or nested dimensions & items in 'Dimensions & Items'
 - use the left most filter to switch between seeing only favorable scores or a full distribution scale breakdown"
    }
    cardText: #ffffff
    cardTransparent: false
    cardBackground: #002c77
    cardShadow: false
  }

  widget canvas #canvasWidget {
    cardCorners: 10px
    label: "Canvas"
//     infobox #infobox {
//       info: " The widgets in this chapter allow you to:
//  - explore levels of Engagement by using 'Engagement' & 'Engagement Distribution by Year'
//  - dive deeper in to your item & dimension results in 'Dimensions & Items'. In the second filter dropdown, switch between showing dimensions only, items only or nested dimensions & items in 'Dimensions & Items'
//  - use the left most filter to switch between seeing only favorable scores or a full distribution scale breakdown"
//       size: medium
//       label: "Additional Information"
//     }
    container: container position {
      width: 1368px
      height: "85px"
      area #area {
        position: "absolute"
        top: "25px"
        left: "29px"
      }
      area #area_2 {
        position: "absolute"
        top: "25px"
        left: "303px"
      }
      area #area_3 {
        position: "absolute"
        top: "25px"
        left: "588px"
      }
      area #area_4 {
        position: "absolute"
        top: "29px"
        left: "29px"
      }
    }

    select #distributionType {
      areaId: "area"

      label: "Dimension/Item Distribution"
      options: item {
        label:"Favorable"
        value:{
            question: .dg1_questionScore:twoPoint
            dimension: sum(.dg1_dimensionScore:favorabilityCounts2point) 
                        dimensionengagement: count(:EngagementDistribution)
             palettequestion: mercer_1_color
          palettedimensionengagement: mercerlist
          palettedimension: mercer_1_color
                      showlegend:false

        }
      },
      item{
        label: "Full Distribution"
        value:{
          question: .dg1_questionScore:fourpoint
            dimension: sum(.dg1_dimensionScore:favorabilityCounts4point) 
                        dimensionengagement: count(:EngagementDistribution)
          palettequestion: mercerlist
          palettedimension: mercerlist
          palettedimensionengagement:mercerlist
            showlegend:true

        }
      }
    }

    select #rows {
      label: "Select view"
      areaId: "area_2"

      options: item { label: "Dimensions"
      value: {
       show: both 
       hideitems:true
       viewmode: dynamic
      }
      },
      item { label:"Dimensions and Items"
      value: {
       show: both 
       hideitems:false
       viewmode: expanded
      }
      },
       item { label:"Items"
      value: {
       show: items 
       hideitems:false
       viewmode: dynamic
      }
       }

    }

    select #ColsToExport {
      areaId: "area_3"

      label: "vs. colors"
      background: transparent
      options: item {
        label: 'Color/Arrows on gap columns'
        value: favorable, distribution, overall, vsoverall, priorcycle, vsprior, norm, vsnorm, responses, addToPlan
      },
      item {
        label: 'No Colors/Arrows on gap columns'
        value: favorable, distribution, overall, vsoverallExport, priorcycle, vspriorExport, norm, vsnormExport, responses, addToPlan
      }
    }
  }

  // widget canvas #canvasWidget {
  //   cardCorners: 10px
  //   label: "Canvas"
  //   container: container position {
  //     width: 1368px
  //     height: "114px"
  //     area #area {
  //       position: "absolute"
  //       top: "47px"
  //       left: "29px"
  //     }
  //     area #area_2 {
  //       position: "absolute"
  //       top: "47px"
  //       left: "303px"
  //     }
  //     area #area_3 {
  //       position: "absolute"
  //       top: "47px"
  //       left: "588px"
  //     }
  //   }

  //   select #distributionType {
  //     areaId: "area"

  //     label: "Dimension/Item Distribution"
  //     options: item {
  //       label:"Favorable"
  //       value:{
  //           question: .dg1_questionScore:twoPoint
  //           dimension: sum(.dg1_dimensionScore:favorabilityCounts2point) 
  //                       dimensionengagement: count(:EngagementDistribution)
  //            palettequestion: mercer_1_color
  //         palettedimensionengagement: mercerlist
  //         palettedimension: mercer_1_color
  //                     showlegend:false

  //       }
  //     },
  //     item{
  //       label: "Full Distribution"
  //       value:{
  //         question: .dg1_questionScore:fourpoint
  //           dimension: sum(.dg1_dimensionScore:favorabilityCounts4point) 
  //                       dimensionengagement: count(:EngagementDistribution)
  //         palettequestion: mercerlist
  //         palettedimension: mercerlist
  //         palettedimensionengagement:mercerlist
  //           showlegend:true

  //       }
  //     }
  //   }

  //   select #rows {
  //     label: "Select view"
  //     areaId: "area_2"

  //     options: item { label: "Dimensions"
  //     value: {
  //      show: both 
  //      hideitems:true
  //      viewmode: dynamic
  //     }
  //     },
  //     item { label:"Dimensions and Items"
  //     value: {
  //      show: both 
  //      hideitems:false
  //      viewmode: expanded
  //     }
  //     },
  //      item { label:"Items"
  //     value: {
  //      show: items 
  //      hideitems:false
  //      viewmode: dynamic
  //     }
  //      }

  //   }

  //   select #ColsToExport {
  //     areaId: "area_3"

  //     label: "vs. colors"
  //     background: transparent
  //     options: item {
  //       label: 'Color/Arrows on gap columns'
  //       value: favorable, distribution, overall, vsoverall, priorcycle, vsprior, norm, vsnorm, responses, addToPlan
  //     },
  //     item {
  //       label: 'No Colors/Arrows on gap columns'
  //       value: favorable, distribution, overall, vsoverallExport, priorcycle, vspriorExport, norm, vsnormExport, responses, addToPlan
  //     }
  //   }

  // }

  widget dataGrid #engagement1 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true

    filter expression {
      value: IN(.dg1_dimensions:Id, "Engagement")
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
    }


    activeRows: dimensions, items
    activeColumns: magicfav, @ColsToExport.selected

    row nestedHeaders #both {
      viewMode: @rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      hide: true
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
    }

    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
      label: "Response Distribution"
      width: 300px
    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }

       // formatString: '{value1} | <span style ="color:{arrowColor}">{value2}</span> |{diff} '

    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    cell custom {
      row: dimensions
      column: norm
      lookup value #mean {
        source: KeyMetricNorm
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }


        value: KeyMetricScore
      }
      formula #normscore {
        value: mean[]
        formatter: percentNoDecimal

      }
      formatString: "{normscore}"
    }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, value[column = /favorable] - normscore[column = /norm])
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vspriorExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }


//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality

      }
      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionType.selected.question
      }
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      suppression custom {
        condition: formula {
          value: countdim[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: count(.response:responseid)
      breakdownBy cut {
        value: :engagementdistribution//@distributionType.selected.dimension //Note runs on QUESTIONSCORE
      }
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettedimensionengagement
        percentFormat: percentNoDecimal
        showLegend: true//@distributionType.selected.showlegend
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)

    }

    cell custom {
      row: dimensions
      column: favorable
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal

      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"


    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave

      }
      label: "Responses"

    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide
    }

    // cell custom {
    //   view: actionPlanner
    //   row: dimensions
    //   column: addToPlan
    //   expression #id {
    //     value: toText(surveyDataset.dimensions:id)
    //   }
    //   formatString: "Add plan"
    // }
    cell custom {
      view: actionPlanner
      row: items
      column: addToPlan
      expression #id {
        value: toText(surveyDataset.items:id)
      }
      formatString: "Add plan"
    }

    label: "Engagement"
  }
  widget dataGrid #copy_of_super {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true

    filter expression {
      value: IN(.dg1_dimensions:Id, "Engagement")
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
    }


    activeRows: items//@rows.selected.show
    activeColumns: magicfav, @ColsToExport.selected

    row nestedHeaders #both {
      viewMode: @rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
    }

    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
      label: "Response Distribution"
      width: 300px
    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }

       // formatString: '{value1} | <span style ="color:{arrowColor}">{value2}</span> |{diff} '

    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    cell custom {
      row: dimensions
      column: norm
      lookup value #mean {
        source: KeyMetricNorm
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }


        value: KeyMetricScore
      }
      formula #normscore {
        value: mean[]
        formatter: percentNoDecimal

      }
      formatString: "{normscore}"
    }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, value[column = /favorable] - normscore[column = /norm])
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vspriorExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }


//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality

      }
      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionType.selected.question
      }
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      suppression custom {
        condition: formula {
          value: countdim[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: count(.response:responseid)
      breakdownBy cut {
        value: :engagementdistribution//@distributionType.selected.dimension //Note runs on QUESTIONSCORE
      }
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettedimensionengagement
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)

    }

    cell custom {
      row: dimensions
      column: favorable
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal

      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"


    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave

      }
      label: "Responses"

    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide
    }

    // cell custom {
    //   view: actionPlanner
    //   row: dimensions
    //   column: addToPlan
    //   expression #id {
    //     value: toText(surveyDataset.dimensions:id)
    //   }
    //   formatString: "Add plan"
    // }
    cell custom {
      view: actionPlanner
      row: items
      column: addToPlan
      expression #id {
        value: toText(surveyDataset.items:id)
      }
      formatString: "Add plan"
    }

    label: "Engagement items"
  }
  widget chart #chartWidget {
    hide: @cp.hidechartlearn
    label: "Engagement Distribution by Year"
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    series #series {
      chart bar #barChart {
        //mode: "stacked" // changed to stacked100Percent have axis maxvalue 100
        mode: stacked100Percent
        dataLabel: value
        showValue: true
        showBase: true
      }
      value: count(.response:responseid)
      breakdownBy cut {
        value: :EngagementDistribution
      }
      percentOver: "series"
      format: percentNoDecimal

    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }

    size: large
    layout: "vertical"
    category cut #cutCategory {
      value: :combined_sourceid
      categories: @cp.engagementmodelB_yearcategories
    }
    legend: "bottomCenter"
    palette: mercerlist
    cardTransparent: false
    cardShadow: true
    infobox #infobox {
      label: "Engagement Distribution"
      info: ""
      size: "small"
    }
  }


  widget actionPlannerDataGrid #copy_of_super2 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }


    activeRows: @rows.selected.show
    activeColumns: magicfav, @ColsToExport.selected

    row nestedHeaders #both {
      viewMode: @rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: 300px

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionType.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionType.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionType.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide
    }

    // cell custom {
    //   view: actionPlanner
    //   row: dimensions
    //   column: addToPlan
    //   expression #id {
    //     value: toText(surveyDataset.dimensions:id)
    //   }
    //   formatString: "Add plan"
    // }
    cell custom {
      view: actionPlanner
      row: items
      column: addToPlan
      expression #id {
        value: toText(surveyDataset.items:id)
      }
      formatString: "Add plan"
    }
    label: "Dimensions and Items"
  }


}
page #Segmentation {
  label: "Segmentation"

  widget headline #headlineWidget {
    label: "Segmentation"
    cardCorners: 10px
    size: large
    tile text #textTile_2 {
      value: "Segmentation enables a more detailed analysis of your results, allowing you to examine how different demographic groups compare with one another"
      fontSize: 25
    }
    infobox #infobox {
      label: "Additional Information"
      size: medium
      info: " The widgets in this chapter allow you to:
 - explore levels of Engagement by using 'Engagement' & 'Engagement Distribution by Year'
 - dive deeper in to your item & dimension results in 'Dimensions & Items'. In the second filter dropdown, switch between showing dimensions only, items only or nested dimensions & items in 'Dimensions & Items'
 - use the left most filter to switch between seeing only favorable scores or a full distribution scale breakdown"
    }
    cardText: #ffffff
    cardTransparent: false
    cardBackground: #002c77
    cardShadow: false
  }

  widget headline #hiddenselectorsegmentation {
    hide: true
    tile text {
      value: ""

    }
    select #rows {
      label: "Select view"
      areaId: "area_2"

      options: item { label: "Dimensions"
      value: {
       show: both 
       hideitems:false
       viewmode: dynamic
      }
      },
      item { label:"Dimensions and Items"
      value: {
       show: both 
       hideitems:false
       viewmode: expanded
      }
      },
       item { label:"Items"
      value: {
       show: items 
       hideitems:false
       viewmode: dynamic
      }
       }

    }
    select #distributionType {
      areaId: "area"

      label: "Dimension/Item Distribution"
      options: item {
        label:"Favorable"
        value:{
            activecol: favorable
            question: .dg1_questionScore:twoPoint
            dimension: sum(.dg1_dimensionScore:favorabilityCounts2point) 
                        dimensionengagement: count(:EngagementDistribution)
             palettequestion: mercer_1_color
          palettedimensionengagement: mercerlist
          palettedimension: mercer_1_color
                      showlegend:false

        }
      },
      item{
        label: "Full Distribution"
        value:{
                      activecol: distribution
          question: .dg1_questionScore:fourpoint
            dimension: sum(.dg1_dimensionScore:favorabilityCounts4point) 
                        dimensionengagement: count(:EngagementDistribution)
          palettequestion: mercerlist
          palettedimension: mercerlist
          palettedimensionengagement:mercerlist
            showlegend:false

        }
      }
    }
  }
  widget canvas #canvasWidget {
    cardCorners: 10px
    label: "Canvas"
    container: container position {
      width: 1368px
      height: "85px"
      area #area {
        position: "absolute"
        top: "25px"
        left: "29px"
      }
      area #area_2 {
        position: "absolute"
        top: "23px"
        left: "36px"
      }
      area #area_3 {
        position: "absolute"
        top: "23px"
        left: "40px"
      }
      area #area_4 {
        position: "absolute"
        top: "29px"
        left: "29px"
      }
    }

    select #demoCut {
      areaId: "area_3"
      options: @demographics.items
      label: "Choose a Demographic Item"
      //defaultOption: :EngagementDistribution
    }
  }

  widget dataGrid #itemBreakouts {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    viaStrategy: shortest
    removeEmptyColumns: true
    removeEmptyRows: true
    filter expression {
      value: @cp.currentwave

    }
    filter expression {
      value: IN(.dg1_dimensions:Id, "Engagement")
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
    }
    virtualize: true


    size: large

    activeRows: count, @rows.selected.show
    activeColumns: @distributionType.selected.activecol

    row #count {
      label: "Count"
      cell custom {
        expression #count {
          value: count(@demoCut.selected)
        }
        expression #toofewtext {
          value: @cp.toofewresponses

        }
        formula #value {
          value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
        }
        formatString: "{value}"
        style {
          alignItems: center
        }
      }
    }


    row nestedHeaders #both {
      viewMode: @rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: @demoCut.selected

      total: "last"
      totalLabel: "Group Overall Score"

    }

    column cut #distribution {
      label: "Full Distribution"
      value: @demoCut.selected
      total: "last"
      totalLabel: "Group Overall Score"
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality

      }
      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionType.selected.question
      }
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      value: count(.response:responseid)
      breakdownBy cut {
        value: :engagementdistribution//@distributionType.selected.dimension //Note runs on QUESTIONSCORE
      }
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettedimensionengagement
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
      }
    }

//*******************************************************************
    cell custom {
      row: dimensions
      column: favorable
      suppression custom {
        condition: countdistinct(:) < @cp.confidentiality
      }
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave
      }
      label: "Responses"
    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
    label: "Engagement"
    description: "Use the table below to view the favorable scores for each item, in each of the demographic categories that exist in the question that you have selected."

  }



  widget chart #chartWidget {
    hide: @cp.hidechartsegmentation
    label: "Engagement Distribution for the Selected Demographic"
    cardCorners: 10px
    removeEmptyCategories: true
    filter expression {
      value: @cp.currentwave
    }
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    //to suppress series
    suppression respondentsBase {
      threshold: @cp.confidentiality
      in: totalCategories
    }

    series #series {

      chart bar #barChart {
        mode: "stacked100Percent"
        showValue: true
        showBase: true
        dataLabel: value

      }
      value: count(.response:responseid)
      breakdownBy cut {
        value: :EngagementDistribution

      }
      percentOver: "series"
      format: percentNoDecimal
      palette: mercerlist
    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    size: large
    layout: "vertical"
    category cut #cutCategory {
      value: @demoCut.selected
    }
    legend: "bottomCenter"
    palette: mercer
    cardTransparent: false
    cardShadow: true

  }
  widget dataGrid #copy_of_itemBreakouts {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    viaStrategy: shortest
   // removeEmptyColumns: true
   // removeEmptyRows: true
    filter expression {
      value: @cp.currentwave

    }
    filter expression {
      value: .dg1_dimensions:Id != "Engagement"
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    virtualize: true

    // suppression respondentsBase {
    //   threshold: @cp.confidentiality
    // }
    size: large

    activeRows: count, dimensions //@rows.selected.show
    activeColumns: popup, @distributionType.selected.activecol

    row #count {
      label: "Count"
      cell custom {
        expression #count {
          value: count(@demoCut.selected)
        }
        expression #toofewtext {
          value: @cp.toofewresponses

        }
        formula #value {
          value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
        }
        formatString: "{value}"
        style {
          alignItems: center
        }
      }
    }


    row nestedHeaders #both {
      viewMode: expanded//@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: @demoCut.selected
      total: "first"
      totalLabel: "Group Overall Score"
    }

    column cut #distribution {
      label: "Total Favorable Score"
      value: @demoCut.selected
      total: "first"
      totalLabel: "Group Overall Score"
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality
      }

      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionType.selected.question

      }
      microchart stacked100PercentBar {

        palette: @distributionType.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend

      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      value: @distributionType.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
        showTooltip: true

      }
    }
    //***********************cell for favorable, overall****************************
    cell custom {
      row: dimensions
      column: favorable
      suppression custom {
        condition: countdistinct(:) < @cp.confidentiality
      }

      expression #value {
        value: :dimensionTopTwoNEW2()
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave
      }
      label: "Responses"
    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
    column #popup {
      label: " "

    }
    cell #popupdims {
      column: popup
      row: dimensions
      value: "View segments ↗"
      navigateTo: dimensionSegmentationDetails
      //navigateFilter: some(.dg1_questionScore:, true, .dg1_dimensions:)
      style #body {
        textAlign: 'center'
        alignItems: 'center'
      }
    }

    // cell #popupitems {
    //   column: popup
    //   row: items
    //   value: "View segments ↗"
    //   navigateTo: itemSegmentationDetails

    //   style #body {
    //     textAlign: 'center'
    //     alignItems: 'center'
    //   }
    // }
    label: "Dimensions"
    description: ""

  }
  widget dataGrid #copy_of_copy_of_itemBreakouts {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    viaStrategy: shortest
   // removeEmptyColumns: true
   // removeEmptyRows: true
    filter expression {
      value: @cp.currentwave

    }
    filter expression {
      value: .dg1_dimensions:Id != "Engagement"
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    virtualize: true

    // suppression respondentsBase {
    //   threshold: @cp.confidentiality
    // }
    size: large

    activeRows: count, both //@rows.selected.show
    activeColumns: popup, @distributionType.selected.activecol

    row #count {
      label: "Count"
      cell custom {
        expression #count {
          value: count(@demoCut.selected)
        }
        expression #toofewtext {
          value: @cp.toofewresponses

        }
        formula #value {
          value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
        }
        formatString: "{value}"
        style {
          alignItems: center
        }
      }
    }


    row nestedHeaders #both {
      viewMode: expanded//@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: @demoCut.selected
      total: "first"
      totalLabel: "Group Overall Score"
    }

    column cut #distribution {
      label: "Total Favorable Score"
      value: @demoCut.selected
      total: "last"
      totalLabel: "Group Overall Score"
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality
      }

      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionType.selected.question

      }
      microchart stacked100PercentBar {

        palette: @distributionType.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend

      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      value: @distributionType.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionType.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionType.selected.showlegend
        showTooltip: true

      }
    }
    //***********************cell for favorable, overall****************************
    cell custom {
      row: dimensions
      column: favorable
      suppression custom {
        condition: countdistinct(:) < @cp.confidentiality
      }

      expression #value {
        value: :dimensionTopTwoNEW2()
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave
      }
      label: "Responses"
    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
    column #popup {
      label: " "

    }
    // cell #popupdims {
    //   column: popup
    //   row: dimensions
    //   value: "View segments ↗"
    //   navigateTo: dimensionSegmentationDetails
    //   style #body {
    //     textAlign: 'center'
    //     alignItems: 'center'
    //   }
    // }

    cell #popupitems {
      column: popup
      row: items
      value: "View segments ↗"
      navigateTo: itemSegmentationDetails

      style #body {
        textAlign: 'center'
        alignItems: 'center'
      }
    }
    label: "Items"
    description: ""

  }

}
page #Comments {
  label: "Comments"
  filter expression {
    value: @cp.currentwave

  }
  filter expression { //filters should be converted to multi
    value: IIF(@commentsfilterselector1.selected.id = "0" AND @commentsfilterselector2.selected.id = "0" AND @commentsfilterselector3.selected.id = "0", true, IIF(@commentsfilterselector1.selected.id = "4", layout.wordcloud:dimension = @commentsfilterselector1.selected.layouttablefocusarea) OR IIF(@commentsfilterselector2.selected.id = "5", layout.wordcloud:dimension = @commentsfilterselector2.selected.layouttablefocusarea) OR IIF(@commentsfilterselector3.selected.id = "6", layout.wordcloud:dimension = @commentsfilterselector3.selected.layouttablefocusarea))
  }

  widget headline #headlineWidget {
    label: "Comments"
    cardCorners: 10px
    size: large
    tile text #textTile_2 {
      value: "The Comments chapter displays verbatim comments from respondents in their own words"
      fontSize: 25
    }

    cardText: #ffffff
    cardTransparent: false
    cardBackground: #002c77
    cardShadow: false
  }


  widget canvas {
    cardCorners: 10px

    size: large
    //cardTransparent: true
    container: container position {
      width: 1368px
      height: "85px"
      padding: "1px 14px 14px 14px" //around container
      justifyContent: center
      display: block

      area #area {
        position: "absolute"
        top: "25px"
        left: "25px"
      }
      area #area_2 {
        position: "absolute"
        top: "18px"
        left: "25px"
      }
      area #area_4 {
        position: "absolute"
        top: "19px"
        left: "401px"
      }
      area #area_5 {
        position: "absolute"
        top: "10px"
        left: "650px"
      }
    }


    select #commentselector {
      areaId: area
      options: @openendedvalueset.items
      defaultOption: 1
      label: "Choose an open ended question Item"
      mode: single
    }
  }

  widget headline #questiontxt {
    cardCorners: 10px
    size: halfwidth
    tile text #textTile_2 {
      value: "Question Text"
      fontSize: 20
    }
    tile text #textTile {
      value: @commentselector.selected.text
      style #style {
        fontSize: 30
      }
    }
    tile text #textTile_3 {
      value: "Answers"
      fontSize: 20
    }
    tile value #valueTile_2 {
      value: count(@commentselector.selected.qid)
    }
  }
  widget canvas #canvasWidget {
    hide: @cp.commentsselfcatfilterhide
    cardCorners: 10px
    size: halfwidth
    label: "Canvas"
    container: container position {
      width: 1368px
      height: "946px"
      area #area {
        position: "absolute"
        top: "67px"
        left: "40px"
      }
      area #area_2 {
        position: "absolute"
        top: "67px"
        left: "488px"
      }
      area #area_3 {
        position: "absolute"
        top: "67px"
        left: "936px"
      }
      area #area_4 {
        position: "absolute"
        top: "349px"
        left: "40px"
      }
      area #area_5 {
        position: "absolute"
        top: "349px"
        left: "488px"
      }
      area #area_6 {
        position: "absolute"
        top: "349px"
        left: "936px"
      }
      area #area_7 {
        position: "absolute"
        top: "630px"
        left: "40px"
      }
      area #area_8 {
        position: "absolute"
        top: "630px"
        left: "488px"
      }
      area #area_9 {
        position: "absolute"
        top: "630px"
        left: "936px"
      }
      area #area_10 {
        position: "absolute"
        top: "97px"
        left: "71px"
      }
      area #area_11 {
        position: "absolute"
        top: "144px"
        left: "71px"
      }
      area #area_12 {
        position: "absolute"
        top: "97px"
        left: "527px"
      }
      area #area_13 {
        position: "absolute"
        top: "144px"
        left: "527px"
      }
      area #area_14 {
        position: "absolute"
        top: "97px"
        left: "970px"
      }
      area #area_15 {
        position: "absolute"
        top: "375px"
        left: "71px"
      }
      area #area_16 {
        position: "absolute"
        top: "375px"
        left: "527px"
      }
      area #area_17 {
        position: "absolute"
        top: "375px"
        left: "970px"
      }
      area #area_18 {
        position: "absolute"
        top: "656px"
        left: "71px"
      }
      area #area_19 {
        position: "absolute"
        top: "656px"
        left: "519px"
      }
      area #area_20 {
        position: "absolute"
        top: "656px"
        left: "970px"
      }
      area #area_21 {
        position: "absolute"
        top: "144px"
        left: "970px"
      }
      area #area_22 {
        position: "absolute"
        top: "433px"
        left: "71px"
      }
      area #area_23 {
        position: "absolute"
        top: "433px"
        left: "527px"
      }
      area #area_24 {
        position: "absolute"
        top: "433px"
        left: "970px"
      }
      area #area_25 {
        position: "absolute"
        top: "723px"
        left: "71px"
      }
      area #area_26 {
        position: "absolute"
        top: "723px"
        left: "527px"
      }
      area #area_27 {
        position: "absolute"
        top: "723px"
        left: "970px"
      }
      area #area_28 {
        position: "absolute"
        top: "883px"
        left: "1213px"
      }
      area #area_29 {
        position: "absolute"
        top: "11px"
        left: "40px"
      }
    }
    tile text #textTile {
      value: " "
      areaId: "area"
      hide: @commentsfilterselector1.selected.hidetile1
      action setSelector {
        value: "4"
        select: @commentsfilterselector1
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector1.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }

      label: "TA2"
    }
    tile text #textTilereverse {
      value: " "
      areaId: "area"
      hide: @commentsfilterselector1.selected.hidetile2

      action setSelector {
        value: "0"
        select: @commentsfilterselector1
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector1.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA2"
    }

    tile text #textTile_2 {
      value: " "
      areaId: "area_2"
      hide: @commentsfilterselector2.selected.hidetile1
      action setSelector {
        value: "5"
        select: @commentsfilterselector2
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector2.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA2"
    }
    tile text #textTile_2reverse {
      value: " "
      areaId: "area_2"
      hide: @commentsfilterselector2.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector2
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector2.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA2"
    }
    tile text #textTile_3 {
      value: " "
      areaId: "area_3"
      hide: @commentsfilterselector3.selected.hidetile1
      action setSelector {
        value: "6"
        select: @commentsfilterselector3
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector3.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA3"
    }
    tile text #textTile_3reverse {
      value: " "
      areaId: "area_3"
      hide: @commentsfilterselector3.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector3
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector3.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA3"
    }
    tile text #textTile_4 {
      value: " "
      areaId: "area_4"
      hide: @commentsfilterselector4.selected.hidetile1
      action setSelector {
        value: "7"
        select: @commentsfilterselector4
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector4.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA4"
    }
    tile text #textTile_4reversed {
      value: " "
      areaId: "area_4"
      hide: @commentsfilterselector4.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector4
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector4.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA4"
    }

    tile text #textTile_5 {
      value: " "
      areaId: "area_5"
      hide: @commentsfilterselector5.selected.hidetile1
      action setSelector {
        value: "8"
        select: @commentsfilterselector5
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector5.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA5"
    }
    tile text #textTile_5reversed {
      value: " "
      areaId: "area_5"
      hide: @commentsfilterselector5.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector5
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector5.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA5"
    }
    tile text #textTile_6 {
      value: " "
      areaId: "area_6"
      hide: @commentsfilterselector6.selected.hidetile1
      action setSelector {
        value: "9"
        select: @commentsfilterselector6
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector6.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA6"
    }
    tile text #textTile_6reversed {
      value: " "
      areaId: "area_6"
      hide: @commentsfilterselector6.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector6
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector6.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA6"
    }
    tile text #textTile_7 {
      value: " "
      areaId: "area_7"
      hide: @commentsfilterselector7.selected.hidetile1
      action setSelector {
        value: "10"
        select: @commentsfilterselector7
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector7.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA7"
    }
    tile text #textTile_7reversed {
      value: " "
      areaId: "area_7"
      hide: @commentsfilterselector7.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector7
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector7.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA7"
    }
    tile text #textTile_8 {
      value: " "
      areaId: "area_8"
      hide: @commentsfilterselector8.selected.hidetile1
      action setSelector {
        value: "11"
        select: @commentsfilterselector8
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector8.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA8"
    }
    tile text #textTile_8reveresed {
      value: " "
      areaId: "area_8"
      hide: @commentsfilterselector8.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector8
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector8.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA8"
    }
    tile text #textTile_9 {
      value: " "
      areaId: "area_9"
      hide: @commentsfilterselector9.selected.hidetile1
      action setSelector {
        value: "12"
        select: @commentsfilterselector9
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector9.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA9"
    }

//***************************************************

    tile text #textTile_10 {
      value: "Career & Development"
      areaId: "area_10"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector1.selected.layouttablefontcolor1

      }
    }

    tile text #textTile_9reversed {
      value: " "
      areaId: "area_9"
      hide: @commentsfilterselector9.selected.hidetile2
      action setSelector {
        value: "0"
        select: @commentsfilterselector9
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        width: "409px"
        height: "240px"
        background: @commentsfilterselector9.selected.layouttablesquareonecolor

        border: "solid thin #000000"
        borderRadius: "13.6px"
      }
      label: "TA9"
    }

    //********************************************************************************************
    tile text #textTile_11 {
      value: "62%"
      areaId: "area_11"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector1.selected.layouttablefontcolor1



      }
    }
    tile text #textTile_12 {
      value: "Senior Leadership"
      areaId: "area_12"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector2.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_13 {
      value: "58%"
      areaId: "area_13"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector2.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_14 {
      value: "Manager"
      areaId: "area_14"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector3.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_15 {
      value: "Work/Life Balance"
      areaId: "area_15"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector4.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_16 {
      value: "Rewards & Recognition"
      areaId: "area_16"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector5.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_17 {
      value: "Performance Management"
      areaId: "area_17"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector6.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_18 {
      value: "Empowerment/Autonomy"
      areaId: "area_18"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector7.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_19 {
      value: "Diversity & Inclusion"
      areaId: "area_19"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector8.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_20 {
      value: "Enabling Infrastructure"
      areaId: "area_20"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector9.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_21 {
      value: "57%"
      areaId: "area_21"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector3.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_22 {
      value: "56%"
      areaId: "area_22"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector4.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_23 {
      value: "56%"
      areaId: "area_23"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector5.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_24 {
      value: "56%"
      areaId: "area_24"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector6.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_25 {
      value: "56%"
      areaId: "area_25"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector7.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_26 {
      value: "56%"
      areaId: "area_26"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector8.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_27 {
      value: "56%"
      areaId: "area_27"
      style #style {
        fontWeight: "bold"
        fontSize: 30
        color: @commentsfilterselector9.selected.layouttablefontcolor1

      }
    }
    tile text #textTile_37 {
      value: "Clear"
      areaId: "area_28"
      action setSelector {
        value: "0"
        select: @commentsfilterselector9
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector8
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector7
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector6
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector5
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector4
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector3
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector2
        compareBy: this.value.id
      }
      action setSelector {
        value: "0"
        select: @commentsfilterselector1
        compareBy: this.value.id
      }
      style #style {
        fontSize: 24
        border: "solid thin #000000"
        borderRadius: "59.68px"
        width: "132px"
        height: "53px"
        textAlign: "center"
      }
    }
    tile text #textTile_38 {
      value: "Comment Categories (Self-selected) "
      areaId: "area_29"
      style #style {
        fontSize: 29
        fontWeight: "bold"
      }
    }
  }


  widget wordCloud #wordCloudWidget {
    cardCorners: 10px
    hide: @cp.hidewordcloud
    suppressRule {
      criteria: count(@commentselector.selected.qid) < @cp.confidentialitycomments

    }
    wordCloud #wordCloud {
      shape: "square"
      minWordSize: -20
      maxWordSize: 150
      //rotateRatio: 0.1
      seed: 6
    }

    filter expression {
      value: NOT(contains(surveyDataset.loop_comments:single_word, @cp.stop_words))
    }

    value size #sizeValue {
      value: count(.loop_comments:single_word, .loop_comments:comment_qid = @commentselector.selected.filterid)
      format: bigNumberFormatter

    }
    value color #colorValue {
      colorFormat: wccolor

    }
    items cut #cutItems {
      value: .loop_comments:single_word
    }
    size: halfwidth
    palette: mercer_1_color
    label: "WordCloud"
  }

  widget comments #commentsWidget {
    cardCorners: 10px
    suppressRule {
      criteria: count(@commentselector.selected.qid) < @cp.confidentialitycomments

    }

    label: "Comments"
    column response #responseColumn {
      sortBy: comment
      enableColumnFilter: true
    }
    group question #questionGroup {
      label: @commentselector.selected.text
      filter expression #excludeBlankResponses {
        value: @commentselector.selected.qid != ""
      }
      comment: @commentselector.selected.qid
    }
    size: large
    table: :

  }
}
page #OrgTrends {
  label: "Organizational Trends"
  widget headline #headlineWidget {
    label: "Organizational Trends"
    cardCorners: 10px
    size: large
    tile text #textTile_2 {
      value: "Use the Organizational Trends chapter to see how Engagement & dimension scores have changed over time, across your organization"
      fontSize: 25
    }
    cardText: #ffffff
    cardTransparent: false
    cardBackground: #002c77
    cardShadow: false
  }

  widget dataGrid #dataGridWidget_2 {
    cardCorners: 10px
    viaStrategy: shortest
    label: "Engagement Score across the Hierarchy"
    size: "large"



    column #column_2 {
      cell custom #counts {
        expression #value {
          value: count(.response:responseid, @cp.currentwave)
          format: numberFormatter
        }
        expression #countprevious {
          value: count(.response:responseid, @cp.previouswave)
          format: numberFormatter
        }
        formatString: "{value}"

        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }

      label: "N"
    }
    column #column {
      filter expression {
        value: @cp.currentwave

      }

      cell #value {
        suppression custom {
          condition: formula {
            value: value[column = /column_2] < @cp.confidentiality //- 0.55
          }
        }
        value: :engagementscore()
        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }

      label: "Engagement"
    }
    row comparison #comparisonRow {
      reportingHierarchy: selfRefLookupReportinghierarchy
      showTotal: false
    }
    column #column_3 {
      label: "Historical Performance"
      cell microchart #cell {

        suppression custom {
          condition: formula {
            value: countprevious[column = /column_2] < @cp.confidentiality //- 0.55
          }
        }
        microchart line #barMicrochart {
          min: auto
          max: auto
        }
        value: :engagementscore()
        breakdownBy cut #cutBreakdownby {
          value: :wave
        }
      }
    }
  }
  widget dataGrid #copy_of_dataGridWidget_2_2 {
    cardCorners: 10px
    viaStrategy: shortest
    label: "Dimension Scores across the Hierarchy"
    size: "large"

    select #dimensionOrItemUnits2 {
      label: 'Select dimension'
      mode: single
      options: @dtDimensionsUnits.forSelect.data
      defaultOption: 'all'
      compareBy: this.value.id
    }

    column #column_2 {
      cell custom #counts {
        expression #value {
          value: count(.response:responseid, @cp.currentwave)
          format: numberFormatter
        }
        expression #countprevious {
          value: count(.response:responseid, @cp.previouswave)
          format: numberFormatter
        }
        formatString: "{value}"

        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
      label: "N"
    }
    column #column {
      filter expression {
        value: @cp.currentwave

      }

      cell #value {
        suppression custom {
          condition: formula {
            value: value[column = /column_2] < @cp.confidentiality //- 0.55
          }
        }
        value: :dimensionTopTwoNEW2()
        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }

      }
      filter expression #expressionFilter {
        value: selected(.dg1_dimensions:id, @dimensionOrItemUnits2.selectedProperty.id)
        label: "Condition"
      }
      label: @dimensionOrItemUnits2.selectedLabel // "Engagement"
    }
    row comparison #comparisonRow {
      reportingHierarchy: selfRefLookupReportinghierarchy
      showTotal: false
    }
    column #column_3 {
      filter expression #expressionFilter {
        value: in(.dg1_dimensions:id, @dimensionOrItemUnits2.selectedProperty.id)
        label: "Condition"
      }
      label: "Historical Performance"
      cell microchart #cell {
        suppression custom {
          condition: formula {
            value: countprevious[column = /column_2] < @cp.confidentiality //- 0.55
          }
        }
        microchart line #barMicrochart {
          min: auto
          max: auto
        }
        value: :dimensionTopTwoNEW2()
        breakdownBy cut #cutBreakdownby {
          value: :wave
        }
      }
    }
  }

  hide: false
  modal: false
}
page #ItemTrends {
  label: "Item Trend"
//   widget chart #chartWidget {
//     cardCorners: 10px

//     label: "Item History Chart"
//     select #itemSelect {
//       mode: multi
//       defaultOption: 'q3'
//       options: item{
//         label:"Given the opportunity, I tell others great things about working here"
//         value:'q3'
//       },
// item{
//         label:"This organization motivates me to contribute more than is normally required to complete my work"
//         value:'q4'
//       },
// item{
//         label:"This organization inspires me to do my best work every day"
//         value:'q5'
//       },
// item{
//         label:"I rarely think about leaving this organization to work somewhere else"
//         value:'q6'
//       },
// item{
//         label:"It would take a lot to get me to leave this organization"
//         value:'q7'
//       },
// item{
//         label:"I can clearly explain what makes working here better than other organizations"
//         value:'q8'
//       }


//     }

//     series #hidden { //added to create a space for the categories
//       chart bar {
//         legendType: none
//       }
//       value: parseInt("a")
//     }

//     series #series {

//       chart line #barChart {

//         dotSize: 6
//         lineWidth: 3
//       }
//       value: average(numeric(.dg1_questionScore:questionFavorableNumeric)) * 100
//       breakdownBy cut {
//         value: .dg1_questionScore:dg1_questionScore

//       }
//       format: percentNoDecimal
//     }
//     // axis category #categoryAxis {
//     //   hide: false
//     //   axisLine: true
//     //  // interval: preserveStartEnd
//     // }

//     axis primary #primaryAxis {
//       format: percentNoDecimal
//       tickLine: true

//     }
//     // axis secondary #secondaryAxis {
//     //   hide: true
//     //   textSize: 25
//     // }
//     size: large
//     category cut #cutCategory {
//       value: :wave
//     }
//     legend: "topLeft"
//     removeEmptySeries: true
//     filter expression {
//       value: IN(.dg1_questionScore:dg1_questionScore, @itemSelect.selected)

//     }
//     // filter expression #expressionFilter {
//     //   value: :filterMeasure_3()
//     //   label: "Question Filter"
//     // }
//   }

  widget headline #headlineWidget {
    label: "Item Trends"
    cardCorners: 10px
    size: large
    tile text #textTile_2 {
      value: "Item Trend allows you to see how Engagement, dimension & item scores have changed over time within your team/unit"
      fontSize: 25
    }
    cardText: #ffffff
    cardTransparent: false
    cardBackground: #002c77
    cardShadow: false
  }


  widget dataGrid #super {
    cardCorners: 10px
    viaStrategy: shortest
    virtualize: true
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    filter expression {
      value: IN(.dg1_dimensions:Id, "Engagement")
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
    }

    select #rows {
      label: "Select view"
      view list {
        direction: horizontal

      }
      options: item { label:Dimensions value:dimensions },
      item { label:Items value:items }
 //item { label:'Dimensions and Items' value: both},
    }
    activeRows: @rows.selected


    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending

    }

    size: large

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: :wave
      //sortOrder: descending
      total: none
    }


    column #priorcycle {
      label: "Trend"
    }

    cell microchart #dimcell {

      row: dimensions
      column: priorcycle
      microchart line #barMicrochart {
        min: auto
        max: auto
      }
      value: :dimensionTopTwoNEW2()
      breakdownBy cut #cutBreakdownby {
        value: :wave

      }
    }

    cell microchart #itemcell {
      row: items
      column: priorcycle
      microchart line #barMicrochart {
        min: auto
        max: auto
      }
      value: :itemTopTwo()
      breakdownBy cut #cutBreakdownby {
        value: :wave
      }
    }

    column #popup {
      label: " "

    }

    cell #popupdims {
      column: popup
      row: dimensions
      value: "Items in this dimension ↗"
      navigateTo: trendmodal
      style #body {
        textAlign: 'center'
        alignItems: 'center'
      }
    }

    cell #popupitems {
      column: popup
      row: items
      value: "Enlarge ↗"
      navigateTo: trendmodal
      style #body {
        textAlign: 'center'
        alignItems: 'center'
      }
    }
    //***********************cell for favorable, overall****************************

    cell custom {
      row: dimensions
      column: favorable
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
      //**********************responses *****************************



    label: "Engagement Trends"
  }
  widget dataGrid #copy_of_super_2 {
    cardCorners: 10px
    viaStrategy: shortest
    virtualize: true
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    filter expression {
      value: .dg1_dimensions:Id != "Engagement"
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }

    select #rows {
      label: "Select view"
      view list {
        direction: horizontal

      }
      options: item { label:Dimensions value:dimensions },
      item { label:Items value:items }
 //item { label:'Dimensions and Items' value: both},
    }
    activeRows: @rows.selected


    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending

    }

    size: large

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: :wave
      //sortOrder: descending
      total: none
    }


    column #priorcycle {
      label: "Trend"
    }

    cell microchart #dimcell {
      row: dimensions
      column: priorcycle
      microchart line #barMicrochart {
        min: auto
        max: auto
      }
      value: :dimensionTopTwoNEW2()
      breakdownBy cut #cutBreakdownby {
        value: :wave
      }
    }

    cell microchart #itemcell {
      row: items
      column: priorcycle
      microchart line #barMicrochart {
        min: auto
        max: auto
      }
      value: :itemTopTwo()
      breakdownBy cut #cutBreakdownby {
        value: :wave
      }
    }

    column #popup {
      label: " "

    }

    cell #popupdims {
      column: popup
      row: dimensions
      value: "Items in this dimension ↗"
      navigateTo: trendmodal
      style #body {
        textAlign: 'center'
        alignItems: 'center'
      }
    }

    cell #popupitems {
      column: popup
      row: items
      value: "Enlarge ↗"
      navigateTo: trendmodal
      style #body {
        textAlign: 'center'
        alignItems: 'center'
      }
    }
    //***********************cell for favorable, overall****************************

    cell custom {
      row: dimensions
      column: favorable
      expression #value {
        value: :dimensionTopTwoNEW2()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
      //**********************responses *****************************

    label: "Dimension and Item Trends"
  }


}
page #Heatmaps {
  label: "Heatmaps"

  widget headline #headlineWidget_2 {

    hide: true
    label: ""
    tile text #valueTile {
      value: "Max Score =" + toText(Round(@maxminselector.selected.max, 0)) + "%. " + "Min Score =" + toText(Round(@maxminselector.selected.min, 0)) + "%"
      hide: true
      valueFormatter: percentNoDecimal
    }
    tile markdown {
      value: "Max Score =" + toText(Round(@maxminselector.selected.max, 0)) + "%. " + "Min Score =" + toText(Round(@maxminselector.selected.min, 0)) + "%"

    }

  }
  widget headline #headlineWidget {
    label: "Heatmaps"
    cardCorners: 10px
    size: large
    tile text #textTile_2 {
      value: "Heatmaps displays scores within the team/unit & across your organization using dynamic colour gradients to show scores relative to one another"
      fontSize: 25
    }
    cardText: #ffffff
    cardTransparent: false
    cardBackground: #002c77
    cardShadow: false
  }


  widget dataGrid #super {
    cardCorners: 10px
    viaStrategy: shortest
    filter expression {
      value: @cp.currentwave

    }
    suppressRule {
      criteria: @cp.currenthasdata = false

    }

    filter expression {
      value: .dg1_dimensions:Id != "Engagement"
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    description: @heatmapdescription1
    view cellVisualization #heatmapview1 {
      backgroundColorFormatter: dynamicheatmapbackgroundcolor
      valueColorFormatter: dynamicheatmapbackgroundcolorvalue

    }
    virtualize: true
    suppression recordsBase {
      threshold: 5
    }
    size: large
    select #rows {
      label: "Select view"
      //{label: "Questions in rows" value: {rows: countsinrow, @questionselector.selected.activerowquestion columns: @rootselector.selected.activecolumncuts}}
      options: item {label:"Dimensions and Items" value: both},
      item { label:Dimensions value:dimensions },
      item { label:Items value:items }
    }
    activeRows: @rows.selected

    row nestedHeaders #engagementboth {
      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #engagementdimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
        filter expression {
          value: IN(.dg1_dimensions:Id, "Engagement")
        }

      }

      child list #engagementitems {
        filter expression #includeengagementitems {
          value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
        }
        total: none
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }

    row nestedHeaders #both {
      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #favorable {
      label: "Unit Score"
    }
    column #overall {
      hide: true
      label: "Overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }
    }


    //***********************cell for favorable, overall****************************

    cell {
      view: heatmapview1
      row: dimensions, engagementdimensions
      column: favorable, overall
      value: :dimensionTopTwoNEW2()
      format: percentNoDecimal
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }

    }
    cell {
      view: heatmapview1
      row: items, engagementitems
      column: favorable, overall
      value: :itemTopTwo()
      format: percentNoDecimal
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{score}"

    }

    label: "Unit Scores Heatmap"
  }
  widget dataGrid #copy_of_dataGridWidget_2 {
    cardCorners: 10px
    description: @cp.heatmapdescription2

    filter expression {
      value: @cp.currentwave
    }

    navigateTo: Heatmapdrilldown
    label: "Organizational/Demographic Heatmap"
    viaStrategy: shortest
    via: .dg1_dimensionScore:
    virtualize: true
    size: "large"




    select #rowselector {

      label: "Select rows"
      mode: single
      options: item {label: "Hierarchy" value: comparisonRow},item {label: "Demographic variable" value: cutRow}
    }

// select #showDemoCutSelector {
//   options: item {label: "Show" value: false},item {label: "Hide" value: true}
// }

    select #demoCutSelector {
      options: @demographics.items
      label: "Choose a Demographic cut"
      defaultOption: :gender
    }

    select #columnselector {
      label: "Select columns"
      mode: single
      options: item {label: "Dimensions" value: count, dimensionengagement, dimensioncut},item {label: "Items" value: count, itemscut}
    }
    activeRows: @rowselector.selected
    activeColumns: @columnselector.selected

    view cellVisualization #heatmapview1 {
      backgroundColorFormatter: heatmapbackgroundcolor
      valueColorFormatter: heatmapbackgroundcolorvalue

    }
    removeEmptyRows: true
    column #count {
      cell #cell {
        value: count(:responseid)
        format: numberFormatter
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
      label: "N"
    }
    removeEmptyColumns: true
    column cut #dimensionengagement {
      filter expression {
        value: .dg1_dimensions:Id = "Engagement"
      }
      total: none
      value: .dg1_dimension_question:dimensionId
      cell {
        suppression respondentsBase {
          threshold: 5
        }
        view: heatmapview1

        value: :engagementscore()
        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column cut #dimensioncut {
      filter expression {
        value: .dg1_dimensions:Id != "Engagement"
      }
      total: none
      value: .dg1_dimension_question:dimensionId
      cell {
        suppression respondentsBase {
          threshold: 5
        }
        view: heatmapview1

        value: :dimensionTopTwoNEW2()
        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column cut #itemscut {

      total: none
      value: .dg1_questionScore:dg1_questionScore
      cell {
        suppression respondentsBase {
          threshold: 5
        }
        view: heatmapview1

        value: :itemTopTwo()
        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    row cut #cutRow {
      value: @demoCutSelector.selected
    }

    row comparison #comparisonRow {
      reportingHierarchy: selfRefLookupReportinghierarchy
      showTotal: false
    }
  }

  config layout #layoutConfig {
    horizontalAlignmentMode: "threeColumnsCentered"
  }
}
config headerBarTheme #headerBarThemeConfig {
  tabsTextColor: #002c77
  activeTabColor: #1292d8
}
config layout #layoutConfig {
  horizontalAlignmentMode: "threeColumnsCentered"
  pageBackgroundColor: "#002c77" //"
}


page #ResponseRates {
  label: "Response Rates"

  filter expression {
    value: @cp.currentwave

  }

  // access rules {
  //   rule claim {
  //     name: userRole
  //     value: "HR"
  //   }
  //}

  widget headline #forlow {
    hide: @cp.responseratehide
    cardCorners: 10px
    label: "Response Monitor"
    size: small

    view icon #iconview {
      icon: genderNeutral
      precision: exact
      columns: 10
      rows: 1
      max: 100
    }
    view numeric #numericView {
      max: 10
    }
    tile infographic #infographicTile_2 {
      hide: @cp.responseratehide
      value: count(:, @cp.completes) / count(.respondent:) * 100
      view: iconview

     //colorFormatter: responserate
    }


//  switch #switch {
//         linkedToValue: @currentScore
//         case #case {
//           condition: "<50"
//           body #body {
//             value: "Score is significantly below trend, and benchmark"
//             style #bodyStyle {



    tile markdown #markdownTile_2 {
      value: "### This year **" + ToText(count(:, @cp.completes)) + "** out of " + ToText(count(.respondent:)) + " completed the survey, which gives response rate:"
    }



    cardBackground: #ffffff
    tile value #valueTile_3 {
      hide: @cp.responseratehide
      value: count(:, @cp.completes) / count(.respondent:) * 100
      valueFormatter: percentDefaultFormatter
    }


    cardTransparent: false

  }
  widget headline #copy_of_forlow {
    hide: @cp.responsehide
    cardCorners: 10px
    label: "Response Monitor"
    size: small

    view icon #iconview {
      icon: genderNeutral
      precision: exact
      columns: 10
      rows: 1
      max: 100
    }
    view numeric #numericView {
      max: 10
    }
    tile infographic #infographicTile_2 {
      hide: @cp.responseratehide
      value: count(:, @cp.completes) / count(.respondent:) * 100
      view: iconview

    }


    tile markdown #markdownTile_2 {
      value: "Completed:"
    }

    tile value {
      hide: @cp.responsehide
      value: count(:, @cp.completes)
    }

    cardBackground: #ffffff
    tile value #valueTile_3 {
      hide: @cp.responseratehide
      value: count(:, @cp.completes) / count(.respondent:) * 100
      valueFormatter: percentDefaultFormatter
    }


    cardTransparent: false

  }

  widget chart #chartWidget {
    cardCorners: 10px
    removeEmptyCategories: true
//     label: "By time"
    series #series {
      chart line #barChart {
      }
      value: count(:interview_start)
    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    palette: palette_3
    category date #cutCategory {
      value: :interview_start
      breakdownBy: "calendarDate"

      format: dateDefaultFormatter
    }
    size: medium
    label: "Day By Day"
  }

  widget dataGrid #copy_of_dataGridBetaWidget_2_2 {
    cardCorners: 10px

    label: "Response monitor per demographic variable"

    size: large
    showLegend: true

    select #select_2 {
      options: @demographics.items
      label: "Pick a question"
      defaultOption: surveyDataset:Country
    }
    suppression respondentsBase {
      threshold: 5
      table: :
    }

    column {
      label: "Count"
      cell {
        value: count(.response:, :status = "complete")
        style {
          alignItems: center
        }
      }
      size: medium
    }

    column {
      hide: @cp.responseratehide
      label: "Invited"
      cell {
        value: count(.respondent:)
        style {
          alignItems: center
        }

      }
    }

    column {
      hide: @cp.responseratehide
      label: "Response Rate"
      cell {
        value: count(:, :status = "complete") / count(.respondent:) * 100
        format: percentDefaultFormatter
        style {
          alignItems: center
        }
      }
    }

    row cut #row {
      value: @select_2.selected
    }
  }
  widget dataGrid #copy_of_copy_of_dataGridBetaWidget_2_2 {
    cardCorners: 10px

    label: "Response rate per hierarchy"

    size: large
    showLegend: true

    suppression respondentsBase {
      threshold: 5
      table: :
    }


    row comparison {

      reportingHierarchy: selfRefLookupReportinghierarchy
      showTotal: false

    }

    column #counts {
      label: "Count"
      cell {
        value: count(.response:, :status = "complete")
        style {
          alignItems: center
        }
      }
      size: medium
    }

    column #invited {
      hide: @cp.responseratehide
      label: "Invited"
      cell {
        value: selfRefLookupReportinghierarchy:invited //additional column
        style {
          alignItems: center
        }

      }
    }

    column {
      hide: @cp.responseratehide
      label: "Response Rate"
      cell {
        value: count(:, :status = "complete") / parseint(selfRefLookupReportinghierarchy:invited) * 100 //count(.respondent:) * 100 
        format: percentDefaultFormatter
        style {
          alignItems: center
        }
      }
    }
  }

  hide: false
  modal: false
}


page #printwhole {
  label: "PDF Export"
  layoutArea toolbar {
    hide: false
  }
  layoutArea header {

    // layout column {
    // }
    layout row {
      // widget userSettings {

      // }
      widget pageNavigation {

      }
    }
  }


  dataTable #dtscopeprint {
    dataGrid #dataGridWidget_2 {
      label: "Finding level with 30 or more"
      size: "large"
      row #row {
        label: "count completes in currentwave"

      }
      column #scope {
        label: "scope to use"
        cell custom {
          formula #scopetouse {
            value: IIF(value[column = /self] > 30, "ParentsFromCurrent 0", IIF(value[column = /parent1] > 30, "ParentsFromCurrent 1", IIF(value[column = /parent2] > 30, "ParentsFromCurrent 2", "ParentsFromCurrent 3")))

          }
          formatString: "{scopetouse} "

        }
      }
      column #self {
        label: "SELF"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: "ParentsFromCurrent 0"
        }
        cell #cell {
          value: count(:, @cp.completes AND @cp.currentwave)
        }
      }
      column #parent1 {
        label: "parent1"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: "ParentsFromCurrent 1"
        }
        cell #cell {
          value: count(:, @cp.completes AND @cp.currentwave)
        }
      }
      column #parent2 {
        label: "parent2"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: "ParentsFromCurrent 2"
        }
        cell #cell {
          value: count(:, @cp.completes AND @cp.currentwave)
        }
      }
    }
    map #m {
      from: row
      //ifEmpty: "-"
    }
  }

  dataTable #comparisonIndexYearprint {
    dataGrid {

      row #r {
      }

      column #currentCycle {
        filter expression {
          value: @cp.currentwave
        }
        cell {
          value: :engagementscore()
        }
      }

      column #overall {
        filter expression {
          value: @cp.currentwave
        }
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: AllData
        }
        cell {
          value: :engagementscore()
        }
      }

      column #yearWave {
        filter expression {
          value: @comparisonPeriodSelector.selected.filter
        }
        cell {
          value: :engagementscore()
        }
      }

      column #norm {
        cell {
          value: lookup value {
            source: KeyMetricNorm
            mapping value {
              value: @benchmarksListItemsSelector.selected
              selector: NormId
            }
            value: KeyMetricScore
          }
        }
      }
    }

    map #m {
      from: r
    }
  }

  dataTable #categoryListprint {
    dataGrid #dataGridWidgetCats {
      viaStrategy: shortest

      column #favScores {
        cell custom {
          expression #count {
            value: count(.dg1_dimensionScore:dimensionScoreValue)

          }
          expression #toofewtext {
            value: @cp.toofewresponses

          }
          formula #value {
            value: IIF(count[] < @cp.confidentiality, toofewtext[], score[])
          }
          expression #score {
            value: :dimensionTopTwoNEW2()
          }
          formula #value2 {
            value: IsNull(score[], "na")
          }
          headerInfo #label {
            headerId: cats
            type: label
          }
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }
          formatString: "{label} - {value} {count}"

        }
      }

      column #favScoresPrev {
        filter expression {
          value: @cp.previouswave
        }
        cell custom {
          expression #count {
            value: count(.dg1_dimensionScore:dimensionScoreValue)

          }
          expression #toofewtext {
            value: @cp.toofewresponses

          }
          formula #value {
            value: IIF(count[] < @cp.confidentiality, toofewtext[], score[])
          }
          expression #score {
            value: :dimensionTopTwoNEW2()
          }
          formula #value2 {
            value: IsNull(score[], "na")
          }
          headerInfo #label {
            headerId: cats
            type: label
          }
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }
          formatString: "{label} - {value} {count}"

        }

      }

      column #microchart {
        cell microchart {
          value: sum(.dg1_dimensionScore:favorabilityCounts2point)
          microchart pie {
          }
        }
      }

      column #diff {
        cell custom {
          formula #value {
            value: value[column = /favScores] - value[column = /favScoresPrev]
          }

          formula #value2 {
            value: IsNull(value[], "na")
            formatter: upordown
          }

          formula #color {
            value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
          }

          headerInfo #label {
            headerId: cats
            type: label
          }

          formatString: '<span style ="color:{color}">{value} {value2}</span>'
          //formatString: '{label} - {value}'
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }

        }
      }
      row cut #cats {
        value: .dg1_dimensionScore:dg1_dimensionScore
        total: "none"
        filter expression #expressionFilter {
          value: :keyindices()
        }
      }

      removeEmptyRows: true
      removeEmptyColumns: true
    }

    map #m {
      from: cats
      ifEmpty: "-"
    }
  }

  dataTable #top3dimcorrprint {
    dataGrid #dimqatable {//Start of My Team View Key Drivers
      label: "Top 3 DIM corr between other dims and Engagement"
      size: large
      cardCorners: 10px
      viaStrategy: shortest
      filter expression {
        value: .dg1_dimensions:Id != "Engagement" AND .dg1_dimensions:Id != "Engagement_Legacy" AND .dg1_dimensions:Id != "Intent_to_stay"
      }
      sort rows {
        sortBy: "/cof"
        sortOrder: descending
        //takeTop: 3
      }

      row list #dimensions {
        total: none
        value: ""//.dg1_dimensions:id
        table: .dg1_dimensions:
      }

      column #_label {
        label: "dimlabel"
        cell {
          value: .dg1_dimensions:id
        }
      }
      column #_id {
        label: "Dim id"
        cell {
          value: .dg1_dimensions:id + "" //calls the code
        }
      }
      column #cofrank {
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }
        hide: false
        label: "Highest Impact Rank"
        cell {
          value: RankRev(correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension))
          style #body {
            alignItems: 'center'
            textAlign: 'center'
          }
        }
      }
      column #cof {
        hide: false
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }

        label: "Correlation"
        cell {
          value: correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)
        }
      }
      column #favorable {
        label: "Total Favorable Score"
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }
      }
      column #overall {
        filter expression #tempcyclefilter {
          value: @cp.currentwave
        }
        hide: false
        label: "overall"
        scope reportingHierarchy {
          reportingHierarchy: selfRefLookupReportinghierarchy
          nodes: AllData
        }

      }
      column #priorcycle {
        hide: false
        label: "priorcycle"
        filter expression #tempcyclefilter {
          value: @cp.previouswave
        }
      }

      column #norm {
        hide: false
        cell custom {
          row: dimensions
          expression #mean {
            value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
       // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)

      // no. of questions behind each norm:  value: count(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue= 6 AND momentum_norms_legacy.ResponseCounts:NormId= @benchmarksListItemsSelector.selected)
     // check against dg on QA page

          }
          formula #value {
            value: mean[] / 1000
            formatter: percentNoDecimal

          }
          expression #sequenceid {
            value: .dg1_dimensions:sequenceId
          }
          formatString: "{value}"

        }
        label: "norm"
      }


      cell custom {
        row: dimensions
        column: favorable, overall,priorcycle
        expression #value {
          value: :dimensionTopTwoNEW2()
          formatter: percentNoDecimal
        }
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
        formatString: "{value}"

      }
    }
    // map #map2 {
    //   from: dimensions
    //   to:  {
    //     cofrank: this.cofrank.value
    //     label: this._label.value
    //     _id: this._id.value
    //   }
    //   toRecord byKey {
    //     key: this._id.value
    //   }
    // }

    // map #map3 {
    //   from: dimensions
    // }

    map #map {
      from: dimensions
      to:  {
       // totalrankscore: this.totalrankscore.value
//dimensionlabel: this.dimensionlabel.value
        sequenceid: this.norm.sequenceid
        coefficient: this.cof.value
        cofrank: this.cofrank.value
        overall: this.overall.value
        priorcycle: this.priorcycle.value
        norm: this.norm.value
        favorable: this.favorable.value
        label: this._label.value
        _id: this._id.value
      }
      toRecord byIndex {

      }
    }
  }

  widget markdown #markdownWidget_0 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
  }


  widget headline #copy_of_markdownWidget_0 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget canvas #HealthCheckWidget {
    cardCorners: 10px
    cardTransparent: false

    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    label: "Health Check"
    container: container position {
      width: 1368px
      height: "449px"
      area #area_37 {
        position: "absolute"
        top: "160px"
        left: "521px"
      }
      area #area_36 {
        position: "absolute"
        top: "160px"
        left: "1070px"
      }
      area #area_35 {
        position: "absolute"
        top: "160px"
        left: "106px"
      }
      area #headerarea {
        position: "absolute"
        top: "0px"
        left: "18px"
      }
      area #headerarea_2 {
        position: "absolute"
        top: "37px"
        left: "18px"
      }
      area #headerarea_3 {
        position: "absolute"
        top: "20px"
        left: "910px"
      }
      area #area {
        position: "absolute"
        top: "177px"
        left: "106px"
      }
      area #area_2 {
        top: "223px"
        left: "172px"
        position: "absolute"
      }
      area #area_3 {
        top: "289px"
        left: "246px"
        position: "absolute"
      }
      area #area_4 {
        top: "321px"
        left: "246px"
        position: "absolute"
      }
      area #area_5 {
        position: "absolute"
        top: "287px"
        left: "124px"
      }
      area #area_6 {
        position: "absolute"
        top: "321px"
        left: "140px"
      }
      area #area_8 {
        position: "absolute"
        top: "176px"
        left: "1097px"
      }
      area #area_10 {
        position: "absolute"
        top: "240px"
        left: "1047px"
      }
      area #area_11 {
        position: "absolute"
        top: "272px"
        left: "1068px"
      }
      area #area_12 {
        position: "absolute"
        top: "308px"
        left: "1047px"
      }
      area #area_13 {
        position: "absolute"
        top: "83px"
        left: "358px"
      }
      area #area_14 {
        top: "238px"
        left: "1229px"
        position: "absolute"
      }
      area #area_15 {
        position: "absolute"
        top: "233px"
        left: "1213px"
      }
      area #area_16 {
        position: "absolute"
        top: "273px"
        left: "1229px"
      }
      area #area_17 {
        position: "absolute"
        top: "269px"
        left: "1213px"
      }
      area #area_18 {
        position: "absolute"
        top: "311px"
        left: "1233px"
      }
      area #area_19 {
        position: "absolute"
        top: "307px"
        left: "1213px"
      }
      area #benchmarkChart_Marker {
        position: "absolute"
        top: "378px"
        left: "430px" //offset 20 to get it precise
      }
      area #benchmarkChart_TopLabel {
        position: "absolute"
        top: "378px"
        left: "450px"
      }
      area #benchmarkChart_BottomLabel {
        position: "absolute"
        top: "378px"
        left: "450px"
      }
      area #benchmarkChart_TopQuartValue {
        position: "absolute"
        top: "74px"
        left: "7px"
      }
      area #benchmarkChart_BottomQuartValue {
        position: "absolute"
        top: "74px"
        left: "102px"
      }
      area #area_31 {
        position: "absolute"
        top: "364px"
        left: "394px"
      }
      area #divider_left {
        position: "absolute"
        top: "170px"
        left: "358px"
      }
      area #divider_right {
        position: "absolute"
        top: "170px"
        left: "1050px"
      }
      area #area_33 {
        position: "absolute"
        top: "240px"
        left: "598px"
      }
      background: #ffffff
    }
    tile text #headertextTile {
      value: "Health Check"
      areaId: "headerarea"
      style #style {
        fontSize: 18
        fontWeight: "bold"
      }
    }
    tile text #headertextTile_2 {
      value: "Reflection of employees' current feelings towards their experience at the company including their job, role, and the organization overall."
      areaId: "headerarea_2"
      style #style {
        fontSize: 18
        fontWeight: 600
        fontFamily: "Source Sans Pro"
      }
    }


    tile text #textTile {
      value: IIF(@cp.responseratehide = false, "Participation Rate", "Participation Rate")
      areaId: "area"
      style #style {
        fontSize: 23
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        textAlign: "center"
        width: "220px"
        height: "46px"
      }
    }
    tile value #valueTile {
      areaId: "area_2"
      label: "Response Rate (Does not include partials)"
      value: @DTResponseRates.m.data.responseRate.currentResponseRate
      style #style {
        justifyContent: "center"
        alignItems: "start"
        fontSize: 27
        width: "88px"
        height: "66px"
        color: #7d7d7d
        fontFamily: "Trebuchet MS"
      }
      valueFormatter: percentNoDecimal
    }
    tile value #valueTile_2 {
      areaId: "area_3"
      label: "Number of responses"
      value: @DTResponseRates.m.data.responses.currentResponses
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 16
        fontWeight: "bold"
        color: #7d7d7d
        fontFamily: "Trebuchet MS"
      }
      valueFormatter: numberFormatter
    }
    tile value #valueTile_3 {
      areaId: "area_4"
      label: "Number of invited"
      //hardcode
      value: IIF(@cp.responseratehide = false, @DTResponseRates.m.data.respondents.currentRespondents)
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 16
        color: #7d7d7d
        fontFamily: "Trebuchet MS"
        fontWeight: "bold"
      }
      valueFormatter: numberFormatter
    }
    tile text #textTile_2 {
      value: "Completed"
      areaId: "area_5"
      style #style {
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "113px"
        height: "32px"
        textAlign: "right"
        fontSize: 18
      }
    }
    tile text #textTile_3 {
      value: IIF(@cp.responseratehide = false, "Invited", " ")
      areaId: "area_6"
      style #style {
        fontSize: 18
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "93px"
        height: "32px"
        textAlign: "right"
      }
    }
    //PRY
    tile text #textTile_4 {
      value: "Comparisons"
      areaId: "area_8"
      style #style {
        fontSize: 23
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "193px"
        height: "32px"
        fontWeight: "bold"
      }
    }
    tile text #textTile_6 {
      value: @comparisonPeriodSelector.selectedLabel //"Prior Cycle:"
      areaId: "area_10"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "170px"
        height: "32px"
        fontWeight: "bold"
        textAlign: "right"
      }
    }
    tile text #textTile_7 {
      value: "Company Overall:"
      areaId: "area_11"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "149px"
        height: "32px"
        fontWeight: "bold"
        textAlign: "right"
      }
    }
    tile text #textTile_8 {
      value: @benchmarksListItemsSelector.selectedLabel
      areaId: "area_12"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "170px"
        height: "32px"
        fontWeight: "bold"
        textAlign: "right"
      }
    }
    tile text #textTile_9 {

      value: " " //Insight Text
      areaId: "area_13"
      style #style {
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        textAlign: "center"
        width: "695px"
        height: "61px"
        fontSize: 25
      }
      label: "Insight Text"
    }
    tile value #valueTile_5 {
      areaId: "area_14"
      label: "Engagement Prior Year"
      valueFormatter: bigNumberFormatter
      value: @comparisonIndexYearprint.m.data.currentCycle.value - @comparisonIndexYearprint.m.data.yearWave.value
      style #style {
        justifyContent: "center"
        alignItems: "center"
        fontSize: 18
        width: "43px"
        height: "35px"
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
      }
    }
    tile text #textTile_10 {
      value: " "
      areaId: "area_15"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "32px"
        height: "43px"
        fontWeight: "bold"
      }
      label: "Prior Indicator"
      switch #switch {
        linkedToValue: @valueTile_5
        case #case {
          condition: "<0"
          body #body {
            value: "↓"
            style #bodyStyle {
              fontSize: 25
              fontFamily: "Trebuchet MS"
              color: #7d7d7d
              textAlign: "center"
            }
          }
        }
        case #case_2 {
          condition: ">0"
          body #body {
            value: "↑"
            style #bodyStyle {
              fontSize: 25
              textAlign: "center"
              color: #7d7d7d
            }
          }
        }
        case #case_3 {
          condition: "=0"
          body #body {
            value: "↔"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 15
              color: #7d7d7d
            }
          }
        }
      }
    }
    tile value #valueTile_6 {
      areaId: "area_16"
      label: "Engagement Overall"
      value: @comparisonIndexYearprint.m.data.currentCycle.value - @comparisonIndexYearprint.m.data.overall.value
      style #style {
        justifyContent: "center"
        alignItems: "center"
        fontSize: 18
        width: "43px"
        height: "35px"
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
      }
      valueFormatter: bigNumberFormatter
    }
    tile text #textTile_11 {
      value: " "
      areaId: "area_17"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "32px"
        height: "43px"
        fontWeight: "bold"
      }
      label: "Prior Indicator"
      switch #switch {
        linkedToValue: @valueTile_6
        case #case {
          condition: "<0"
          body #body {
            value: "↓"
            style #bodyStyle {
              fontSize: 25
              fontFamily: "Trebuchet MS"
              color: #7d7d7d
              textAlign: "center"
            }
          }
        }
        case #case_2 {
          condition: ">0"
          body #body {
            value: "↑"
            style #bodyStyle {
              fontSize: 26
              textAlign: "center"
            }
          }
        }
        case #case_3 {
          condition: "=0"
          body #body {
            value: "↔"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 15
              color: #7d7d7d
            }
          }
        }
      }
    }
    tile value #valueTile_7 {
      areaId: "area_18"
      label: "Top Quartile"
      value: @comparisonIndexYearprint.m.data.currentCycle.value - @comparisonIndexYearprint.m.data.norm.value

      style #style {
        justifyContent: "center"
        alignItems: "center"
        fontSize: 18
        width: "43px"
        height: "35px"
        fontWeight: "bold"
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
      }
      valueFormatter: bigNumberFormatter
    }
    tile text #textTile_12 {
      value: " "
      areaId: "area_19"
      style #style {
        fontSize: 15
        fontFamily: "Trebuchet MS"
        color: #7d7d7d
        width: "32px"
        height: "43px"
        fontWeight: "bold"
      }
      label: "Prior Indicator"
      switch #switch {
        linkedToValue: @valueTile_7
        case #case {
          condition: "<0"
          body #body {
            value: "↓"
            style #bodyStyle {
              fontSize: 25
              fontFamily: "Trebuchet MS"
              color: #7d7d7d
              textAlign: "center"
            }
          }
        }
        case #case_2 {
          condition: ">0"
          body #body {
            value: "↑"
            style #bodyStyle {
              fontSize: 26
              textAlign: "center"
            }
          }
        }
        case #case_3 {
          condition: "=0"
          body #body {
            value: "↔"
            style #bodyStyle {
              fontWeight: "bold"
              fontSize: 15
              color: #7d7d7d
            }
          }
        }
      }
    }
    //Begin Chart

    tile value #topQuartileValue {
      areaId: "benchmarkChart_TopQuartValue"
      label: "75th"
      value: 85
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 55
        width: "86px"
        height: "85px"
        color: "#ffffff"
      }
    }
    tile value #bottomQuartileValue {
      areaId: "benchmarkChart_BottomQuartValue"
      label: "25th"
      value: 55
      style #style {
        justifyContent: "start"
        alignItems: "start"
        fontSize: 55
        width: "86px"
        height: "85px"
        color: "#ffffff"
      }
    }

    tile text #textTile_22 {
      value: "  "
      areaId: "area_35"
      style #style {
        fontSize: 24
        width: "220px"
        height: "204px"
      }
      label: "Participation Box"
    }
    tile text #textTile_23 {
      value: "  "
      areaId: "area_36"
      style #style {
        fontSize: 24
        width: "220px"
        height: "204px"
      }
      label: "Comparison Box"
    }

    tile custom #text {
      areaId: area_33
      formatString: 'Current Cycle<br><span style="font-size: 2em;">{value}</span>'
      expression #value {
        value: :engagementscorecurrentwave()
        formatter: percentNoDecimal
      }
      expression #targetValue {
        value: :engagementscorepreviouswave()
        formatter: percentNoDecimal
      }
      formula #diffToTarget {
        value: value[] - targetValue[]
        formatter: percentNoDecimal
      }
      // switch {
      //   byValue: diffToTarget
      //   case {
      //     condition: "<0"
      //     body {
      //       formatString: 'Current Cycle <br><span style="font-size: 2em;">{value}</span><br>is below target<br>{diffToTarget}'
      //     }
      //   }
      //   case {
      //     condition: ">0"
      //     body {
      //       formatString: 'Your value <br><span style="font-size: 2em;">{value}</span><br>is above target<br>{diffToTarget}'
      //     }
      //   }
      //   case {
      //     condition: "=0"
      //     body {
      //       formatString: 'Your value<br><span style="font-size: 2em;">{value}</span><br>is at target'
      //     }
      //   }
      //   case {
      //     condition: isNull
      //     body {
      //       formatString: 'Your value<br><span style="font-size: 2em;">{value}</span>'
      //     }
      //   }
      // }
      style {
        fontSize: 22px
        fontWeight: bold
        textAlign: center
      }
    }

    tile custom #gauge {
      formatString: ""
      areaId: area_37
      style {
        width: '100%'
        height: '100%'
      }
      expression #value {
        value: :engagementscorecurrentwave()
      }
      expression #minValue {
        value: 0
      }
      expression #maxValue {
        value: 100
      }
      expression #targetValue {
        value: :engagementscorepreviouswave()
      }
      formula #belowTarget {
        value: value[]//IIF(value[] < targetValue[], value[])
      }
      formula #aboveTarget {
        value: value[]//IIF(value[] >= targetValue[], value[])
      }
      formula #noTarget {
        value: value[]//IIF(isNull(targetValue[], true), value[])
      }
        /*
        later
        formula #zones {
          value = zones[tile = datum]
        }
        */

      view svg {

          //viewBox: "0 0 100 100"
        group polar #gauge {
          cx: 50
          startAngle: 180
          endAngle: 0
          max: this.maxValue
          min: this.minValue
          shape sectors #zones {
            valueType: 'cumulative'
            innerRadius: '36%'
            outerRadius: '39%'
            padAngle: 0.4
            palette: zones
              /*
              later
              value: this.zones
              */
            value: {value: @cp.bottomquartile label: "Bottom Quartile"}, {value: @cp.moderatezone label: "Moderate Zone"}, {value: @cp.topquartile label: "Top Quartile"}, {value: 47 label: "third"}, {value: 50 label: "forth"}, {value: 65 label: "third"}, {value: 80 label: "third"}, {value: 100 label: "third"}
          }
          shape sectors #background {
            innerRadius: '42%'
            outerRadius: '48%'
            palette: metricBackgroundPalette
            value:  {
              value: this.maxValue
              label: ""
            }
          }
          shape sectors #metric {
            palette: metricValuePalette
            innerRadius: '42%'
            outerRadius: '48%'
            value: { value: this.belowTarget label: "" }, { value: this.aboveTarget label: "" }, { value: this.noTarget label: "" }
          }
          shape custom #target {
            angle: this.targetValue
            radius: '50%'
            // value: '<path stroke=black d="M0,0 L-10,0" />'
            value: '<line x1="0" y1="0" x2="9.5%" y2="0" style="stroke:black;stroke-width:1" />'
          }
          // shape custom #secondTarget {
          //   angle: this.secondTarget
          //   radius: '80%'
          //   value: '<path stroke="#777777" d="M0,0 L-10,0" />'
          // }
          shape custom #scaleMin {
            angle: this.minValue
            radius: '45%'
            rotate: false
            value: '<text transform="translate(0,6)" font-size=7 text-anchor="middle" fill="grey">{this.minValue}</text>'
          }
          shape custom #scaleMax {
            angle: this.maxValue
            radius: '45%'
            rotate: false
            value: '<text transform="translate(0,6)" font-size=7 text-anchor="middle" fill="grey">{this.maxValue}</text>'
          }
        }
      }
    }

    tile custom #legend {
      areaId: area_31
      formula #btext {
        value: @cp.bottomquartiletext + " (0-" + @cp.bottomquartileastext + "%)  "
      }
      formula #mtext {
        value: @cp.moderatezonetext + " (" + @cp.bottomquartileastext + "-" + @cp.moderatezoneastext + "%)  "
      }
      formula #ttext {
        value: @cp.topquartiletext + " (" + @cp.moderatezoneastext + "-" + @cp.topquartileastext + "%)"
      }
      formula #trtext {
        value: @cp.priorcycletext
      }
      formatString: '<span style="color:#D03131;">▉</span> {btext} <span style="color:#FCB429;">▉</span> {mtext} <span style="color:#5C2E8E;">▉</span> {ttext} <br><span style="font-weight: bold;">—</span> {trtext} '

      style {
        fontSize: 16px
        alignItems: "center"
        textAlign: "center"
        fontFamily: "Trebuchet MS"
        fontWeight: bold
      }
    }

    tile image #left_divider {
      value: @cp.dividervertical
      areaId: "divider_left"
      style #style {
        width: "3px"
        height: "65px"
      }
      label: "Divider"
    }
    tile image #right_divider {
      value: @cp.dividervertical
      areaId: "divider_right"
      style #style {
        width: "3px"
        height: "65px"
      }
      label: "Divider"
    }
  }
  widget markdown #markdownWidget_2 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_2 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget headline #keyindices {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }

    label: "Key Indices"
    container: container flex {
      flexDirection: row
      flexWrap: wrap
      area #donuts {
        width: '100%'
        display: flex
        paddingLeft: 30px
        paddingBottom: 10px
        justifyContent: "center"//"space-evenly"
      }

    }

    tile set #tileSet {
      areaId: donuts

      container: container grid {
        rows: 'A A A A A'
        justifyContent: spaceEvenly

      }
      itemContainer: container flex {
        flexDirection: column
        width: 250px

        area #label {
          height: 40px
          display: block
          textAlign: "center"
        }
        area #main {
          position: relative
          area #donut {
          }
          area #center {
            position: absolute
            top: 30px

          }
          area #indicator {
            position: absolute
            left: 95px
            top: 100px
          }
          area #arrow {
            position: absolute
            left: 130px
            top: 100px
          }

        }

      }

      breakdownBy inlineData {
        value: @categoryListprint.m.data
      }

      tile value #diff {
        areaId: indicator
        value: this.diff.value
        valueColorFormatter: tileset
        fontSize: 24
      }

      tile value #arrow {
        value: this.diff.value2
        valueFormatter: upordown
        valueColorFormatter: tileset
        areaId: arrow
        fontSize: 24
      }

      tile text #textTile {
        areaId: label
        value: this.favScores.label
        fontSize: 18
        fontWeight: 'bold'
        textAlign: "center"
      }

      tile value #valueTile {
        areaId: center
        value: this.favScores.value
        fontSize: 45
        valueFormatter: percentNoDecimal
      }
      tile microchart #kpiMicrocharts {
        areaId: donut
        value: this.microchart.value
        format: floatDefaultFormatter

        microchart pie {
          donutWidth: 20%
          startAngle: 220
          endAngle: -40
          palette: mercer_1_color
          valuePosition: none
          showTooltip: false
        }
        style {
          height: 170px
          width: 200px

        }
      }

    }
    size: large
  }


  widget markdown #markdownWidget_4 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true

  }


  widget headline #copy_of_markdownWidget_4 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget chart #chartWidget {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    label: "Engagement Distribution"
    series #series {
      chart bar #barChart {
        mode: "clustered"
        palette: 'mercer'
      }
      value: count(.response:responseid)
      palette: mercer
      percentOver: "categories"
      format: percentNoDecimal
      breakdownBy cut #cutBreakdownby {
        value: :wavereverted2
        categories: @cp.engagementmodelB_yearcategories

      }
      label: "Engagement Levels"
    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    category cut #cutCategory {
      value: .response:EngagementDistribution

    }
    size: large


    series #norms {
      label: @benchmarksListItemsSelector.selectedLabel
      chart line #barChart {
      }
      value: lookup value {
        source: keymetricdistributions
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping header {
          header: cutCategory
          selector: Level
        }
        value: Norm
      }
      palette: palette_5
    }

    legend: "rightTop"

    palette: mercer
  }

  widget markdown #markdownWidget_3 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_3 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }


  widget dataGrid #dataGridWidget {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    filter expression {
      value: @cp.currentwave

    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Manager_support" //Fetch custom
    }
    label: "What Are My Top Scoring Questions?"
    size: "large"
    //viaStrategy: shortest



    via: .dg1_dimension_question:
    sort rows {
      sortBy: "/favScore"
      sortOrder: descending
      takeTop: 5

    }

    row cut #row {
      value: .dg1_questionScore:dg1_questionScore

      total: "none"
      showLabel: false
      label: "Item"
    }

//to display multiple items in the table
    column #column_3 {
      label: "Dimension"
      cell #cell {
        value: aggText(.dg1_dimensions:label, ", ") //max(.dg1_dimensions:label)
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #favScore {
      cell {
        value: :itemTopTwo()

        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
      label: "Total Favorable Score"
    }

    column #favChart {
      width: 500px

      cell microchart #cell {
        suppression respondentsBase {
          threshold: @cp.confidentiality

        }
        microchart stacked100PercentBar #barMicrochart {
          palette: mercer_1_color //@distributionTypeprint.selected.palettequestion
          percentFormat: percentNoDecimal
          showLegend: false //@distributionTypeprint.selected.showlegend
        }

        value: count(.dg1_questionScore:)

        palette: mercer
        breakdownBy cut #cutBreakdownby {
          value: .dg1_questionScore:twoPoint //@distributionTypeprint.selected.question
        }
      }
      label: "Total Favorable Score" //@distributionTypeprint.selected.text
    }
  }
  widget dataGrid #bottomscoring {
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    filter expression {
      value: @cp.currentwave

    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Manager_support" //Fetch custom
    }
    label: "What Are My Bottom Scoring Questions?"
    size: "large"
    //viaStrategy: shortest



    via: .dg1_dimension_question:
    sort rows {
      sortBy: "/favScore"
      sortOrder: ascending
      takeTop: 5

    }

    row cut #row {
      value: .dg1_questionScore:dg1_questionScore

      total: "none"
      showLabel: false
      label: "Item"
    }

    column #column_3 {
      label: "Dimension"
      cell #cell {
        value: max(.dg1_dimensions:label)
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #favScore {
      cell {
        value: :itemTopTwo()

        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }


      }
      label: "Total Favorable Score"
    }

    column #favChart {
      width: 500px

      cell microchart #cell {
        suppression respondentsBase {
          threshold: @cp.confidentiality

        }
        microchart stacked100PercentBar #barMicrochart {
          palette: @distributionTypeprint.selected.palettequestion
          percentFormat: percentNoDecimal
          showLegend: @distributionTypeprint.selected.showlegend
        }

        value: count(.dg1_questionScore:)

        palette: mercer
        breakdownBy cut #cutBreakdownby {
          value: @distributionTypeprint.selected.question// .dg1_questionScore:twoPoint
        }
      }
      label: @distributionTypeprint.selected.text
    }
  }


  // widget canvas #ImpactEngagementprint {
  //   hide: @cp.hideimpact

  //   cardCorners: 10px

  //   label: "FocusAreas"
  //   size: large
  //   container: container position {
  //     width: 1368px
  //     height: "875px"
  //     area #headerarea {
  //       position: "absolute"
  //       top: "0px"
  //       left: "18px"
  //     }
  //     area #headerarea_2 {
  //       position: "absolute"
  //       top: "37px"
  //       left: "18px"
  //     }

  //     area #area_8 {
  //       position: "absolute"
  //       top: "462px"
  //       left: "24px"
  //     }
  //     area #area {
  //       position: "absolute"
  //       top: "104px"
  //       left: "24px"
  //     }
  //     area #area_2 {
  //       position: "absolute"
  //       top: "103px"
  //       left: "470px"
  //     }
  //     area #area_3 {
  //       position: "absolute"
  //       top: "103px"
  //       left: "916px"
  //     }
  //     area #area_4 {
  //       position: "absolute"
  //       top: "122px"
  //       left: "337.15668296193076px"
  //     }
  //     area #area_5 {
  //       position: "absolute"
  //       top: "122px"
  //       left: "791px"
  //     }
  //     area #area_6 {
  //       position: "absolute"
  //       top: "122px"
  //       left: "1245px"
  //     }
  //     area #area_7 {
  //       position: "absolute"
  //       top: "480px"
  //       left: "37px"
  //     }
  //     area #area_9 {
  //       position: "absolute"
  //       top: "558px"
  //       left: "38px"
  //     }
  //     area #area_10 {
  //       position: "absolute"
  //       top: "141px"
  //       left: "52px"
  //     }
  //     area #area_11 {
  //       top: "175px"
  //       left: "52px"
  //       position: "absolute"
  //     }
  //     area #area_12 {
  //       position: "absolute"
  //       top: "241px"
  //       left: "51px"
  //     }
  //     area #area_13 {
  //       top: "269px"
  //       left: "71px"
  //       position: "absolute"
  //     }
  //     area #area_15 {
  //       position: "absolute"
  //       top: "312px"
  //       left: "51px"
  //     }
  //     area #area_16 {
  //       top: "340px"
  //       left: "68px"
  //       position: "absolute"
  //     }
  //     area #area_17 {
  //       position: "absolute"
  //       top: "373px"
  //       left: "52px"
  //     }
  //     area #area_18 {
  //       position: "absolute"
  //       top: "397px"
  //       left: "67px"
  //     }
  //     area #area_19 {
  //       position: "absolute"
  //       top: "141px"
  //       left: "502px"
  //     }
  //     area #area_20 {
  //       position: "absolute"
  //       top: "175px"
  //       left: "502px"
  //     }
  //     area #area_21 {
  //       position: "absolute"
  //       top: "241px"
  //       left: "502px"
  //     }
  //     area #area_22 {
  //       position: "absolute"
  //       top: "269px"
  //       left: "519px"
  //     }
  //     area #area_23 {
  //       position: "absolute"
  //       top: "313px"
  //       left: "502px"
  //     }
  //     area #area_24 {
  //       position: "absolute"
  //       top: "340px"
  //       left: "519px"
  //     }
  //     area #area_25 {
  //       position: "absolute"
  //       top: "373px"
  //       left: "494px"
  //     }
  //     area #area_26 {
  //       position: "absolute"
  //       top: "397px"
  //       left: "514px"
  //     }
  //     area #area_27 {
  //       position: "absolute"
  //       top: "141px"
  //       left: "934px"
  //     }
  //     area #area_28 {
  //       position: "absolute"
  //       top: "175px"
  //       left: "934px"
  //     }
  //     area #area_29 {
  //       position: "absolute"
  //       top: "241px"
  //       left: "934px"
  //     }
  //     area #area_30 {
  //       position: "absolute"
  //       top: "269px"
  //       left: "952px"
  //     }
  //     area #area_31 {
  //       position: "absolute"
  //       top: "313px"
  //       left: "934px"
  //     }
  //     area #area_32 {
  //       position: "absolute"
  //       top: "341px"
  //       left: "954px"
  //     }
  //     area #area_33 {
  //       position: "absolute"
  //       top: "373px"
  //       left: "934px"
  //     }
  //     area #area_34 {
  //       position: "absolute"
  //       top: "397px"
  //       left: "946px"
  //     }
  //     area #area_35 {
  //       position: "absolute"
  //       top: "605px"
  //       left: "37px"
  //     }
  //     area #area_38 {
  //       position: "absolute"
  //       top: "558px"
  //       left: "1198px"
  //     }
  //     area #area_39 {
  //       position: "absolute"
  //       top: "603px"
  //       left: "470px"
  //     }
  //     area #area_40 {
  //       position: "absolute"
  //       top: "603px"
  //       left: "916px"
  //     }
  //     area #area_41 {
  //       position: "absolute"
  //       top: "731px"
  //       left: "37px"
  //     }
  //     area #area_42 {
  //       position: "absolute"
  //       top: "731px"
  //       left: "470px"
  //     }
  //     area #area_43 {
  //       position: "absolute"
  //       top: "731px"
  //       left: "916px"
  //     }
  //     area #area_44 {
  //       position: "absolute"
  //       top: "398px"
  //       left: "344px"
  //     }
  //     area #area_45 {
  //       position: "absolute"
  //       top: "395px"
  //       left: "786px"
  //     }
  //     area #area_46 {
  //       position: "absolute"
  //       top: "392px"
  //       left: "1245px"
  //     }
  //     area #area_47 {
  //       position: "absolute"
  //       top: "425px"
  //       left: "52px"
  //     }
  //     area #area_48 {
  //       position: "absolute"
  //       top: "425px"
  //       left: "502px"
  //     }
  //     area #area_49 {
  //       position: "absolute"
  //       top: "425px"
  //       left: "934px"
  //     }
  //     area #area_50 {
  //       position: "absolute"
  //       top: "20px"
  //       left: "1184px"
  //     }
  //     area #area_51 {
  //       position: "absolute"
  //       top: "275px"
  //       left: "50px"
  //     }
  //     area #area_52 {
  //       position: "absolute"
  //       top: "275px"
  //       left: "503px"
  //     }
  //     area #area_53 {
  //       position: "absolute"
  //       top: "275px"
  //       left: "936px"
  //     }
  //     area #area_54 {
  //       position: "absolute"
  //       top: "345px"
  //       left: "48px"
  //     }
  //     area #area_55 {
  //       position: "absolute"
  //       top: "346px"
  //       left: "502px"
  //     }
  //     area #area_56 {
  //       position: "absolute"
  //       top: "347px"
  //       left: "937px"
  //     }
  //   }

  //   tile text #headertextTile {
  //     value: "How To Positively Impact Engagement?"
  //     areaId: "headerarea"
  //     style #style {
  //       fontSize: 18
  //       fontWeight: "bold"
  //     }
  //   }
  //   tile text #headertextTile_2 {
  //     value: "Improve your employees' engagement by focusing on these opportunity areas."
  //     areaId: "headerarea_2"
  //     style #style {
  //       fontSize: 16
  //     }
  //   }
  //   tile text #textTile_38 {
  //     value: "View All Driver Items"
  //     areaId: "area_50"
  //     navigateTo: driveritemsmodal
  //     navigateOptions: "same_tab"
  //     style #style {
  //       fontSize: 16
  //       background: "#00aa56"
  //       borderRadius: "13.6px"
  //       color: '#ffffff'
  //       fontWeight: "bold"
  //     }
  //   }
  //   tile text #textTile {
  //     value: " "
  //     action setSelector {
  //       value: "1"
  //       select: @layoutselector
  //       compareBy: this.value.id
  //     }

  //     areaId: "area"
  //     style #style {
  //       fontSize: 60
  //       width: "428px"
  //       height: @layoutselector.selected.layouttablesquareoneheight + "px"
  //       background: @layoutselector.selected.layouttablesquareonecolor
  //       borderRadius: "14.559999999999999px"
  //     }
  //     label: "square1"
  //   }
  //   tile text #textTile_2 {
  //     value: " "

  //     action setSelector {
  //       value: "2"
  //       select: @layoutselector
  //       compareBy: this.value.id
  //     }
  //     areaId: "area_2"
  //     style #style {
  //       fontSize: 16
  //       width: "428px"
  //       height: @layoutselector.selected.layouttablesquaretwoheight + "px"
  //       background: @layoutselector.selected.layouttablesquaretwocolor
  //       borderRadius: "14.559999999999999px"
  //     }
  //     label: "square2"
  //   }
  //   tile text #textTile_3 {
  //     action setSelector {
  //       value: "3"
  //       select: @layoutselector
  //       compareBy: this.value.id
  //     }
  //     value: " "
  //     areaId: "area_3"
  //     style #style {
  //       fontSize: 60
  //       width: "429px"
  //       height: @layoutselector.selected.layouttablesquarethreeheight + "px"
  //       background: @layoutselector.selected.layouttablesquarethreecolor
  //       borderRadius: "16.48px"
  //     }
  //     label: "square3"
  //   }

  //   tile value #focusareascore {
  //     value: @layoutselector.selected.layouttablecurrentscore
  //     hide: true
  //   }
  //   tile text #textTile_9 {
  //     value: @layoutselector.selected.layouttablecurrentscoretext
  //     areaId: "area_7"
  //     style #style {
  //       fontSize: 35
  //       fontWeight: "bold"
  //       fontFamily: "Trebuchet MS"
  //       color: #7d7d7d
  //       textAlign: "center"
  //       width: "1296px"
  //       height: "61px"
  //       background: "#EDF4F7"
  //       borderRadius: "13.6px"
  //     }
  //     label: "insighttext"
  //   }

  //   tile text #textTile_8 {
  //     value: " "
  //     areaId: "area_8"
  //     style #style {
  //       fontSize: 60
  //       width: "1321px"
  //       height: "410px"

  //       background: "linear-gradient(225deg, #00ac41, #009de0)" //#0080A5
  //       borderRadius: "13.6px"
  //     }
  //     label: "square4"
  //   }
  //   tile text #textTile_10 {
  //     value: "Here Is What People Are Saying About " + IIF(@layoutselector.selected.id = "1", @top3dimcorrprint.map.data._0.label, IIF(@layoutselector.selected.id = "2", @top3dimcorrprint.map.data._1.label, @top3dimcorrprint.map.data._2.label))

  //     areaId: "area_9"
  //     style #style {
  //       fontSize: 24
  //       color: @layoutselector.selected.layouttablesquareonecolorreverse

  //       color: #fefbfb
  //     }
  //   }
  //   tile text #textTile_11 {
  //     value: @top3dimcorrprint.map.data._0.label
  //     areaId: "area_10"
  //     style #focusareaheader {
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile value #valueTile {
  //     areaId: "area_11"
  //     label: "PMscore"
  //     value: @top3dimcorrprint.map.data._0.favorable
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //     valueFormatter: percentNoDecimal
  //   }
  //   tile text #textTile_12 {
  //     value: @comparisonPeriodSelector.selectedLabel//"Prior Cycle"
  //     areaId: "area_12"
  //     style #style {
  //       fontSize: 16
  //       color: @layoutselector.selected.layouttablefontcolor1

  //       width: 157
  //     }
  //   }
  //   tile value #valueTile_2 {
  //     areaId: "area_13"
  //     label: "PMComparisonYearValue"
  //     value: @top3dimcorrprint.map.data._0.favorable - @top3dimcorrprint.map.data._0.priorcycle
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile text #textTile_13 {
  //     value: "vs Company Overall"
  //     areaId: "area_15"
  //     style #style {
  //       fontSize: 16
  //       width: "187px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile value #valueTile_3 {
  //     areaId: "area_16"
  //     label: "vscompanyoverall0"
  //     value: @top3dimcorrprint.map.data._0.favorable - @top3dimcorrprint.map.data._0.overall
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile text #textTile_14 {
  //     value: @benchmarksListItemsSelector.selectedLabel
  //     areaId: "area_17"
  //     style #style {
  //       fontSize: 16
  //       width: "300px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor1
  //       textOverflow: ellipsis
  //       overflow: hidden
  //       whiteSpace: nowrap

  //     }
  //     label: "NormSeg1"
  //   }
  //   tile value #valueTile_4 {
  //     areaId: "area_18"
  //     label: "Last rendering mode used"
  //     value: @top3dimcorrprint.map.data._0.norm
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor1

  //     }
  //   }
  //   tile text #textTile_15 {
  //     value: @top3dimcorrprint.map.data._1.label
  //     areaId: "area_19"
  //     style #style {
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile value #valueTile_5 {
  //     areaId: "area_20"
  //     label: "EIscore"
  //     value: @top3dimcorrprint.map.data._1.favorable
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //     valueFormatter: percentNoDecimal
  //   }
  //   tile text #textTile_16 {
  //     value: @comparisonPeriodSelector.selectedLabel//"Prior Cycle"
  //     areaId: "area_21"
  //     style #style {
  //       fontSize: 16
  //       width: "162px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile value #valueTile_6 {
  //     areaId: "area_22"
  //     label: "EIComparisonYearValue"
  //     value: @top3dimcorrprint.map.data._1.favorable - @top3dimcorrprint.map.data._1.priorcycle
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile text #textTile_17 {
  //     value: "vs Company Overall"
  //     areaId: "area_23"
  //     style #style {
  //       fontSize: 16
  //       width: "170px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile value #valueTile_7 {
  //     areaId: "area_24"
  //     label: "vscompanyoverall1"
  //     value: @top3dimcorrprint.map.data._1.favorable - @top3dimcorrprint.map.data._1.overall
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile text #textTile_18 {
  //     value: @benchmarksListItemsSelector.selectedLabel

  //     areaId: "area_25"
  //     style #style {
  //       fontSize: 16
  //       width: "299px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor2
  //       textOverflow: ellipsis
  //       overflow: hidden
  //       whiteSpace: nowrap

  //     }
  //     label: "NormSeg2"
  //   }
  //   tile value #valueTile_8 {
  //     areaId: "area_26"
  //     label: "Last rendering mode used"
  //     value: @top3dimcorrprint.map.data._1.norm
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor2

  //     }
  //   }
  //   tile text #textTile_19 {
  //     value: @top3dimcorrprint.map.data._2.label
  //     areaId: "area_27"
  //     style #style {
  //       fontSize: 24
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile value #valueTile_9 {
  //     areaId: "area_28"
  //     label: "RRscore"
  //     value: @top3dimcorrprint.map.data._2.favorable
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 24
  //       color: @layoutselector.selected.layouttablefontcolor3

  //       fontWeight: "bold"
  //     }
  //     valueFormatter: percentNoDecimal
  //   }
  //   tile text #textTile_20 {
  //     value: @comparisonPeriodSelector.selectedLabel//"Prior Cycle"
  //     areaId: "area_29"
  //     style #style {
  //       fontSize: 16
  //       width: "156px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile value #valueTile_10 {
  //     areaId: "area_30"
  //     label: "RRComparisonYearValue"
  //     value: @top3dimcorrprint.map.data._2.favorable - @top3dimcorrprint.map.data._2.priorcycle
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile text #textTile_21 {
  //     value: "vs Company Overall"
  //     areaId: "area_31"
  //     style #style {
  //       fontSize: 16
  //       width: "197px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile value #valueTile_11 {
  //     areaId: "area_32"
  //     label: "vscompanyoverall2"
  //     value: @top3dimcorrprint.map.data._2.favorable - @top3dimcorrprint.map.data._2.overall
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile text #textTile_22 {
  //     value: @benchmarksListItemsSelector.selectedLabel

  //     areaId: "area_33"
  //     style #style {
  //       fontSize: 16
  //       width: "304px"
  //       height: "47px"
  //       color: @layoutselector.selected.layouttablefontcolor3
  //       textOverflow: ellipsis
  //       overflow: hidden
  //       whiteSpace: nowrap

  //     }
  //     label: "NormSeg3"
  //   }
  //   tile value #valueTile_12 {
  //     areaId: "area_34"
  //     label: "Last rendering mode used"
  //     value: @top3dimcorrprint.map.data._2.norm
  //     style #style {
  //       justifyContent: "start"
  //       alignItems: "start"
  //       fontSize: 16
  //       fontWeight: "bold"
  //       color: @layoutselector.selected.layouttablefontcolor3

  //     }
  //   }
  //   tile text #textTile_23 {
  //     value: @responseselector.selected.singleresponsecomment
  //     areaId: "area_35"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment1"
  //   }
  //   tile text #textTile_26 {
  //     value: "More comments ↗ "
  //     areaId: "area_38"
  //     style #style {
  //       fontSize: 15
  //       color: #EDF4F7
  //       border: "solid thin #edf4f7"
  //       borderRadius: "65.44px"
  //     }
  //     navigateTo: "commentsmodal"
  //     navigateOptions: "same_tab"
  //   }
  //   tile text #textTile_27 {
  //     value: @responseselector.selected.singleresponsecomment
  //     areaId: "area_39"
  //     style #style {
  //       fontSize: 16
  //       width: "425px"
  //       height: "128px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment2"
  //   }
  //   tile text #textTile_28 {
  //     value: @responseselector.selected.singleresponsecomment
  //     areaId: "area_40"
  //     style #style {
  //       fontSize: 16
  //       width: "417px"
  //       height: "128px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment6"
  //   }
  //   tile text #textTile_29 {
  //     value: @responseselector.selected.singleresponsecomment
  //     areaId: "area_41"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment3"
  //   }
  //   tile text #textTile_30 {
  //     value: @responseselector.selected.singleresponsecomment
  //     areaId: "area_42"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment4"
  //   }
  //   tile text #textTile_31 {
  //     value: @responseselector.selected.singleresponsecomment
  //     areaId: "area_43"
  //     style #style {
  //       fontSize: 16
  //       width: "415px"
  //       height: "126px"
  //       color: #EDF4F7
  //       //overflow: hidden//inherit//clip //scroll
  //       overflowY: auto
  //     }
  //     label: "comment5"
  //   }
  //   tile text #textTile_32 {
  //     value: "🗨 " + toText(count(:Q89.start))//, :BestThingCategory = toText(@top3dimcorrprint.map.data._0.sequenceid)))
  //     areaId: "area_44"
  //     style #style {
  //       color: @layoutselector.selected.layouttablefontcolor1
  //       fontSize: 30
  //     }
  //     label: "bubble1"
  //   }
  //   tile text #textTile_33 {
  //     value: "🗨 " + toText(count(:Q89.start))//, :BestThingCategory = toText(@top3dimcorrprint.map.data._1.sequenceid)))
  //     areaId: "area_45"
  //     style #style {
  //       color: @layoutselector.selected.layouttablefontcolor2
  //       fontSize: 30
  //     }
  //     label: "bubble1"
  //   }
  //   tile text #textTile_34 {
  //     value: "🗨 " + toText(count(:Q89.start))//, :BestThingCategory = toText(@top3dimcorrprint.map.data._3.sequenceid)))
  //     areaId: "area_46"
  //     style #style {
  //       color: @layoutselector.selected.layouttablefontcolor3
  //       fontSize: 30
  //     }
  //     label: "bubble1"
  //   }
  //   tile text #textTile_35 {
  //     navigateTo: itemsmodal
  //     value: "View items ↗"
  //     areaId: "area_47"
  //     style #style {
  //       fontSize: 16
  //       color: #EDF4F7
  //     }
  //   }
  //   tile text #textTile_36 {
  //     navigateTo: itemsmodal
  //     value: "View items ↗"
  //     areaId: "area_48"
  //     style #style {
  //       fontSize: 16
  //       color: #EDF4F7
  //     }
  //   }
  //   tile text #textTile_37 {
  //     navigateTo: itemsmodal
  //     value: "View items ↗"
  //     areaId: "area_49"
  //     style #style {
  //       fontSize: 16
  //       color: #EDF4F7
  //     }
  //   }
  //   tile text #textTile_39 {
  //     value: " "
  //     areaId: "area_51"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "22px"
  //       height: "25px"
  //     }
  //     label: "PMcomparisonYear"
  //     switch #switch {
  //       linkedToValue: @valueTile_2
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  //   tile text #textTile_40 {
  //     value: " "
  //     areaId: "area_52"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       color: #EDF4F7
  //     }
  //     switch #switch {
  //       linkedToValue: @valueTile_6
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor2 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 20
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor2 // #4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor2 // #4d4d4d
  //           }
  //         }
  //       }
  //     }
  //     label: "EIComparisonYear"
  //   }
  //   tile text #textTile_41 {
  //     value: " "
  //     areaId: "area_53"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //     }
  //     switch #switch {
  //       linkedToValue: @valueTile_10
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //     label: "RRComparisonYear"
  //   }
  //   tile text #textTile_42 {
  //     value: " "
  //     areaId: "area_54"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "28px"
  //       height: "33px"
  //     }
  //     label: "PMcompanyOverall"
  //     switch #switch {
  //       linkedToValue: @valueTile_3
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor1 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor1 // #4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor1 // #4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  //   tile text #textTile_43 {
  //     value: " "
  //     areaId: "area_55"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "28px"
  //       height: "33px"
  //     }
  //     label: "PMcompanyOverall"
  //     switch #switch {
  //       linkedToValue: @valueTile_7
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor2 // #4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor2 //#4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor2 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  //   tile text #textTile_44 {
  //     value: " "
  //     areaId: "area_56"
  //     style #style {
  //       fontSize: 16
  //       padding: "0px 0px 0px 0px"
  //       width: "28px"
  //       height: "33px"
  //     }
  //     label: "PMcompanyOverall"
  //     switch #switch {
  //       linkedToValue: @valueTile_11
  //       case #case {
  //         condition: "<0"
  //         body #body {
  //           value: "↓"
  //           style #bodyStyle {
  //             fontSize: 20
  //             fontFamily: "Trebuchet MS"
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4D4D4D
  //             textAlign: "center"
  //           }
  //         }
  //       }
  //       case #case_2 {
  //         condition: ">0"
  //         body #body {
  //           value: "↑"
  //           style #bodyStyle {
  //             fontSize: 22
  //             textAlign: "center"
  //             color: @layoutselector.selected.layouttablefontcolor3 // #4d4d4d
  //           }
  //         }
  //       }
  //       case #case_3 {
  //         condition: "=0"
  //         body #body {
  //           value: "↔"
  //           style #bodyStyle {
  //             fontWeight: "bold"
  //             fontSize: 20
  //             color: @layoutselector.selected.layouttablefontcolor3 //#4d4d4d
  //           }
  //         }
  //       }
  //     }
  //   }
  // }

// }
// page #Learntoprint {
//   label: "Learn"

  widget markdown #markdownWidget_5 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_5 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget actionPlannerDataGrid #rankedfocuseditems {
    hide: @cp.hiderankedfocusitems
    label: "Ranked Focus Items"
    size: large
    cardCorners: 10px

    suppressRule {
      criteria: @cp.currenthasdata = false
    }

    viaStrategy: shortest


    sort rows {
      sortBy: "/totalrankscore" //"/totalrankrwa" //
      sortOrder: ascending
      takeTop: 10//@showtopselector.selected.top
    }

    filter expression {
      value: @cp.currentwave
    }
    filter expression {
      value: .dg1_dimension_question:dimensionId != "Mental_Health" AND .dg1_dimension_question:dimensionId != "Manager_support" AND .dg1_dimension_question:dimensionId != "Talent_Focus" AND .dg1_dimension_question:dimensionId != "Agility" AND .dg1_dimension_question:dimensionId != "Engaging_Leadership" AND .dg1_dimension_question:dimensionId != "Positive_Duty"

    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Engagement" AND .dg1_dimension_question:dimensionId != "Engagement_Legacy" AND .dg1_dimension_question:dimensionId != "Intent_to_stay"
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    // filter expression #removenonRWA2 {
    //   value: .dg1_questions:Id != "EN0290" AND .dg1_questions:Id != "EN0556" AND .dg1_questions:Id != "EN0558" AND .dg1_questions:Id != "EN0467" AND .dg1_questions:Id != "EN0559"
    // }
    filter expression #exclude_positive_duty {
      value: .dg1_questions:Id != "Q66" AND .dg1_questions:Id != "Q67" AND .dg1_questions:Id != "Q68" AND .dg1_questions:Id != "Q69" AND .dg1_questions:Id != "Q70" AND .dg1_questions:Id != "Q71" AND .dg1_questions:Id != "Q72"
    }
    filter expression #exclude_manager_support {
      value: .dg1_questions:Id != "Q75" AND .dg1_questions:Id != "Q76" AND .dg1_questions:Id != "Q77" AND .dg1_questions:Id != "Q78" AND .dg1_questions:Id != "Q79" AND .dg1_questions:Id != "Q80" AND .dg1_questions:Id != "Q81" AND .dg1_questions:Id != "Q82" AND .dg1_questions:Id != "Q83" AND .dg1_questions:Id != "Q84" AND .dg1_questions:Id != "Q85" AND .dg1_questions:Id != "Q86" AND .dg1_questions:Id != "Q87"
    }


    row list #items {
      total: none
      value: .dg1_questions:id
      table: .dg1_questions:
    }

    column #dimensionlabel {
      label: "Dimension"

      cell #cell {
        value: Max(toText(answerText(.dg1_dimension_question:dimensionId))) //max just picks one of the dims to avoid relation violation
        style #body {
          alignItems: 'start'
        }
      }
    }

    column #cofrank2 { //this is now the rwa going into the sorting
      hide: true
      cell custom {
        lookup value #value {
          source: RWA
          mapping value {
            value: "1Fetch"
            selector: NormId
          }
          mapping header {
            header: items
            selector: id
          }
          value: rwacofrank
        }
        rank #notneeded {
          mode: all
//          sourceValueId: value[]
          sourceValue: lookuprwa
          dimension: rows
        }

        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
      label: "rwacof"
    }
    column #totalrankrwa {
      hide: true
      label: "Total Rank uploaded"
      cell custom {
        lookup value #value {
          source: RWA
          mapping value {
            value: "1Fetch"
            selector: NormId
          }
          mapping header {
            header: items
            selector: id
          }
          value: rwarank
        }

        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #totalrankscore {
      label: "Total Rank"
      hide: false
      cell custom {
        formula #averagerank {
          value: 0 - average(value[column = /favorablerank], value[column = /cofrank2], value[column = /ranknormgap])

        }
        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: averagerank
          dimension: rows
        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #cofrank2Forsta {
      hide: true
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: @dtscopeprint.m.data.scope.scopetouse

      }
      label: "Highest DIM Impact Rank"
      cell {
        value: DenseRankRev(correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)) //DenseRank?
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #favorablerank {
      hide: true
      label: "Lowest Score Rank"
      cell custom {

        expression #value {
          value: isNull(Rank(:itemTopTwo()), 0)
        }
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
        formatString: "{value}"
      }
    }

    column #ranknormgap {
      hide: true
      label: "Worst Gap To Norm Rank"
      cell custom {

        formula #normgapreal { //normgap
          value: value[column = /norm] - value[column = /favorable]
        }
        formula #normgap {
          value: isNull(normgapreal[], "")
        }
        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: normgap
          dimension: rows
        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #cofrank {
      hide: true
      label: "Highest Item Impact Rank"
      cell {
        value: RankRev(correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension))
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column #favorable {
      label: "Favorable Score"
      hide: true
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave

      }
      label: @distributionTypeprint.selected.text
      width: 200px

      cell microchart {
        suppression respondentsBase {
          threshold: @cp.confidentiality

        }
        column: distribution
        value: count(.dg1_questionScore:) //runs on questionscore too
        breakdownBy cut {
          value: @distributionTypeprint.selected.question
        }

        microchart stacked100PercentBar {
          palette: @distributionTypeprint.selected.palettequestion
          percentFormat: percentNoDecimal
          showLegend: @distributionTypeprint.selected.showlegend
        }
      }
    }
    column #cof {
      hide: true
      label: "Impact DIMS"
      cell {
        value: correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)
      }
    }

    column #overall {
      hide: true
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }
    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @cp.previouswave
      }
    }

    column #normgapcol {
      label: "Distance from Norm"
      hide: false
      cell custom {
        formula #value {
          value: value[column = /favorable] - value[column = /norm]
          formatter: bigNumberFormatter
        }
        formula #vsarrow {
          value: isNull(value[], "")
          formatter: upordown
        }
        formula #color {
          value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
        }

        formatString: '<span style ="color:{color}">{value} {vsarrow} </span>'
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #norm {
      hide: true
      cell custom {
        lookup value #mean {
          source: norms
          mapping value {
            value: @cp.defaultnorm
            selector: NormId
          }
          mapping value {
            selector: ResponseValue
            value: 6
          }
          mapping header {
            header: items
            selector: QuestionId
          }
          value: ResponseCount
        }
        formula #value {
          value: Round(mean[] / 1000, 0)
          formatter: percentNoDecimal
        }

        expression #sequenceid {
          value: .dg1_questions:sequenceId
        }
        formatString: "{value}"
      }
      label: "norm"
    }


    cell custom {
      row: items
      column: favorable, overall,priorcycle
      expression #value {
        value: :itemTopTwo()
          //formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}%"
    }
    description: "Improve your employees' engagement by focusing on these opportunity areas."
  }


  widget markdown #markdownWidget_6 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_6 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #engagement1 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true

    filter expression {
      value: IN(.dg1_dimensions:Id, "Engagement")
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
    }


    activeRows: dimensions, items
    activeColumns: magicfav, @ColsToExport.selected

    row nestedHeaders #both {
      viewMode: dynamic //@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      hide: true
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
    }

    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
      label: "Response Distribution"
      width: 300px
    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }

       // formatString: '{value1} | <span style ="color:{arrowColor}">{value2}</span> |{diff} '

    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    cell custom {
      row: dimensions
      column: norm
      lookup value #mean {
        source: KeyMetricNorm
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }


        value: KeyMetricScore
      }
      formula #normscore {
        value: mean[]
        formatter: percentNoDecimal

      }
      formatString: "{normscore}"
    }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, value[column = /favorable] - normscore[column = /norm])
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vspriorExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }


//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality

      }
      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      suppression custom {
        condition: formula {
          value: countdim[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: count(.response:responseid)
      breakdownBy cut {
        value: :engagementdistribution//@distributionType.selected.dimension //Note runs on QUESTIONSCORE
      }
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimensionengagement
        percentFormat: percentNoDecimal
        showLegend: true//@distributionType.selected.showlegend
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)

    }

    cell custom {
      row: dimensions
      column: favorable
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal

      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"


    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave

      }
      label: "Responses"

    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide
    }

    // cell custom {
    //   view: actionPlanner
    //   row: dimensions
    //   column: addToPlan
    //   expression #id {
    //     value: toText(surveyDataset.dimensions:id)
    //   }
    //   formatString: "Add plan"
    // }
    cell custom {
      view: actionPlanner
      row: items
      column: addToPlan
      expression #id {
        value: toText(surveyDataset.items:id)
      }
      formatString: "Add plan"
    }

    label: "Engagement"
  }
  widget dataGrid #copy_of_engagement1 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true

    filter expression {
      value: IN(.dg1_dimensions:Id, "Engagement")
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id = "EN0001" OR .dg1_questions:Id = "EN0002" OR .dg1_questions:Id = "EN0003" OR .dg1_questions:Id = "EN0004" OR .dg1_questions:Id = "EN0005" OR .dg1_questions:Id = "EN0006"
    }


    activeRows: items//@rows.selected.show
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {
      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        hide: false//@rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
    }

    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes
      }
      label: "Response Distribution"
      width: 300px
    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }

       // formatString: '{value1} | <span style ="color:{arrowColor}">{value2}</span> |{diff} '

    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    cell custom {
      row: dimensions
      column: norm
      lookup value #mean {
        source: KeyMetricNorm
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }


        value: KeyMetricScore
      }
      formula #normscore {
        value: mean[]
        formatter: percentNoDecimal

      }
      formatString: "{normscore}"
    }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, value[column = /favorable] - normscore[column = /norm])
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vspriorExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }


//***********************cell microchart***************************
    cell microchart {
      row: items
      suppression respondentsBase {
        threshold: @cp.confidentiality

      }
      column: distribution
      value: count(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution

      suppression custom {
        condition: formula {
          value: countdim[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: count(.response:responseid)
      breakdownBy cut {
        value: :engagementdistribution//@distributionType.selected.dimension //Note runs on QUESTIONSCORE
      }
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimensionengagement
        percentFormat: percentNoDecimal
        showLegend: true//@distributionType.selected.showlegend
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)

    }

    cell custom {
      row: dimensions
      column: favorable
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal

      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      expression #value {
        value: :engagementscore()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"


    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave

      }
      label: "Responses"

    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide
    }

    // cell custom {
    //   view: actionPlanner
    //   row: dimensions
    //   column: addToPlan
    //   expression #id {
    //     value: toText(surveyDataset.dimensions:id)
    //   }
    //   formatString: "Add plan"
    // }
    cell custom {
      view: actionPlanner
      row: items
      column: addToPlan
      expression #id {
        value: toText(surveyDataset.items:id)
      }
      formatString: "Add plan"
    }

    label: "Engagement Items"
  }



  widget markdown #markdownWidget_7 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_7 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget chart #chartWidget2 {
    hide: @cp.hidechartlearn
    label: "Engagement Distribution by Year"
    cardCorners: 10px
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    series #series {
      chart bar #barChart {
        //mode: "stacked" // changed to stacked100Percent have axis maxvalue 100
        mode: stacked100Percent
        dataLabel: value
        showValue: true
        showBase: true
      }
      value: count(.response:responseid)
      breakdownBy cut {
        value: :EngagementDistribution
      }
      percentOver: "series"
      format: percentNoDecimal

    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }

    size: large
    layout: "vertical"
    category cut #cutCategory {
      value: :combined_sourceid
      categories: @cp.engagementmodelB_yearcategories
    }
    legend: "bottomCenter"
    palette: mercerlist
    cardTransparent: false
    cardShadow: true
    infobox #infobox {
      label: "Engagement Distribution"
      info: ""
      size: "small"
    }
    axis secondary #secondaryAxis {
      hide: true
    }
  }




  widget markdown #markdownWidget_8 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_8 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimcontinued {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: .dg1_dimensions:sequenceId < 13 //, :dimensionTopTwoNEW2() < 70
    }

    activeRows: both //@rows.selected.show
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {
      viewMode: dynamic//@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        hide: true //@rows.selected.hideitems
        total: none
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: 300px

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions"
  }


  widget markdown #markdownWidget_9 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_9 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimcontinued2 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: .dg1_dimensions:sequenceId >= 13 //, :dimensionTopTwoNEW2() < 70
    }

    activeRows: both //@rows.selected.show
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {
      viewMode: dynamic//@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        hide: true //@rows.selected.hideitems
        total: none
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: 300px

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions continued"
  }



  widget markdown #markdownWidget_10 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_10 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset1 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset1dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_11 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_11 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset2 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset2dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_12 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_12 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset3 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset3dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_13 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_13 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset4 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset4dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_14 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }

  widget headline #copy_of_markdownWidget_14 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset5 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset5dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_15 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }

  widget headline #copy_of_markdownWidget_15 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset6 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset6dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_16 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_16 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset7 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset7dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }


  widget markdown #markdownWidget_17 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_17 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset8 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset8dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }



  widget markdown #markdownWidget_18 {
    size: halfwidth
    markdown: @cp.mercerlogoPDF
    cardTransparent: true
    pageBreak: true
  }


  widget headline #copy_of_markdownWidget_18 {
    size: halfwidth

    tile image #imageTile {
      value: @cp.clientlogoPDF
      height: "80px"

      imgAlign: right
    }
    cardTransparent: true
  }
  widget dataGrid #dimset9 {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    hide: false
    rowHeaderWidths: @cp.pdfrowheaderwidth

    cardCorners: 10px
    size: large
    viaStrategy: shortest //needed to allow relation which is needed to allow dim lookup on whats my top scoring widget
    virtualize: true
    filter expression {
      value: NOT(IN(.dg1_dimensions:Id, "Engagement"))
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    filter expression {
      value: In(.dg1_dimensions:sequenceId, @cp.dimset9dimensions)
    }

    activeRows: both
    activeColumns: magicfav, @ColsToExportprint.selected

    row nestedHeaders #both {

      viewMode: expanded
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
        sortOrder: descending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: sum(.dg1_questionScore:questionFavorableNumeric, @cp.currentwave)
        sortOrder: descending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      // sortBy: .dg1_questions:SequenceId
      // sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      // sortBy: .dg1_dimensions:SequenceId
      // sortOrder: ascending
    }

      //*******************columns********************************

    column #magicfav {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      hide: true
    }

    column #favorable {
      label: "Total Favorable Score"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }

    column #favorableNEW {
      hide: true
      label: "Total Favorable Score New Roundings"
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
    }
    column #distribution {
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "Response Distribution"
      width: @cp.pdfdistributionwidth

    }

    column #overall {
      hide: true
      filter expression {
        value: @cp.currentwave AND @cp.completes

      }
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }

    column #vsoverall {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverall
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    column #vsoverallExport {
      label: "vs. Company Overall"
    }

    cell custom {
      column: vsoverallExport
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /overall]
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'

    }

    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @comparisonPeriodSelector.selected.filter
      }
    }

    column #vsprior {
      label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
    }

    column #vspriorExport {
      label: @comparisonPeriodSelector.selectedLabel
    }

    column #norm {
      hide: true

      label: "norm"
    }
    column #vsnorm {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

    column #vsnormExport {
      hide: false //@normselector2.selected.hidenorm
      label: "vs. " + @benchmarksListItemsSelector.selectedLabel
    }

//***********************normcells************
    cell custom {
      row: items
      column: norm
      lookup value #mean {
        source: norms
        mapping value {
          value: @benchmarksListItemsSelector.selected
          selector: NormId
        }
        mapping value {
          selector: ResponseValue
          value: 6
        }
        mapping header {
          header: 'items'
          selector: QuestionId
        }
        value: ResponseCount
      }
      formula #normscore {
        value: mean[] / 1000
        formatter: percentNoDecimal
      }
      formatString: "{normscore}"
    }
    // cell custom {
    //   row: dimensions
    //   column: norm //this cell is not in use anymore
    //   expression #mean {

    //     value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //    // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
    //   }
    //   formula #normscore {
    //     value: mean[] / 1000
    //     formatter: percentNoDecimal

    //   }

    //   formatString: "Mean {normscore}"

    // }

    cell custom {
      column: vsnorm
      row: dimensions
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }
      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))
      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value}{vsarrow} </span>'
    }

    cell custom {
      column: vsnorm
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: bigNumberFormatter
      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }
      style {
        alignItems: "center"
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }


    cell custom {
      column: vsnormExport
      row: items
      formula #value {
        value: value[column = /favorable] - normscore[column = /norm]
    //      value: score[column = /history.current] - score[column = /overall]
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsnormExport
      row: dimensions

      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality, Round(avg(value[row = items.*])), 0)
        formatter: percentNoDecimal
      }

      style {
        alignItems: "center"
      }
      formatString: '{value}'

    }

    cell custom {
      column: vsprior
      row: dimensions, items

      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: bigNumberFormatter

      }
      formula #vsarrow {
        value: isNull(value[], "")
        formatter: upordown
      }

      formula #color {
        value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

    }
    cell custom {
      column: vspriorExport
      row: dimensions, items
      formula #value {
        value: value[column = /favorable] - value[column = /priorcycle]
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: '{value}'
    }

//***********************cell microchart***************************
    cell microchart {
      row: items
      column: distribution

      suppression respondentsBase {
        threshold: @cp.confidentiality
      }
      value: countdistinct(.dg1_questionScore:) //runs on questionscore too
      breakdownBy cut {
        value: @distributionTypeprint.selected.question
      }
      microchart stacked100PercentBar {
        showTooltip: true
        palette: @distributionTypeprint.selected.palettequestion
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
      }
    }
    cell microchart #mchart {
      row: dimensions
      column: distribution
      suppression custom {
        condition: formula {
          value: countdimcurrent[column = /responses] < @cp.confidentiality //- 0.55
        }
      }

      value: @distributionTypeprint.selected.dimension
      microchart stacked100PercentBar {
        palette: @distributionTypeprint.selected.palettedimension
        percentFormat: percentNoDecimal
        showLegend: @distributionTypeprint.selected.showlegend
        showTooltip: false
      }
    }
    //***********************cell for favorable, overall****************************

    cell #magicdim {
      row: dimensions
      column: magicfav
      value: sum(.dg1_dimensionScore:favorabilityCounts2point)
    }

    cell custom {
      row: dimensions
      column: favorable
      formula #countdim {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 1)
      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, :dimensionTopTwoNEW())
        formatter: percentNoDecimal
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #foroverall {
      row: dimensions
      column: overall
      lookup value #value {
        source: dimensionScoreLookup
        value: score
        formatter: percentNoDecimal

        mapping header {
          header: dimensions
          selector: idText
        }
      }
      formatString: "{value}"
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
    }

    cell custom {
      row: dimensions
      column: priorcycle
      formula #countdim {
        value: round(avg(countprevious[column = /responses, row = items.*]), 1)
      }
      expression #score {
        value: :dimensionTopTwoNEW2()

      }
      formula #value {
        value: IIF(countdim[] >= @cp.confidentiality - 0.55, score[])
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorableNEW

      expression #value {
        value: :itemTopTwoDouble()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom {
      row: items
      column: favorable, overall, priorcycle

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {

      label: "Responses"
    }
    cell custom #itemresponses {
      row: items
      column: responses
      expression #countcurrent {
        value: count(:, @cp.completes AND @cp.currentwave)
      }
      expression #countprevious {
        value: count(:, @cp.completes AND @cp.previouswave)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(countcurrent[] < @cp.confidentiality, toofewtext[], countcurrent[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdimcurrent {
        value: round(avg(countcurrent[column = /responses, row = items.*]), 0)
      }
      formula #countdimprevious {
        value: round(avg(countprevious[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdimcurrent[] < @cp.confidentiality, toofewtext[], countdimcurrent[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    label: "Dimensions and Items"
  }




  config layout #layoutConfig {
    pageBackgroundImage: "None"
    pageBackgroundColor: "#ffffff"
    horizontalAlignmentMode: "threeColumnsCentered"
  }
}
page #ActionPlans {
  label: "Action Plans"
  hide: @cp.actionplanninghide

  widget initiativeSummary {
    size: "large"
  }
  widget initiativeList {
    size: "large"
    navigateTo: "ActionPlanDetails"

  }
}
page #page_21 {
  label: "QA TotalRankDimsItems"
  widget dataGrid #dimqatable2 {//Start of My Team View Key Drivers
    label: "Top 3 DIM corr between other dims and Engagement"
    size: large
    cardCorners: 10px
    viaStrategy: shortest
    filter expression {
      value: .dg1_dimensions:Id != "Engagement" AND .dg1_dimensions:Id != "Engagement_Legacy" AND .dg1_dimensions:Id != "Intent_to_stay"
    }
    filter expression {
      value: @cp.currentwave

    }
    sort rows {
      sortBy: "/cof"
      sortOrder: descending
        //takeTop: 3
    }

    row list #dimensions {
      total: none
      value: ""//.dg1_dimensions:id
      table: .dg1_dimensions:
    }

    column #_label {
      label: "dimlabel"
      cell {
        value: .dg1_dimensions:id
      }
    }
    column #_id {
      label: "Dim id"
      cell {
        value: .dg1_dimensions:id + "" //calls the code
      }
    }
    column #cofrank {
      hide: false
      label: "Highest Impact Rank"
      cell {
        value: DenseRankRev(correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension))
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column #cof {
      hide: false
      label: "Correlation"
      cell {
        value: correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)
      }
    }
    column #favorable {
      label: "Total Favorable Score"
    }
    column #overall {
      hide: false
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }
    column #priorcycle {
      hide: false
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: :responseid < 1500
      }
    }

    column #norm {
      hide: false
      cell custom {
        row: dimensions
        expression #mean {
          value: average(Momentum_Norms.ResponseCounts:ResponseCount, Momentum_Norms.ResponseCounts:ResponseValue = 6 AND Momentum_Norms.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)
       // value: average(momentum_norms_legacy.Responsecounts:ResponseCount, momentum_norms_legacy.ResponseCounts:Responsevalue = 6 AND momentum_norms_legacy.ResponseCounts:NormId = @benchmarksListItemsSelector.selected)


        }
        formula #normscore {
          value: mean[] / 1000
          formatter: percentNoDecimal

        }
        formatString: "{normscore}"

      }
      label: "norm"
    }


    cell custom {
      row: dimensions
      column: favorable, overall,priorcycle
      expression #score {
        value: :dimensionTopTwoNEW2()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{score}"

    }
  }
  widget dataGrid #itemqatable {
    //we need dim label, but running on dimension_questions dont seem to lookup norms by such row list.
    label: "Top 3 DIM corr between items and dim Engagement"
    size: large
    cardCorners: 10px
    viaStrategy: shortest
    filter expression {
      value: _isNotNull(:forDimension) AND .dg1_dimensionScore:dg1_dimensionScore != "Engagement"
    }
    sort rows {
      sortBy: "/totalrankscore"
      sortOrder: ascending
        //takeTop: 3
    }

    row list #items {
      total: none
      value: .dg1_questions:id
      table: .dg1_questions:
    }

    column #dimensionlabel {
      label: "Dimension"
      cell #cell {
        value: Max(toText(answerText(.dg1_dimension_question:dimensionId))) //max just picks one of the dims to avoid relation violation
        style #body {
          alignItems: 'start'
        }
      }
    }

    column #cof {
      hide: false
      label: "Impact "
      cell {
        value: correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension)
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #favorable {
      label: "Favorable Score"
    }

    column #cofrank {
      hide: false
      label: "Impact Rank"
      cell {
        value: RankRev(correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension))
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column #favorablerank {
      label: "Rank Favorable Score"
    }



    column #ranknormgap {
      label: "Rank Normgap"
      cell custom {
        formula #normgap { //normgap
          value: normscore[column = /norm] - score[column = /favorable]

        }

        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: normgap
          dimension: rows
        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #totalrankscore {
      label: "Total Rank score"
      cell custom {
        formula #value {
          value: value[column = /favorablerank] * 0.33 + 0.33 * value[column = /cofrank] + 0.33 * value[column = /ranknormgap]

        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }

      }
    }

    column #overall {
      hide: true
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }
    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @cp.previouswave
      }
    }

    column #norm {
      hide: false
      cell custom {
        lookup value #mean {
          source: norms
          mapping value {
            value: @benchmarksListItemsSelector.selected
            selector: NormId
          }
          mapping value {
            selector: ResponseValue
            value: 6

          }
          mapping header {
            header: items
          //  value: "EN0001" //works
            selector: QuestionId
          }

          value: ResponseCount
        }

        formula #normscore {
          value: Round(mean[] / 1000, 0)
          formatter: percentNoDecimal

        }

        expression #sequenceid {
          value: .dg1_questions:sequenceId
        }

        formatString: "{normscore}"

      }
      label: "norm"
    }



    cell custom {
      row: items
      column: favorable, overall,priorcycle
      expression #score {
        value: :itemTopTwo()
          //formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{score}"

    }


    cell custom {
      row: items
      column: favorablerank
      expression #value {
        value: Rank(:itemTopTwo())
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
  }


  config layout #layoutConfig {
    horizontalAlignmentMode: "fourColumnsCentered"
  }
  hide: true
  modal: false
}
page #page_22 {
  label: "QA Dim Norms Calc"

  widget dataGrid #dataGridWidget {
    filter expression {
      value: IN(Momentum_Norms.ResponseCounts:normId, @benchmarksListItemsSelector.selected)
    }
    filter expression {
      value: IN(Momentum_Norms.ResponseCounts:Responsevalue, 6)
    }

    label: "New Norms"
    size: "large"
    column cut #column {
      value: .dg1_questions:Id
      cell {
        value: average(Momentum_Norms.ResponseCounts:responsecount) / 1000
      }
    }
    row list #row {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:id
    }
  }
  widget table #tableWidget {
    filter expression {
      value: IN(Momentum_Norms.ResponseCounts:normId, @benchmarksListItemsSelector.selected)
    }
    filter expression {
      value: IN(Momentum_Norms.ResponseCounts:Responsevalue, 6)
    }
    label: "Legacy Table"
    size: "large"
    table: legacynormlist.ResponseCounts:
    column value #valueColumn {
      label: "NormId"
      value: legacynormlist.ResponseCounts:NormId
      enableColumnFilter: true
    }
    column value #valueColumn_2 {
      label: "QuestionId"
      value: legacynormlist.ResponseCounts:QuestionId
      enableColumnFilter: true
    }
    column value #valueColumn_3 {
      label: "ResponseCount"
      value: legacynormlist.ResponseCounts:ResponseCount
      enableColumnFilter: true
    }
    column value #valueColumn_4 {
      label: "ResponseValue"
      value: legacynormlist.ResponseCounts:ResponseValue
      enableColumnFilter: true
    }
  }
  hide: true
  modal: false
}
page #page_20 {
  label: "QA EngScore / Eng distribution"
  widget table #tableWidget {
    filter expression {
      value: @cp.currentwave

    }
    showCodeLabelSelector: true
    label: "QA EngScore /Engdistribution"
    size: "large"
    table: :
    showTotals: true
    // column value #valueColumn {
    //   label: "EN0558"
    //   value: :EN0558
    //   enableColumnFilter: true
    // }
    // column value #valueColumn_2 {
    //   label: "EN0556"
    //   value: :EN0556
    //   enableColumnFilter: true
    // }
    // column value #valueColumn_3 {
    //   label: "EN0290"
    //   value: :EN0290
    //   enableColumnFilter: true
    // }
    // column value #valueColumn_4 {
    //   label: "EN0467"
    //   value: :EN0467
    //   enableColumnFilter: true
    // }
    column value #valueColumn {
      label: "EN0001"
      value: :EN0001
      enableColumnFilter: true
    }
    column value #valueColumn_2 {
      label: "EN0002"
      value: :EN0002
      enableColumnFilter: true
    }
    column value #valueColumn_3 {
      label: "EN0003"
      value: :EN0003
      enableColumnFilter: true
    }
    column value #valueColumn_4 {
      label: "EN0004"
      value: :EN0005
      enableColumnFilter: true
    }
    column value #valueColumn_5 {
      label: "EN0005"
      value: :EN0005
      enableColumnFilter: true
    }
    column value #valueColumn_6 {
      label: "EN0006"
      value: :EN0006
      enableColumnFilter: true
    }
    column value {
      value: :engscorecount
      label: "engscore count"
    }
    column value {
      value: :engscore
      label: "engscore"
    }

    column value {
      value: :engagementdistribution
      label: "engdistribution"
    }
    column metric {
      value: top2percent(:engagementdistribution)

    }

  }
  hide: true
  modal: false
}
page #copy_of_Changelog {
  label: "Hidden Datatables & Selectors"
  widget headline {

    cardCorners: 10px
    size: large
    hide: pdf
    tile text #textTile_2 {
      value: "selectors likely to be removed and just use static choices"

    }

    select #ColsToExportprint {
      areaId: "area_3"

      label: "vs. colors"
      background: transparent
      options: item {
        label: 'Color/Arrows on gap columns'
        value: favorable, distribution, overall, vsoverall, priorcycle, vsprior, norm, vsnorm, responses
      },
      item {
        label: 'No Colors/Arrows on gap columns'
        value: favorable, distribution, overall, vsoverallExport, priorcycle, vspriorExport, norm, vsnormExport, responses
      }
    }
    select #distributionTypeprint {

      Label: "Score Distribution"
      options: item {
        label:"Favorable"
        value:{
            activecol: favorable
            question: .dg1_questionScore:twoPoint
            dimension: sum(.dg1_dimensionScore:favorabilityCounts2point) 
            dimensionengagement: count(:EngagementDistribution)
          palettequestion: mercer_1_color
          palettedimensionengagement: mercerlist
          palettedimension: mercer_1_color
          palette: mercer_1_color
                      showlegend:false
                                  text: "Total Favorable Score"


        }
      },
      item{
        label: "Full Distribution"
        value:{
          activecol: distribution
          question: .dg1_questionScore:fourpoint
          dimension: sum(.dg1_dimensionScore:favorabilityCounts4point) 
          dimensionengagement: count(:EngagementDistribution)
          palettequestion: mercerlist
          palettedimension: mercerlist
          palettedimensionengagement:mercerlist
          palette: mercer_1_color
          text: "Full Distribution"

          showlegend:false

        }
      }
    }
    select #rowsprint {
      label: "Select view"
      areaId: "area_2"

      options: item {
        label: "Dimensions"
        value:  {
          show: both
          hideitems: true
        }
      }
      // ,
      // item { label:"Dimensions and Items"
      // value: {
      //  show: both 
      //  hideitems:false
      // }
      // },
      //  item { label:"Items"
      // value: {
      //  show: items 
      //  hideitems:false
      // }
      //  }

    }

    // select #ColsToExport {
    //   areaId: "area_3"

    //   label: "vs. colors"
    //   background: transparent
    //   options: item {
    //     label: 'Color/Arrows on gap columns'
    //     value: favorable, distribution, overall, vsoverall, priorcycle, vsprior, norm, vsnorm, responses, addToPlan
    //   },
    //   item {
    //     label: 'No Colors/Arrows on gap columns'
    //     value: favorable, distribution, overall, vsoverallExport, priorcycle, vspriorExport, norm, vsnormExport, responses, addToPlan
    //   }
    // }
  }
  widget markdown #markdownWidget {
    label: "Hidden tables"
    markdown: "This page contains datatables and selectors used by the report "
    size: large
  }

  widget headline #selectorsforstuff {
    hide: true
    label: "selector from datatable, gets filtered by click the colors"

    select #mainwave {
      mode: single
      options: item {
        label: "Current wave"
        value:  {
          wave: .response:combined_sourceid = @cp.currentwaveprojectlabel 
        }
      },
      item {
        label: "for test Previous wave"
        value: {
          wave: .response:combined_sourceid = @cp.lastwaveprojectlabel 
        }
      }
    }


    select #layoutselector {
      options: @contenttable.forSelect.data
      defaultOption: "1"
      compareBy: this.value.id
    }

    // select #responseselector {
    //   options: @singleresponsetable.forSelect.data
    // }

    select #maxminselector {
      options: @maxminitemscore.forSelect.data
    }

//preferably build as multi:
    select #commentsfilterselector1 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector2 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector3 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector4 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector5 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector6 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector7 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector8 {
      options: @commentsfiltertable.forSelect.data
    }
    select #commentsfilterselector9 {
      options: @commentsfiltertable.forSelect.data
    }

    tile text #textTile_2 {
      value: " "
    }
    size: large
  }

  dataTable #dtDimensionsUnits {
    dataGrid #dgDimensions {
      size: large
      filter expression {
        value: .dg1_dimensions:id != "Engagement"


      }
      row list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: ""
        sortBy: .dg1_dimensions:id
        sortOrder: ascending

        cell custom {
          expression #label {
            value: .dg1_dimensions:id //[column = /_label]
          }
          expression #id {
            value: toText(.dg1_dimensions:id)
          }

          formatString: "{label} | {id} "
        }
      }

      column #results {
      }
    }
    map #forSelect {
      from: "dimensions"
      to: item {
        label: this.results.label
        value:  {
          id: this.results.id
        }
      }
    }

  }

  dataTable #dtBenchmarks {
    dataGrid {
      row list #benchmarks {
        total: none
        table: .benchmarks:
        value: ""
        sortBy: "/order"
        sortOrder: ascending
      }
      column #order {
        hide: true
        cell {
          value: .benchmarks:benchmarkOrder
        }
      }
      column #results {
        cell custom {
          expression #label {
            value: .benchmarks:benchmarkName
          }
          expression #id {
            value: .benchmarks:BenchmarkID
          }
          expression #idText {
            value: toText(.benchmarks:BenchmarkID)
          }


          expression #definitionName {
            value: .benchmarks:BenchmarkDefinitionName
          }

          expression #order {
            value: toText(.benchmarks:id)
          }
          expression #isDefault {
            value: .benchmarks:benchmarkIsPrimary

          }
          formatString: "{label} {definitionId} {isDefault}"
        }
      }
    }
    map #forSelect {
      from: "benchmarks"
      to: item {
        label: this.results.label
        value: this.results.id
        idText: this.results.idText
  //      order: this.results.order
      }
    }

  }

  dataTable #DTResponseRates {
    dataGrid #completes {
      label: "Data Grid"
      size: "large"
      filter expression {
        value: @cp.currentwave

      }
      column #responses {
        cell custom {
          expression #currentResponses {
            value: count(:, @cp.completes)
          }

          formatString: ""
        }
      }

      column #respondents {
        cell custom {
          expression #currentRespondents {
            value: count(.respondent:)
          }
          formatString: ""
        }
      }
      column #responseRate {
        cell custom {
          expression #currentResponseRateA {
            //value: value[column = /currentResponses] / value[column = /currentRespondents] * 100
            value: count(:) / count(.respondent:) * 100
          }
          formula #currentResponseRate {

            value: IIF(@responseratehide = true, "", currentResponseRateA[])
          }
          formatString: ""
        }
      }
      row #counts {
      }

    }
    map #m {
      from: counts
      //ifEmpty: "-"
    }
  }

  dataTable #commentsfiltertable {
    dataGrid #dataGridWidget {
      viaStrategy: shortest
      label: "controls for filters on comment page"
      size: "large"

      row list #keys {
        table: layouttable:
        value: ""
        total: "none"
        sortBy: "/key"
        sortOrder: ascending
      }
      column #key {
        hide: true
        cell {
          value: layouttable:key
        }
      }

      column #results {
        cell custom #cellcustom {
          formula #label {
            value: [column = /key]
          }
          expression #id {
            value: layouttable:key
          }
          expression #layouttablefontcolor1 {
            value: layouttable:fontcolor1
          }
          expression #layouttablesquareonecolor {
            value: layouttable:color1
          }
          expression #layouttablesquaretwocolor {
            value: layouttable:color2
          }
          expression #layouttablesquareonecolorreverse {
            value: layouttable:color1reverse
          }
          expression #layouttablesquaretwocolorreverse {
            value: layouttable:color2reverse
          }
          expression #layouttablefocusarea {
            value: layouttable:focusarea
          }
          expression #hidetile1 {
            value: layouttable:hidetile1
          }
          expression #hidetile2 {
            value: layouttable:hidetile2
          }
          formatString: "{label} "
        }
      }
    }
    map #forSelect {
      from: "keys"
      to: item {
        label: this.results.label
        value:  {
          id: this.results.id
          layouttablefontcolor1: this.results.layouttablefontcolor1

          layouttablesquareonecolor: this.results.layouttablesquareonecolor
          layouttablesquaretwocolor: this.results.layouttablesquaretwocolor
          layouttablesquareonecolorreverse: this.results.layouttablesquareonecolorreverse
          layouttablesquaretwocolorreverse: this.results.layouttablesquaretwocolorreverse
          layouttablefocusarea: this.results.layouttablefocusarea
          hidetile1: this.results.hidetile1
          hidetile2: this.results.hidetile2
        }
      }
    }
  }

  dataTable #contenttable {
    dataGrid #dataGridWidget {
      viaStrategy: shortest
      label: "DataTable for canvas layout control"
      size: "large"

      row list #keys {
        table: layouttable:
        value: ""
        total: "none"
        // sortBy: "/key"
        // sortOrder: ascending
      }
      column #key {
        hide: true
        cell {
          value: layouttable:key
        }
      }

      column #results {
        cell custom #cellcustom {
          formula #label {
            value: [column = /key]
          }

          expression #id {
            value: layouttable:key

          }
          expression #layouttablefontcolor1 {
            value: layouttable:fontcolor1
          }
          expression #layouttablefontcolor2 {
            value: layouttable:fontcolor2
          }
          expression #layouttablefontcolor3 {
            value: layouttable:fontcolor3
          }
          expression #layouttablefontcolor1reverse {
            value: layouttable:fontcolor1reverse
          }
          expression #layouttablefontcolor2reverse {
            value: layouttable:fontcolor2reverse
          }
          expression #layouttablefontcolor3reverse {
            value: layouttable:fontcolor3reverse
          }
          expression #layouttablesquareonecolor {
            value: layouttable:color1
          }
          expression #layouttablesquaretwocolor {
            value: layouttable:color2
          }
          expression #layouttablesquarethreecolor {
            value: layouttable:color3
          }
          expression #layouttablesquareonecolorreverse {
            value: layouttable:color1reverse
          }
          expression #layouttablesquaretwocolorreverse {
            value: layouttable:color2reverse
          }
          expression #layouttablesquarethreecolorreverse {
            value: layouttable:color3reverse
          }
          expression #layouttablesquareoneheight {
            value: layouttable:squareheight1
          }
          expression #layouttablesquaretwoheight {
            value: layouttable:squareheight2
          }
          expression #layouttablesquarethreeheight {
            value: layouttable:squareheight3
          }
          expression #layouttablefocusarea {
            value: layouttable:focusarea
          }
          expression #layouttablecanvasheight {
            value: layouttable:canvasheight
          }
          expression #layouttablecurrentscore {
            value: layouttable:currentscore
          }
          expression #layouttablecurrentscoretext {
            value: layouttable:currentscoretext
          }
          formatString: "{label} "
        }
      }
    }
    map #forSelect {
      from: "keys"
      to: item {
        label: this.results.label
        value:  {
          id: this.results.id
          layouttablesquareonecolor: this.results.layouttablesquareonecolor
          layouttablesquaretwocolor: this.results.layouttablesquaretwocolor
          layouttablesquarethreecolor: this.results.layouttablesquarethreecolor
          layouttablesquareonecolorreverse: this.results.layouttablesquareonecolorreverse
          layouttablesquaretwocolorreverse: this.results.layouttablesquaretwocolorreverse
          layouttablesquarethreecolorreverse: this.results.layouttablesquarethreecolorreverse
          layouttablesquareoneheight: this.results.layouttablesquareoneheight
          layouttablesquaretwoheight: this.results.layouttablesquaretwoheight
          layouttablesquarethreeheight: this.results.layouttablesquarethreeheight
          layouttablecanvasheight: this.results.layouttablecanvasheight
          layouttablefocusarea: this.results.layouttablefocusarea
          layouttablecurrentscore: this.results.layouttablecurrentscore
          layouttablecurrentscoretext: this.results.layouttablecurrentscoretext
          layouttablefontcolor1: this.results.layouttablefontcolor1
          layouttablefontcolor1reverse: this.results.layouttablefontcolor1reverse
          layouttablefontcolor2: this.results.layouttablefontcolor2
          layouttablefontcolor2reverse: this.results.layouttablefontcolor2reverse
          layouttablefontcolor3: this.results.layouttablefontcolor3
          layouttablefontcolor3reverse: this.results.layouttablefontcolor3reverse
        }
      }
    }
  }

//   dataTable #singleresponsetable {
//     dataGrid #dataGridWidget {
//       viaStrategy: shortest
//       label: "DataTable for canvas layout control"
//       size: "large"

// //too strict, lookups fail
// // filter expression {
// //   value: IIF(count(:) < @cp.confidentialitycomments, :respid < 0, true)

// // }

//       filter expression #excludeBlankResponses {
//         value: :Q89.start != "" //open2 used for now
//       }

//       row list #keys {
//         table: :
//         value: ""
//         total: "none"
//         sortBy: "/key"
//         sortOrder: ascending
//       }
//       column #key {
//         hide: true
//         cell {
//           value: :respid
//         }
//       }

//       column #results {
//         cell custom #cellcustom {
//           formula #label {
//             value: [column = /key]
//           }
//           expression #singleresponsecomment {
//             value: :Q89.start //fornow
//           }
//           formatString: "{label} "
//         }
//       }
//     }
//     map #map {
//       from: keys
//       to:  {
//         //key: this.results.label
//         comments: this.results.singleresponsecomment
//       }
//       toRecord byIndex {

//       }
//       ifEmpty: "-"
//     }

//     map #forSelect { //TBD
//       from: "keys"
//       to: item {
//         label: this.results.label

//         value:  {
//           singleresponsecomment: this.results.singleresponsecomment

//         }
//       }
//     }
//   }

  dataTable #maxminitemscore {
    dataGrid #dataGridWidget {
      viaStrategy: shortest
      label: "dt for controlling dynamic heatmap"
      sort rows {
        sortBy: "/score"
        sortOrder: descending
        takeTop: 1
        takeBottom: 1
      }

      row list #keys {
        value: ""
        total: none
        table: .dg1_questions:
      }
      column #key {
        hide: true
        cell {
          value: .dg1_questions:id
        }
      }
      column #score {
        hide: false
        label: "score"
        cell {
          value: :itemTopTwo()
          textAlign: center
        }
      }
      column #results {
        hide: false

        label: "max min"
        cell custom {
          formula #keys {
            value: [column = /keys]
          }
          formula #max {
            value: max(value[row = /keys.*, column = /score])
          }
          formula #min {
            value: min(value[row = /keys.*, column = /score])
          }
          formula #max90 {
            value: max[] - (max[] - min[]) * 0.1
          }
          formula #max80 {
            value: max[] - (max[] - min[]) * 0.2
          }
          formula #max70 {
            value: max[] - (max[] - min[]) * 0.3
          }
          formula #max60 {
            value: max[] - (max[] - min[]) * 0.4
          }
          formula #max50 {
            value: max[] - (max[] - min[]) * 0.5
          }
          formula #max40 {
            value: max[] - (max[] - min[]) * 0.6
          }
          formula #max30 {
            value: max[] - (max[] - min[]) * 0.7
          }
          formula #max20 {
            value: max[] - (max[] - min[]) * 0.8
          }
          formula #max10 {
            value: max[] - (max[] - min[]) * 0.9
          }
          formatString: "<span style='text-align: center'>{max}-{min}</span>"
        }
      }

    }
    map #forSelect {
      from: "keys"
      to: item {
        label: this.results.keys
        value:  {
          max: this.results.max
          max90: this.results.max90
          max80: this.results.max80
          max70: this.results.max70
          max60: this.results.max60
          max50: this.results.max50
          max40: this.results.max40
          max30: this.results.max30
          max20: this.results.max20
          max10: this.results.max10

          min: this.results.min
        }
      }
    }
  }




  dataTable #focusAreas {
    dataGrid #docusAreaDetail {
      viaStrategy: shortest
      label: "Data Grid"
      size: "large"
      sort rows {
        sortBy: "/favScore"
        sortOrder: descending
        takeTop: 5

      }
      column #favScore {
        cell custom {
          expression #value {
            value: Round(sum(.dg1_dimensionScore:favorabilityCounts2point.1) / sum(.dg1_dimensionScore:answerCounts) * 100, 0)
          }
          formula #value2 {
            value: IsNull(value[], "na")
          }
          headerInfo #label {
            headerId: cats
            type: label
          }
          formatString: "{label} - {value}"
          suppression custom {
            condition: formula {
              value: value2[] = "na"
            }
          }
        }
      }

      row cut #cats {
        value: .dg1_dimensionScore:dg1_dimensionScore
        total: "none"
      }
      removeEmptyRows: true
      removeEmptyColumns: true
    }

    map #m {
      from: cats
      ifEmpty: "-"
    }

  }

  hide: true
  modal: false
}
page #ActionPlanDetails {
  label: "Action Plan Details"

  hide: true

  widget initiativeDetailSummary {
    size: "large"
    navigateTo: "ActionPlans"
  }
  widget initiativeActions {
    size: "halfwidth"
  }
  widget initiativeNotes {
    size: "halfwidth"
  }
  widget initiativeTrend {
    size: "large"
  }
}

page #page_hubloader {
  label: "hubloader tables"
  widget table #tableWidget_3 {
    showCodeLabelSelector: true
    stretchColumns: true
    // filter expression {
    //   value: @cp.currentwave AND @cp.completes

    // }
    label: "dg1_questionScore"
    size: "large"
    table: .dg1_questionScore:
    column value #valueColumn {
      label: "combined_sourceid"
      value: .dg1_questionScore:combined_sourceid
      enableColumnFilter: true
    }
    column value #valueColumn_2 {
      label: "dg1_questionScore"
      value: .dg1_questionScore:dg1_questionScore
      enableColumnFilter: true
    }

    column value #valueColumn_4 {
      label: "questionScoreValue"
      value: .dg1_questionScore:questionScoreValue
      enableColumnFilter: true
    }
    column value #valueColumn_5 {
      label: "questionScoreValueNumeric"
      value: .dg1_questionScore:questionScoreValueNumeric
      enableColumnFilter: true
    }

    column value #valueColumn_6 {
      label: "responseid"
      value: .dg1_questionScore:responseid
      enableColumnFilter: true
    }
    column value #valueColumn_9 {
      label: "fourPoint"
      value: .dg1_questionScore:fourPoint
      enableColumnFilter: true
    }
    column value #valueColumn_10 {
      label: "twoPoint"
      value: .dg1_questionScore:twoPoint
      enableColumnFilter: true
    }

    column value #valueColumn_8 {
      label: "questionFavorableNumeric"
      value: .dg1_questionScore:questionFavorableNumeric
      enableColumnFilter: true
    }
    column value #valueColumn_19 {
      label: "questionFavorableNumeric 5"
      value: .dg1_questionScore:questionFavorableNumeric5s
      enableColumnFilter: true
    }
    column value #valueColumn_119 {
      label: "questionFavorableNumeric 6"
      value: .dg1_questionScore:questionFavorableNumeric6s
      enableColumnFilter: true
    }
  }
  widget table #tableWidget_2 {
    stretchColumns: true
    showCodeLabelSelector: true

    label: "dg1_dimensionScore"
    size: "large"
    table: .dg1_dimensionScore:
    column value #valueColumn {
      label: "combined_sourceid"
      value: .dg1_dimensionScore:combined_sourceid
      enableColumnFilter: true
    }
    column value #valueColumn_2 {
      label: "dg1_dimensionScore"
      value: .dg1_dimensionScore:dg1_dimensionScore
      enableColumnFilter: true
    }
    column value #valueColumn_3 {
      label: "dimensionScoreValue"
      value: .dg1_dimensionScore:dimensionScoreValue
      enableColumnFilter: true
    }

    column value #valueColumn_5 {
      label: "responseid"
      value: .dg1_dimensionScore:responseid
      enableColumnFilter: true
    }


    column value #valueColumn_6 {
      label: "answerCounts"
      value: .dg1_dimensionScore:answerCounts
      enableColumnFilter: true
    }

    column value #valueColumn_9 {
      label: "favorabilityCounts2point.1"
      value: .dg1_dimensionScore:favorabilityCounts2point.1
      enableColumnFilter: true
    }
    column value #valueColumn_7 {
      label: "favorabilityCounts2point.0"
      value: .dg1_dimensionScore:favorabilityCounts2point.0
      enableColumnFilter: true
    }
  }
  widget table #copy_of_tableWidget_4 {
    showCodeLabelSelector: true

    label: "dg1_questions"
    size: "large"
    table: .dg1_questions:
    column value #valueColumn {
      label: "id"
      value: .dg1_questions:id
      enableColumnFilter: true
    }
    column value #valueColumn_2 {
      label: "label"
      value: .dg1_questions:label
      enableColumnFilter: true
    }
    column value #valueColumn_3 {
      label: "sequenceId"
      value: .dg1_questions:sequenceId
      enableColumnFilter: true
    }
  }
  widget table #tableWidget_4 {
    showCodeLabelSelector: true

    label: "dg1_dimensions"
    size: "large"
    table: .dg1_dimensions:

    column value #valueColumn_2 {
      label: "id"
      value: .dg1_dimensions:id + ""
      enableColumnFilter: true
    }

    column value #valueColumn_5 {
      label: "label"
      value: .dg1_dimensions:label
      enableColumnFilter: true
    }

    column value #valueColumn_7 {
      label: "sequenceId"
      value: .dg1_dimensions:sequenceId
      enableColumnFilter: true
    }
    column value #valueColumn_17 {
      label: "type"
      value: .dg1_dimensions:dimensionType
      enableColumnFilter: true
    }
  }
  widget table #tableWidget_6 {
    showCodeLabelSelector: true

    label: "dg1_dimension_question"
    size: "large"
    table: .dg1_dimension_question:
    column value #valueColumn {
      label: "dimensionId"
      value: .dg1_dimension_question:dimensionId
      enableColumnFilter: true
    }
    column value #valueColumn_2 {
      label: "questionId"
      value: .dg1_dimension_question:questionId
      enableColumnFilter: true
    }
    column value #valueColumn23 {
      label: "dimensionId"
      value: .dg1_dimension_question:dimensionId + ""
      enableColumnFilter: true
    }
    column value #valueColumn_24 {
      label: "questionId"
      value: .dg1_dimension_question:questionId + ""
      enableColumnFilter: true
    }
    column value #valueColumn_3 {
      label: "sequenceId"
      value: .dg1_dimension_question:sequenceId
      enableColumnFilter: true
    }
  }
  config layout #layoutConfig {
    horizontalAlignmentMode: "fourColumnsCentered"
  }
  hide: true
  modal: false



}
page #copy_of_page_22 {
  label: "free"
  hide: true
  widget dataGrid #dataGridWidgetCats {
    size: large
    filter expression {
      value: @cp.currentwave

    }
    column #favScores {
      cell custom {
        expression #count {
          value: count(.dg1_dimensionScore:dimensionScoreValue)

        }
        expression #toofewtext {
          value: @cp.toofewresponses

        }
        formula #value {
          value: IIF(count[] < @cp.confidentiality, toofewtext[], score[])
        }
        expression #score {
          value: :dimensionTopTwoNEW2()
        }
        formula #value2 {
          value: IsNull(score[], "na")
        }
        headerInfo #label {
          headerId: cats
          type: label
        }
        suppression custom {
          condition: formula {
            value: value2[] = "na"
          }
        }
        formatString: "{label} - {value} {count}"

      }

    }
    column #microchart {
      cell microchart {
        value: sum(.dg1_dimensionScore:favorabilityCounts2point)
        microchart pie {
        }
      }
    }

    row cut #cats {
      value: .dg1_dimensionScore:dg1_dimensionScore
      total: "none"
      filter expression #expressionFilter {
        value: :keyindices()
      }
    }

    removeEmptyRows: true
    removeEmptyColumns: true
  }
}
// page #itemsmodal {
//   label: "Items"
//   showPrintButton: false
//   widget dataGrid #super {

//     cardCorners: 10px
//     viaStrategy: shortest
//     virtualize: true

//     select #distributionType {
//       label: "Score Distribution"
//       options: item {
//         label:"Favorable"
//         value:{
//             question: .dg1_questionScore:twoPoint
//             palette: 'mercer_1_color'
//         }
//       },
//       item{
//         label: "Full Distribution"
//         value:{
//           question: .dg1_questionScore:fourpoint
//             palette: 'mercer'
//         }
//       }

//     }
//     suppression recordsBase {
//       threshold: 5
//     }
//     size: large
//     removeEmptyRows: true

//     row list #items {
//       total: none
//       value: toText(answerText(.dg1_questions:Id))
//       table: .dg1_dimension_question:

//       filter expression {
//         value: IIF(@layoutselector.selected.id = "1", .dg1_dimensions:label = @top3dimcorr.map.data._0.label, IIF(@layoutselector.selected.id = "2", .dg1_dimensions:label = @top3dimcorr.map.data._1.label, .dg1_dimensions:label = @top3dimcorr.map.data._2.label))

//       }
//     }



//       //*******************columns********************************


//     column #favorable {
//       label: "Total Favorable Score"
//       filter expression {
//         value: @cp.currentwave

//       }
//     }

//     column #distribution {
//       label: "Response Distribution"
//       width: 300px
//     }

//     column #overall {
//       hide: true
//       label: "overall"
//       scope reportingHierarchy {
//         reportingHierarchy: selfRefLookupReportinghierarchy
//         nodes: AllData
//       }

//     }

//     column #vsoverall {
//       label: "vs. Company Overall"
//     }

//     cell custom {
//       column: vsoverall
//       row: items

//       formula #value {
//         value: value[column = /favorable] - value[column = /overall]
//         formatter: percentNoDecimal

//       }
//       formula #vsarrow {
//         value: isNull(value[], "")
//         formatter: upordown
//       }

//       formula #color {
//         value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

//       }

//       style #body {
//         alignItems: 'center'
//         textAlign: 'center'
//       }
//       formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

//     }

//     column #priorcycle {
//       hide: true
//       label: "priorcycle"
//       filter expression #tempcyclefilter {
//         value: @cp.previouswave
//       }
//     }

//     column #vsprior {
//       label: @comparisonPeriodSelector.selectedLabel//"vs. Prior Cycle "
//     }

//     column #norm {
//       hide: true

//       label: "norm"
//     }
//     column #vsnorm {
//       hide: true //@normselector2.selected.hidenorm
//       label: "vs. " + @benchmarksListItemsSelector.selectedLabel
//     }

// //***********************normcells************
//     cell custom {
//       row: items
//       column: norm
//       lookup value #mean {

//         source: benchmarksById
//         mapping value { //TODO: doesn't work yet, se comment on cutByTable #bench 
//           value: "global" //@normselector2.selected.benchmarkID
//           selector: benchmarkID
//         }
//         mapping header {
//           header: 'items'
//           selector: bmValueCode2
//         }

//         value: norm
//       }
//       formula #normscore {
//         value: mean[] * 100
//         formatter: percentNoDecimal

//       }
//       formatString: "{normscore}"
//     }

//     cell custom {
//       column: vsnorm
//       formula #value {
//         value: score[column = /favorable] - normscore[column = /norm]
//     //      value: score[column = /history.current] - score[column = /overall]
//         formatter: percentNoDecimal
//       }
//       formula #vsarrow {
//         value: isNull(value[], "")
//         formatter: upordown
//       }

//       formula #color {
//         value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

//       }
//       style {
//         alignItems: "center"
//       }
//       formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

//     }

//     cell custom {
//       column: vsprior
//       row: items

//       formula #value {
//         value: value[column = /favorable] - value[column = /priorcycle]
//         formatter: percentNoDecimal

//       }
//       formula #vsarrow {
//         value: isNull(value[], "")
//         formatter: upordown
//       }

//       formula #color {
//         value: IIF(value[] > 0, "#34ae9a", IIF(value[] < 0, "#d02625", "Black"))

//       }

//       style #body {
//         alignItems: 'center'
//         textAlign: 'center'
//       }
//       formatString: '<span style ="color:{color}">{value} {vsarrow}</span>'

//     }



// //***********************cell microchart***************************
//     cell microchart {
//       row: items

//       column: distribution
//       value: count(.dg1_questionScore:) //runs on questionscore too
//       breakdownBy cut {
//         value: @distributionType.selected.question
//       }
//       microchart stacked100PercentBar {
//         palette: @distributionType.selected.palette
//         percentFormat: percentNoDecimal
//       }
//     }

//     //***********************cell for favorable, overall****************************

//     cell custom {
//       row: items
//       column: favorable, overall,priorcycle

//       expression #value {
//         value: :itemTopTwo()
//         formatter: percentNoDecimal
//       }
//       style #body {
//         alignItems: 'center'
//         textAlign: 'center'
//       }
//       formatString: "{value}"

//     }
//       //**********************responses *****************************



//     label: "Items"

//     cardTransparent: true
//   }



//   hide: false
//   modal: true
// }
page #driveritemsmodal {
  label: "Driver Items"
  showPrintButton: false
  modal: true
  modalSize: "huge"

  widget actionPlannerDataGrid #rankingtable {
    label: "Ranked Focus Items"
    size: large
    cardCorners: 10px
    viaStrategy: shortest

    sort rows {
      sortBy: "/totalrankscore"
      sortOrder: ascending
     // takeTop: 10
    }

    filter expression {
      value: @cp.currentwave
    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Mental_Health" AND .dg1_dimension_question:dimensionId != "Manager_support" AND .dg1_dimension_question:dimensionId != "Talent_Focus" AND .dg1_dimension_question:dimensionId != "Agility" AND .dg1_dimension_question:dimensionId != "Engaging_Leadership" AND .dg1_dimension_question:dimensionId != "Positive_Duty"

    }

    filter expression {
      value: .dg1_dimension_question:dimensionId != "Engagement" AND .dg1_dimension_question:dimensionId != "Engagement_Legacy" AND .dg1_dimension_question:dimensionId != "Intent_to_stay"
    }
    filter expression #removenonRWA {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    // filter expression #removenonRWA2 {
    //   value: .dg1_questions:Id != "EN0290" AND .dg1_questions:Id != "EN0556" AND .dg1_questions:Id != "EN0558" AND .dg1_questions:Id != "EN0467" AND .dg1_questions:Id != "EN0559"
    // }
    filter expression #exclude_positive_duty {
      value: .dg1_questions:Id != "Q66" AND .dg1_questions:Id != "Q67" AND .dg1_questions:Id != "Q68" AND .dg1_questions:Id != "Q69" AND .dg1_questions:Id != "Q70" AND .dg1_questions:Id != "Q71" AND .dg1_questions:Id != "Q72"
    }
    filter expression #exclude_manager_support {
      value: .dg1_questions:Id != "Q75" AND .dg1_questions:Id != "Q76" AND .dg1_questions:Id != "Q77" AND .dg1_questions:Id != "Q78" AND .dg1_questions:Id != "Q79" AND .dg1_questions:Id != "Q80" AND .dg1_questions:Id != "Q81" AND .dg1_questions:Id != "Q82" AND .dg1_questions:Id != "Q83" AND .dg1_questions:Id != "Q84" AND .dg1_questions:Id != "Q85" AND .dg1_questions:Id != "Q86" AND .dg1_questions:Id != "Q87"
    }

    row list #items {
      total: none
      value: .dg1_questions:id
      table: .dg1_questions:
    }

    column #dimensionlabel {
      label: "Dimension"

      cell #cell {
        value: Max(toText(answerText(.dg1_dimension_question:dimensionId))) //max just picks one of the dims to avoid relation violation
        style #body {
          alignItems: 'start'
        }
      }
    }

    column #totalrankscore {
      label: "Total Rank"
      cell custom {

        formula #averagerank {
          value: 0 - average(value[column = /favorablerank], value[column = /cofrank2], value[column = /ranknormgap])

        }
        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: averagerank
          dimension: rows
        }
        formatString: "{value}   " // {averagerank}  {calc} {count}
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #cofrank2 {
      hide: false
      label: "Highest DIM Impact Rank"
      cell {
        value: DenseRankRev(correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)) //DenseRank?
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }


    column #favorablerank {
      label: "Lowest Score Rank"
      cell custom {

        expression #value {
          value: isNull(Rank(:itemTopTwo()), 0)
        }
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
        formatString: "{value}"

      }
    }

    column #ranknormgap {
      label: "Worst Gap To Norm Rank"
      cell custom {

        formula #normgapreal { //normgap
          value: value[column = /norm] - value[column = /favorable]

        }
        formula #normgap {
          value: isNull(normgapreal[], "")
        }
        rank #value {
          mode: all
//          sourceValueId: value[]
          sourceValue: normgap
          dimension: rows
        }
        formatString: "{value}"
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }

    column #cofrank {
      hide: true
      label: "Highest Item Impact Rank"
      cell {
        value: RankRev(correlation(numeric(.dg1_questionScore:questionScoreValue), :forDimension))
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }
    column #favorable {
      label: "Favorable Score"
      hide: false
    }
    column #cof {
      hide: false
      label: "Impact DIMS"
      cell {
        value: correlation(numeric(.dg1_dimensionScore:dimensionScoreValue), :forDimension)
      }
    }



    column #overall {
      hide: true
      label: "overall"
      scope reportingHierarchy {
        reportingHierarchy: selfRefLookupReportinghierarchy
        nodes: AllData
      }

    }
    column #priorcycle {
      hide: true
      label: "priorcycle"
      filter expression #tempcyclefilter {
        value: @cp.previouswave
      }
    }

    column #normgapcol {
      label: "NormGap"
      cell custom {
        formula #value {
          value: value[column = /favorable] - value[column = /norm]
          //value: normgap[column = /ranknormgap]
          formatter: percentNoDecimal
        }
        formatString: "{value}"
      }
    }

    column #norm {
      hide: false
      cell custom {
        lookup value #mean {
          source: norms
          mapping value {
            value: @benchmarksListItemsSelector.selected
            selector: NormId
          }
          mapping value {
            selector: ResponseValue
            value: 6

          }
          mapping header {
            header: items
            selector: QuestionId
          }

          value: ResponseCount
        }

        formula #value {
          value: Round(mean[] / 1000, 0)
          formatter: percentNoDecimal
        }

        expression #sequenceid {
          value: .dg1_questions:sequenceId
        }
        formatString: "{value}"
      }
      label: "norm"
    }
    column #addToPlan {
      label: "Add Plan"
      hide: @cp.actionplanninghide

      cell custom {
        row: items
        view: actionPlanner
        expression #id {
          value: toText(surveyDataset.items:id)
        }
        formatString: "Add plan"
      }
    }

    cell custom {
      row: items
      column: favorable, overall,priorcycle
      expression #value {
        value: :itemTopTwo()
          //formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
  }

  hide: false
  // modal: true
}
page #commentsmodal {
  label: "Comments"
  hide: true
  modal: true

  filter expression {
    value: @cp.currentwave

  }

  widget comments #commentsWidget {
    cardCorners: 10px

    //note that the filter is pointing to the next _row because category 0 engagement is not part of top3domcorr table
    // filter expression { //should be a comment cateogory ref
    //   value: IIF(@layoutselector.selected.id = "1", :comment_category = toText(@top3dimcorr.map.data._0.sequenceid), IIF(@layoutselector.selected.id = "2", :comment_category = toText(@top3dimcorr.map.data._1.sequenceid), :comment_category = toText(@top3dimcorr.map.data._2.sequenceid)))

    // }
    label: "Comments"
    column response #responseColumn {
      sortBy: comment
      enableColumnFilter: true
    }
    group question #questionGroup {
      label: "Main Comment"
      filter expression #excludeBlankResponses {
        value: :q89.start != ""
      }
      comment: :q89.start
    }
    size: large
    table: :

  }

}
page #itemSegmentationDetails {
  label: "Item Segmentation Detail"
  widget dataGrid #copy_of_itemBreakouts {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    viaStrategy: shortest

    filter expression {
      value: @cp.currentwave

    }
    filter expression {
      value: .dg1_dimensions:Id != "Engagement"
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    virtualize: true
    select #distributionTypeitems {
      areaId: "area"

      label: "Dimension/Item Distribution"
      options: item {
        label:"Favorable"
        value:{
            question: .dg1_questionScore:twoPoint
            palettequestion: mercer_1_color
        }
      },
      item{
        label: "Full Distribution"
        value:{
          question: .dg1_questionScore:fourpoint
          palettequestion: mercerlist
        }
      }
    }
    // suppression respondentsBase {
    //   threshold: @cp.confidentiality
    // }
    size: large

    activeRows: count, items //@rows.selected.show
    activeColumns: @distributionType.selected.activecol

    row #count {
      label: "Count"
      cell custom {
        expression #count {
          value: count(@demoCut.selected)
        }
        expression #toofewtext {
          value: @cp.toofewresponses

        }
        formula #value {
          value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
        }
        formatString: "{value}"
        style {
          alignItems: center
        }
      }
    }


    row nestedHeaders #both {
      viewMode: expanded//@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: @demoCut.selected
      total: "first"
      totalLabel: "Group Overall Score"
    }



//***********************cell microchart***************************

    //***********************cell for favorable, overall****************************
    cell custom {
      row: dimensions
      column: favorable
      suppression custom {
        condition: countdistinct(:) < @cp.confidentiality
      }

      expression #value {
        value: :dimensionTopTwoNEW2()
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave
      }
      label: "Responses"
    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
    column #popup {
      label: " "

    }

    label: ""
    description: ""

  }

  widget chart #segments {


    hide: @cp.hidechartsegmentation
    label: "Distribution for Segments in the Selected Demographic"
    cardCorners: 10px
    removeEmptyCategories: true
    suppressRule {
      criteria: @cp.currenthasdata = false

    }
    filter expression {
      value: @cp.currentwave
    }
    viaStrategy: shortest
    //to suppress series
    suppression respondentsBase {
      threshold: @cp.confidentiality
      in: totalCategories
    }

    series #series {

      chart bar #barChart {
        mode: "stacked100Percent"
        showValue: true
        showBase: false
        dataLabel: value

      }
      value: count(.response:responseid)
      breakdownBy cut {
        value: @distributionTypeitems.selected.question //.dg1_questionScore:fourpoint
      }
      percentOver: "series"
      format: percentNoDecimal
      palette: @distributionTypeitems.selected.palettequestion
    }
    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    size: large
    layout: "vertical"
    category cut #cutCategory {
      value: @demoCut.selected
    }
    legend: "bottomCenter"
    palette: mercer
    cardTransparent: false
    cardShadow: true

  }
  hide: false
  modal: true
}
page #dimensionSegmentationDetails {
  label: "Item Segmentation Detail"
  widget dataGrid #copy_of_itemBreakouts {
    suppressRule {
      criteria: @cp.currenthasdata = false
    }
    cardCorners: 10px
    viaStrategy: shortest

    filter expression {
      value: @cp.currentwave

    }
    filter expression {
      value: .dg1_dimensions:Id != "Engagement"
    }
    filter expression #includeengagementitems {
      value: .dg1_questions:Id != "EN0001" AND .dg1_questions:Id != "EN0002" AND .dg1_questions:Id != "EN0003" AND .dg1_questions:Id != "EN0004" AND .dg1_questions:Id != "EN0005" AND .dg1_questions:Id != "EN0006"
    }
    virtualize: true
    select #distributionTypedimensions {
      areaId: "area"

      label: "Dimension/Item Distribution"
      options: item {
        label: "Full Distribution"
        value:{ 
          hidefav: true
          hidefull: false    
                }
      },
      item{
         label:"Favorable"
        value:{
          hidefav: full
          hidefull: true         
        }
      }
    }
    // suppression respondentsBase {
    //   threshold: @cp.confidentiality
    // }
    size: large

    activeRows: count, dimensions //@rows.selected.show
    activeColumns: @distributionType.selected.activecol

    row #count {
      label: "Count"
      cell custom {
        expression #count {
          value: count(@demoCut.selected)
        }
        expression #toofewtext {
          value: @cp.toofewresponses

        }
        formula #value {
          value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
        }
        formatString: "{value}"
        style {
          alignItems: center
        }
      }
    }


    row nestedHeaders #both {
      viewMode: expanded//@rows.selected.viewmode
      nesting byTable {
        parent: .dg1_dimension_question:dimensionId
        child: .dg1_dimension_question:questionId
      }

      parent list #dimensions {
        total: none
        table: .dg1_dimensions:
        value: .dg1_dimensions:Id
        sortBy: .dg1_dimensions:SequenceId
        sortOrder: ascending
      }

      child list #items {
        total: none
        //hide: @rows.selected.hideitems //prob need selector to set this to allow for norm and responsecount DIMS by items
        table: .dg1_questions:
        value: answerText(.dg1_questions:Id)
        sortBy: .dg1_questions:SequenceId
        sortOrder: ascending
      }
    }
    row list #items {
      total: none
      table: .dg1_questions:
      value: toText(answerText(.dg1_questions:Id))
      sortBy: .dg1_questions:SequenceId
      sortOrder: ascending
    }
    row list #dimensions {
      total: none
      table: .dg1_dimensions:
      value: .dg1_dimensions:Id
      sortBy: .dg1_dimensions:SequenceId
      sortOrder: ascending
    }

      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: @demoCut.selected
      total: "first"
      totalLabel: "Group Overall Score"
    }



//***********************cell microchart***************************

    //***********************cell for favorable, overall****************************
    cell custom {
      row: dimensions
      column: favorable
      suppression custom {
        condition: countdistinct(:) < @cp.confidentiality
      }

      expression #value {
        value: :dimensionTopTwoNEW2()
        formatter: percentNoDecimal

      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

      //**********************responses *****************************

    column #responses {
      filter expression {
        value: @cp.currentwave
      }
      label: "Responses"
    }

    cell custom #itemresponses {
      row: items
      column: responses
      expression #count {
        value: count(:, @cp.completes)
      }
      expression #toofewtext {
        value: @cp.toofewresponses

      }
      formula #value {
        value: IIF(count[] < @cp.confidentiality, toofewtext[], count[])
      }

      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }

    cell custom #dimresponses {
      row: dimensions
      column: responses
      formula #countdim {
        value: round(avg(count[column = /responses, row = items.*]), 0)
      }
      expression #toofewtext {
        value: @cp.toofewresponses
      }

      formula #value {
        value: IIF(countdim[] < @cp.confidentiality, toofewtext[], countdim[])
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"
    }
    column #popup {
      label: " "

    }

    label: ""
    description: ""

  }

  widget chart #full2 {
    hide: @distributionTypedimensions.selected.hidefull
    label: "Distribution for Segments in the Selected Demographic"
    cardCorners: 10px
    removeEmptyCategories: true
    suppressRule {
      criteria: @cp.currenthasdata = false
    }

    filter expression {
      value: @cp.currentwave
    }
    viaStrategy: shortest

    suppression respondentsBase {
      threshold: @cp.confidentiality
     // in: totalCategories
    }

    chart bar #barChart {
      mode: "stacked100Percent"
      showValue: true
      showBase: false
      dataLabel: percent
      showBaseInTooltip: false
      percentFormat: percentNoDecimal
      palette: mercerlist

    }
    series #series1 {
      value: sum(.dg1_dimensionScore:favorabilityCounts4point.4)

    }
    series #series2 {
      value: sum(.dg1_dimensionScore:favorabilityCounts4point.3)

    }
    series #series3 {
      value: sum(.dg1_dimensionScore:favorabilityCounts4point.2)

    }
    series #series4 {
      value: sum(.dg1_dimensionScore:favorabilityCounts4point.1)
    }



    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    size: large
    layout: "vertical"
    category cut #cutCategory2 {
      value: .dg1_dimensionScore:dg1_dimensionScore
    }
    category cut #cutCategory {
      value: @demoCut.selected
    }

    legend: "bottomCenter"
    palette: mercer
    cardTransparent: false
    cardShadow: true

  }
  widget chart #fav {
    hide: @distributionTypedimensions.selected.hidefav
    label: "Distribution for Segments in the Selected Demographic"
    cardCorners: 10px
    removeEmptyCategories: true
    suppressRule {
      criteria: @cp.currenthasdata = false
    }

    filter expression {
      value: @cp.currentwave
    }
    viaStrategy: shortest

    suppression respondentsBase {
      threshold: @cp.confidentiality
     // in: totalCategories
    }

    chart bar #barChart {
      mode: "stacked100Percent"
      percentFormat: percentNoDecimal
      showValue: true
      showBase: false
      dataLabel: percent
      showBaseInTooltip: false
    }
    series #series1 {
      value: sum(.dg1_dimensionScore:favorabilityCounts2point.1)

    }
    series #series2 {
      value: sum(.dg1_dimensionScore:favorabilityCounts2point.0)
    }

    axis category #categoryAxis {
    }
    axis primary #primaryAxis {
    }
    axis secondary #secondaryAxis {
      hide: true
    }
    size: large
    layout: "vertical"
    category cut #cutCategory2 {
      value: .dg1_dimensionScore:dg1_dimensionScore
    }
    category cut #cutCategory {
      value: @demoCut.selected
    }
    legend: "bottomCenter"
    palette: mercer_1_color
    cardTransparent: false
    cardShadow: true
  }
  hide: false
  modal: true
}

page #trendmodal {
  label: "Trend Modal"
  modal: true

  widget chart #chartWidget {
    cardCorners: 10px
    viaStrategy: shortest
    label: "Trend Chart"

    filter expression {
      value: IIF(@cp.previoushasdata = true, true, @cp.currentwave)

    }
    series #hidden { //added to create a space for the categories
      chart bar {
        legendType: none
      }
      value: parseInt("a")
    }

    series #series {

      chart line #barChart {

        dotSize: 6
        lineWidth: 3
      }
      value: average(numeric(.dg1_questionScore:questionFavorableNumeric)) * 100
      breakdownBy cut {
        value: .dg1_questionScore:dg1_questionScore

      }
      format: percentNoDecimal
    }


    axis primary #primaryAxis {
      format: percentNoDecimal
      tickLine: true

    }

    size: large
    category cut #cutCategory {
      value: :wave
    }
    legend: "topLeft"
    removeEmptySeries: true


  }
  widget dataGrid #super {
    cardCorners: 10px
    viaStrategy: shortest
    virtualize: true


    row cut #items {
      total: none
      value: toText(answerText(.dg1_questions:Id))


    }

    suppression recordsBase {
      threshold: 5
    }
    size: large
      //*******************columns********************************

    column cut #favorable {
      label: "Total Favorable Score"
      value: :wave
      total: none
    }


    //***********************cell for favorable, overall****************************


    cell custom {
      row: items
      column: favorable

      expression #value {
        value: :itemTopTwo()
        formatter: percentNoDecimal
      }
      style #body {
        alignItems: 'center'
        textAlign: 'center'
      }
      formatString: "{value}"

    }
      //**********************responses *****************************



    label: "Item Trends"
  }



}
page #Heatmapdrilldown {
  label: "Heatmap drilldown"
  widget dataGrid #copy_of_dataGridWidget_2 {
    cardCorners: 10px

    label: "Organizational/Demographic Heatmap"
    viaStrategy: shortest
    via: .dg1_questionScore:
    virtualize: true
    size: "large"

    filter expression {
      value: @cp.currentwave

    }


    removeEmptyColumns: true
    removeEmptyRows: true


    select #demoCutSelectorDrilldown {
      options: @demographics.items
      label: "Choose a Demographic cut"
      defaultOption: @demoCutSelector.selected
    }


    view cellVisualization #heatmapview1 {
      backgroundColorFormatter: heatmapbackgroundcolor
      valueColorFormatter: heatmapbackgroundcolorvalue

    }
    column #count {
      cell #cell {
        value: count(:responseid)
        format: numberFormatter
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
      label: "N"
    }


    column cut #itemscut {

      total: none
      value: .dg1_questionScore:dg1_questionScore
      cell {
        suppression respondentsBase {
          threshold: 5
        }
        view: heatmapview1

        value: :itemTopTwo()
        format: percentNoDecimal
        style #body {
          alignItems: 'center'
          textAlign: 'center'
        }
      }
    }


    row cut #cutRow {
      value: @demoCutSelectorDrilldown.selected
      total: first
    }


  }

  hide: false
  modal: true
}
